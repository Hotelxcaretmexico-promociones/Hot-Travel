var requirejs,require,define;!function(ba){function J(e){return"[object Function]"===N.call(e)}function K(e){return"[object Array]"===N.call(e)}function z(e,t){var a;if(e)for(a=0;a<e.length&&(!e[a]||!t(e[a],a,e));a+=1);}function O(e,t){var a;if(e)for(a=e.length-1;-1<a&&(!e[a]||!t(e[a],a,e));a-=1);}function t(e,t){return ha.call(e,t)}function m(e,a){return t(e,a)&&e[a]}function H(e,a){for(var o in e)if(t(e,o)&&a(e[o],o))break}function S(o,e,i,n){return e&&H(e,function(e,a){!i&&t(o,a)||(n&&"string"!=typeof e?(o[a]||(o[a]={}),S(o[a],e,i,n)):o[a]=e)}),o}function v(e,t){return function(){return t.apply(e,arguments)}}function ca(e){throw e}function da(e){if(!e)return e;var t=ba;return z(e.split("."),function(e){t=t[e]}),t}function B(e,t,a,o){return(t=Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e)).requireType=e,t.requireModules=o,a&&(t.originalError=a),t}function ia(c){function p(e,t,a){var o,i,n,r,s,l,c,u=t&&t.split("/");o=u;var p=M.map,d=p&&p["*"];if(e&&"."===e.charAt(0))if(t){for(t=e=(o=m(M.pkgs,t)?u=[t]:u.slice(0,u.length-1)).concat(e.split("/")),o=0;t[o];o+=1)if("."===(i=t[o]))t.splice(o,1),o-=1;else if(".."===i){if(1===o&&(".."===t[2]||".."===t[0]))break;0<o&&(t.splice(o-1,2),o-=2)}o=m(M.pkgs,t=e[0]),e=e.join("/"),o&&e===t+"/"+o.main&&(e=t)}else 0===e.indexOf("./")&&(e=e.substring(2));if(a&&p&&(u||d)){for(o=(t=e.split("/")).length;0<o;o-=1){if(n=t.slice(0,o).join("/"),u)for(i=u.length;0<i;i-=1)if((a=m(p,u.slice(0,i).join("/")))&&(a=m(a,n))){r=a,s=o;break}if(r)break;!l&&d&&m(d,n)&&(l=m(d,n),c=o)}!r&&l&&(r=l,s=c),r&&(t.splice(0,s,r),e=t.join("/"))}return e}function u(t){A&&z(document.getElementsByTagName("script"),function(e){if(e.getAttribute("data-requiremodule")===t&&e.getAttribute("data-requirecontext")===D.contextName)return e.parentNode.removeChild(e),!0})}function d(e){var t=m(M.paths,e);if(t&&K(t)&&1<t.length)return u(e),t.shift(),D.require.undef(e),D.require([e]),!0}function f(e){var t,a=e?e.indexOf("!"):-1;return-1<a&&(t=e.substring(0,a),e=e.substring(a+1,e.length)),[t,e]}function g(e,t,a,o){var i,n,r=null,s=t?t.name:null,l=e,c=!0,u="";return e||(c=!1,e="_@r"+(N+=1)),r=(e=f(e))[0],e=e[1],r&&(r=p(r,s,o),n=m(E,r)),e&&(r?u=n&&n.normalize?n.normalize(e,function(e){return p(e,s,o)}):p(e,s,o):(r=(e=f(u=p(e,s,o)))[0],u=e[1],a=!0,i=D.nameToUrl(u))),{prefix:r,name:u,parentMap:t,unnormalized:!!(a=!r||n||a?"":"_unnormalized"+(O+=1)),url:i,originalName:l,isDefine:c,id:(r?r+"!"+u:u)+a}}function _(e){var t=e.id,a=m(P,t);return a||(a=P[t]=new D.Module(e)),a}function n(e,a,o){var i=e.id,n=m(P,i);!t(E,i)||n&&!n.defineEmitComplete?(n=_(e)).error&&"error"===a?o(n.error):n.on(a,o):"defined"===a&&o(E[i])}function y(t,e){var a=t.requireModules,o=!1;e?e(t):(z(a,function(e){(e=m(P,e))&&(e.error=t,e.events.error&&(o=!0,e.emit("error",t)))}),o||h.onError(t))}function k(){U.length&&(ja.apply(s,[s.length-1,0].concat(U)),U=[])}function b(e){delete P[e],delete F[e]}function C(){var t,a,e,o,i=(e=1e3*M.waitSeconds)&&D.startTime+e<(new Date).getTime(),n=[],r=[],s=!1,l=!0;if(!w){if(w=!0,H(F,function(e){if(t=e.map,a=t.id,e.enabled&&(t.isDefine||r.push(e),!e.error))if(!e.inited&&i)d(a)?s=o=!0:(n.push(a),u(a));else if(!e.inited&&e.fetched&&t.isDefine&&(s=!0,!t.prefix))return l=!1}),i&&n.length)return(e=B("timeout","Load timeout for modules: "+n,null,n)).contextName=D.contextName,y(e);l&&z(r,function(e){!function i(n,r,s){var e=n.map.id;n.error?n.emit("error",n.error):(r[e]=!0,z(n.depMaps,function(e,t){var a=e.id,o=m(P,a);o&&!n.depMatched[t]&&!s[a]&&(m(r,a)?(n.defineDep(t,E[a]),n.check()):i(o,r,s))}),s[e]=!0)}(e,{},{})}),i&&!o||!s||!A&&!ea||I||(I=setTimeout(function(){I=0,C()},50)),w=!1}}function r(e){t(E,e[0])||_(g(e[0],null,!0)).init(e[1],e[2])}function a(e){e=e.currentTarget||e.srcElement;var t=D.onScriptLoad;return e.detachEvent&&!Z?e.detachEvent("onreadystatechange",t):e.removeEventListener("load",t,!1),t=D.onScriptError,(!e.detachEvent||Z)&&e.removeEventListener("error",t,!1),{node:e,id:e&&e.getAttribute("data-requiremodule")}}function x(){var e;for(k();s.length;){if(null===(e=s.shift())[0])return y(B("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));r(e)}}var w,e,D,T,I,M={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{},config:{}},P={},F={},o={},s=[],E={},i={},N=1,O=1;return T={require:function(e){return e.require?e.require:e.require=D.makeRequire(e.map)},exports:function(e){if(e.usingExports=!0,e.map.isDefine)return e.exports?e.exports:e.exports=E[e.map.id]={}},module:function(t){return t.module?t.module:t.module={id:t.map.id,uri:t.map.url,config:function(){var e=m(M.pkgs,t.map.id);return m(M.config,e?t.map.id+"/"+e.main:t.map.id)||{}},exports:E[t.map.id]}}},(e=function(e){this.events=m(o,e.id)||{},this.map=e,this.shim=m(M.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0}).prototype={init:function(e,t,a,o){o=o||{},this.inited||(this.factory=t,a?this.on("error",a):this.events.error&&(a=v(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=a,this.inited=!0,this.ignore=o.ignore,o.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,D.startTime=(new Date).getTime();var e=this.map;if(!this.shim)return e.prefix?this.callPlugin():this.load();D.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],v(this,function(){return e.prefix?this.callPlugin():this.load()}))}},load:function(){var e=this.map.url;i[e]||(i[e]=!0,D.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var t,e,a=this.map.id;e=this.depExports;var o=this.exports,i=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(J(i)){if(this.events.error&&this.map.isDefine||h.onError!==ca)try{o=D.execCb(a,i,e,o)}catch(e){t=e}else o=D.execCb(a,i,e,o);if(this.map.isDefine&&((e=this.module)&&void 0!==e.exports&&e.exports!==this.exports?o=e.exports:void 0===o&&this.usingExports&&(o=this.exports)),t)return t.requireMap=this.map,t.requireModules=this.map.isDefine?[this.map.id]:null,t.requireType=this.map.isDefine?"define":"require",y(this.error=t)}else o=i;this.exports=o,this.map.isDefine&&!this.ignore&&(E[a]=o,h.onResourceLoad)&&h.onResourceLoad(D,this.map,this.depMaps),b(a),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var l=this.map,c=l.id,e=g(l.prefix);this.depMaps.push(e),n(e,"defined",v(this,function(e){var r,a;a=this.map.name;var o=this.map.parentMap?this.map.parentMap.name:null,s=D.makeRequire(l.parentMap,{enableBuildCallback:!0});this.map.unnormalized?(e.normalize&&(a=e.normalize(a,function(e){return p(e,o,!0)})||""),n(e=g(l.prefix+"!"+a,this.map.parentMap),"defined",v(this,function(e){this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),(a=m(P,e.id))&&(this.depMaps.push(e),this.events.error&&a.on("error",v(this,function(e){this.emit("error",e)})),a.enable())):((r=v(this,function(e){this.init([],function(){return e},null,{enabled:!0})})).error=v(this,function(e){this.inited=!0,(this.error=e).requireModules=[c],H(P,function(e){0===e.map.id.indexOf(c+"_unnormalized")&&b(e.map.id)}),y(e)}),r.fromText=v(this,function(e,a){var o=l.name,i=g(o),n=Q;a&&(e=a),n&&(Q=!1),_(i),t(M.config,c)&&(M.config[o]=M.config[c]);try{h.exec(e)}catch(e){return y(B("fromtexteval","fromText eval for "+c+" failed: "+e,e,[c]))}n&&(Q=!0),this.depMaps.push(i),D.completeLoad(o),s([o],r)}),e.load(l.name,s,r,M))})),D.enable(e,this),this.pluginMaps[e.id]=e},enable:function(){(F[this.map.id]=this).enabling=this.enabled=!0,z(this.depMaps,v(this,function(e,a){var o,i;if("string"==typeof e){if(e=g(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[a]=e,o=m(T,e.id))return void(this.depExports[a]=o(this));this.depCount+=1,n(e,"defined",v(this,function(e){this.defineDep(a,e),this.check()})),this.errback&&n(e,"error",v(this,this.errback))}o=e.id,i=P[o],!t(T,o)&&i&&!i.enabled&&D.enable(e,this)})),H(this.pluginMaps,v(this,function(e){var t=m(P,e.id);t&&!t.enabled&&D.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var a=this.events[e];a||(a=this.events[e]=[]),a.push(t)},emit:function(e,t){z(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},(D={config:M,contextName:c,registry:P,defined:E,urlFetched:i,defQueue:s,Module:e,makeModuleMap:g,nextTick:h.nextTick,onError:y,configure:function(e){e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/");var t=M.pkgs,a=M.shim,o={paths:!0,config:!0,map:!0};H(e,function(e,t){o[t]?"map"===t?(M.map||(M.map={}),S(M[t],e,!0,!0)):S(M[t],e,!0):M[t]=e}),e.shim&&(H(e.shim,function(e,t){K(e)&&(e={deps:e}),!e.exports&&!e.init||e.exportsFn||(e.exportsFn=D.makeShimExports(e)),a[t]=e}),M.shim=a),e.packages&&(z(e.packages,function(e){t[(e="string"==typeof e?{name:e}:e).name]={name:e.name,location:e.location||e.name,main:(e.main||"main").replace(ka,"").replace(fa,"")}}),M.pkgs=t),H(P,function(e,t){!e.inited&&!e.map.unnormalized&&(e.map=g(t))}),(e.deps||e.callback)&&D.require(e.deps||[],e.callback)},makeShimExports:function(t){return function(){var e;return t.init&&(e=t.init.apply(ba,arguments)),e||t.exports&&da(t.exports)}},makeRequire:function(r,s){function l(e,a,o){var i,n;return s.enableBuildCallback&&a&&J(a)&&(a.__requireJsBuild=!0),"string"==typeof e?J(a)?y(B("requireargs","Invalid require call"),o):r&&t(T,e)?T[e](P[r.id]):h.get?h.get(D,e,r,l):(i=(i=g(e,r,!1,!0)).id,t(E,i)?E[i]:y(B("notloaded",'Module name "'+i+'" has not been loaded yet for context: '+c+(r?"":". Use require([])")))):(x(),D.nextTick(function(){x(),(n=_(g(null,r))).skipMap=s.skipMap,n.init(e,a,o,{enabled:!0}),C()}),l)}return s=s||{},S(l,{isBrowser:A,toUrl:function(e){var t,a=e.lastIndexOf("."),o=e.split("/")[0];return-1!==a&&("."!==o&&".."!==o||1<a)&&(t=e.substring(a,e.length),e=e.substring(0,a)),D.nameToUrl(p(e,r&&r.id,!0),t,!0)},defined:function(e){return t(E,g(e,r,!1,!0).id)},specified:function(e){return e=g(e,r,!1,!0).id,t(E,e)||t(P,e)}}),r||(l.undef=function(e){k();var t=g(e,r,!0),a=m(P,e);delete E[e],delete i[t.url],delete o[e],a&&(a.events.defined&&(o[e]=a.events),b(e))}),l},enable:function(e){m(P,e.id)&&_(e).enable()},completeLoad:function(e){var a,o,i=m(M.shim,e)||{},n=i.exports;for(k();s.length;){if(null===(o=s.shift())[0]){if(o[0]=e,a)break;a=!0}else o[0]===e&&(a=!0);r(o)}if(o=m(P,e),!a&&!t(E,e)&&o&&!o.inited){if(M.enforceDefine&&(!n||!da(n)))return d(e)?void 0:y(B("nodefine","No define call for "+e,null,[e]));r([e,i.deps||[],i.exportsFn])}C()},nameToUrl:function(e,t,a){var o,i,n,r,s,l;if(h.jsExtRegExp.test(e))r=e+(t||"");else{for(o=M.paths,i=M.pkgs,s=(r=e.split("/")).length;0<s;s-=1){if(n=m(i,l=r.slice(0,s).join("/")),l=m(o,l)){K(l)&&(l=l[0]),r.splice(0,s,l);break}if(n){e=e===n.name?n.location+"/"+n.main:n.location,r.splice(0,s,e);break}}r=r.join("/"),r=("/"===(r+=t||(/\?/.test(r)||a?"":".js")).charAt(0)||r.match(/^[\w\+\.\-]+:/)?"":M.baseUrl)+r}return M.urlArgs?r+(-1===r.indexOf("?")?"?":"&")+M.urlArgs:r},load:function(e,t){h.load(D,e,t)},execCb:function(e,t,a,o){return t.apply(o,a)},onScriptLoad:function(e){("load"===e.type||la.test((e.currentTarget||e.srcElement).readyState))&&(R=null,e=a(e),D.completeLoad(e.id))},onScriptError:function(e){var t=a(e);if(!d(t.id))return y(B("scripterror","Script error for: "+t.id,e,[t.id]))}}).require=D.makeRequire(),D}var h,x,y,E,L,F,R,M,s,ga,ma=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,na=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,fa=/\.js$/,ka=/^\.\//;x=Object.prototype;var N=x.toString,ha=x.hasOwnProperty,ja=Array.prototype.splice,A=!("undefined"==typeof window||!navigator||!window.document),ea=!A&&"undefined"!=typeof importScripts,la=A&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,Z="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),G={},u={},U=[],Q=!1;if(void 0===define){if(void 0!==requirejs){if(J(requirejs))return;u=requirejs,requirejs=void 0}void 0!==require&&!J(require)&&(u=require,require=void 0),h=requirejs=function(e,t,a,o){var i,n="_";return!K(e)&&"string"!=typeof e&&(i=e,K(t)?(e=t,t=a,a=o):e=[]),i&&i.context&&(n=i.context),(o=m(G,n))||(o=G[n]=h.s.newContext(n)),i&&o.configure(i),o.require(e,t,a)},h.config=function(e){return h(e)},h.nextTick="undefined"!=typeof setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require||(require=h),h.version="2.1.6",h.jsExtRegExp=/^\/|:|\?|\.js$/,h.isBrowser=A,x=h.s={contexts:G,newContext:ia},h({}),z(["toUrl","undef","defined","specified"],function(t){h[t]=function(){var e=G._;return e.require[t].apply(e,arguments)}}),A&&(y=x.head=document.getElementsByTagName("head")[0],E=document.getElementsByTagName("base")[0])&&(y=x.head=E.parentNode),h.onError=ca,h.load=function(t,a,o){var e,i=t&&t.config||{};if(A)return(e=i.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script")).type=i.scriptType||"text/javascript",e.charset="utf-8",e.async=!0,e.setAttribute("data-requirecontext",t.contextName),e.setAttribute("data-requiremodule",a),!e.attachEvent||e.attachEvent.toString&&e.attachEvent.toString().indexOf("[native code")<0||Z?(e.addEventListener("load",t.onScriptLoad,!1),e.addEventListener("error",t.onScriptError,!1)):(Q=!0,e.attachEvent("onreadystatechange",t.onScriptLoad)),e.src=o,M=e,E?y.insertBefore(e,E):y.appendChild(e),M=null,e;if(ea)try{importScripts(o),t.completeLoad(a)}catch(e){t.onError(B("importscripts","importScripts failed for "+a+" at "+o,e,[a]))}},A&&O(document.getElementsByTagName("script"),function(e){if(y||(y=e.parentNode),L=e.getAttribute("data-main"))return s=L,u.baseUrl||(s=(F=s.split("/")).pop(),ga=F.length?F.join("/")+"/":"./",u.baseUrl=ga),s=s.replace(fa,""),h.jsExtRegExp.test(s)&&(s=L),u.deps=u.deps?u.deps.concat(s):[s],!0}),define=function(e,a,t){var o,i;"string"!=typeof e&&(t=a,a=e,e=null),K(a)||(t=a,a=null),!a&&J(t)&&(a=[],t.length&&(t.toString().replace(ma,"").replace(na,function(e,t){a.push(t)}),a=(1===t.length?["require"]:["require","exports","module"]).concat(a))),Q&&((o=M)||(R&&"interactive"===R.readyState||O(document.getElementsByTagName("script"),function(e){if("interactive"===e.readyState)return R=e}),o=R),o&&(e||(e=o.getAttribute("data-requiremodule")),i=G[o.getAttribute("data-requirecontext")])),(i?i.defQueue:U).push([e,a,t])},define.amd={jQuery:!0},h.exec=function(b){return eval(b)},h(u)}}(this),define("requireLib",function(){}),define("../JQueryUI/core",["jquery"],function(e){!function(s,e){var o,t,a=0,i=/^ui-id-\d+$/;function n(e,t){var a,o,i,n=e.nodeName.toLowerCase();return"area"===n?(o=(a=e.parentNode).name,!(!e.href||!o||"map"!==a.nodeName.toLowerCase())&&(!!(i=s("img[usemap=#"+o+"]")[0])&&r(i))):(/input|select|textarea|button|object/.test(n)?!e.disabled:"a"===n&&e.href||t)&&r(e)}function r(e){return s.expr.filters.visible(e)&&!s(e).parents().addBack().filter(function(){return"hidden"===s.css(this,"visibility")}).length}s.ui=s.ui||{},s.extend(s.ui,{version:"1.10.3",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),s.fn.extend({focus:(o=s.fn.focus,function(t,a){return"number"==typeof t?this.each(function(){var e=this;setTimeout(function(){s(e).focus(),a&&a.call(e)},t)}):o.apply(this,arguments)}),scrollParent:function(){var e;return e=s.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(s.css(this,"position"))&&/(auto|scroll)/.test(s.css(this,"overflow")+s.css(this,"overflow-y")+s.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(s.css(this,"overflow")+s.css(this,"overflow-y")+s.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!e.length?s(document):e},zIndex:function(e){if(void 0!==e)return this.css("zIndex",e);if(this.length)for(var t,a,o=s(this[0]);o.length&&o[0]!==document;){if(("absolute"===(t=o.css("position"))||"relative"===t||"fixed"===t)&&(a=parseInt(o.css("zIndex"),10),!isNaN(a)&&0!==a))return a;o=o.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++a)})},removeUniqueId:function(){return this.each(function(){i.test(this.id)&&s(this).removeAttr("id")})}}),s.extend(s.expr[":"],{data:s.expr.createPseudo?s.expr.createPseudo(function(t){return function(e){return!!s.data(e,t)}}):function(e,t,a){return!!s.data(e,a[3])},focusable:function(e){return n(e,!isNaN(s.attr(e,"tabindex")))},tabbable:function(e){var t=s.attr(e,"tabindex"),a=isNaN(t);return(a||0<=t)&&n(e,!a)}}),s("<a>").outerWidth(1).jquery||s.each(["Width","Height"],function(e,a){var i="Width"===a?["Left","Right"]:["Top","Bottom"],o=a.toLowerCase(),n={innerWidth:s.fn.innerWidth,innerHeight:s.fn.innerHeight,outerWidth:s.fn.outerWidth,outerHeight:s.fn.outerHeight};function r(e,t,a,o){return s.each(i,function(){t-=parseFloat(s.css(e,"padding"+this))||0,a&&(t-=parseFloat(s.css(e,"border"+this+"Width"))||0),o&&(t-=parseFloat(s.css(e,"margin"+this))||0)}),t}s.fn["inner"+a]=function(e){return void 0===e?n["inner"+a].call(this):this.each(function(){s(this).css(o,r(this,e)+"px")})},s.fn["outer"+a]=function(e,t){return"number"!=typeof e?n["outer"+a].call(this,e):this.each(function(){s(this).css(o,r(this,e,!0,t)+"px")})}}),s.fn.addBack||(s.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),s("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(s.fn.removeData=(t=s.fn.removeData,function(e){return arguments.length?t.call(this,s.camelCase(e)):t.call(this)})),s.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),s.support.selectstart="onselectstart"in document.createElement("div"),s.fn.extend({disableSelection:function(){return this.bind((s.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),s.extend(s.ui,{plugin:{add:function(e,t,a){var o,i=s.ui[e].prototype;for(o in a)i.plugins[o]=i.plugins[o]||[],i.plugins[o].push([t,a[o]])},call:function(e,t,a){var o,i=e.plugins[t];if(i&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(o=0;o<i.length;o++)e.options[i[o][0]]&&i[o][1].apply(e.element,a)}},hasScroll:function(e,t){if("hidden"===s(e).css("overflow"))return!1;var a,o=t&&"left"===t?"scrollLeft":"scrollTop";return 0<e[o]||(e[o]=1,a=0<e[o],e[o]=0,a)}})}(e)}),define("../JQueryUI/widget",["jquery"],function(e){var u,s,a,l,o;u=e,a=0,l=Array.prototype.slice,o=u.cleanData,u.cleanData=function(e){for(var t,a=0;null!=(t=e[a]);a++)try{u(t).triggerHandler("remove")}catch(e){}o(e)},u.widget=function(e,a,t){var o,i,n,r,s={},l=e.split(".")[0];e=e.split(".")[1],o=l+"-"+e,t||(t=a,a=u.Widget),u.expr[":"][o.toLowerCase()]=function(e){return!!u.data(e,o)},u[l]=u[l]||{},i=u[l][e],n=u[l][e]=function(e,t){if(!this._createWidget)return new n(e,t);arguments.length&&this._createWidget(e,t)},u.extend(n,i,{version:t.version,_proto:u.extend({},t),_childConstructors:[]}),(r=new a).options=u.widget.extend({},r.options),u.each(t,function(t,o){var i,n;u.isFunction(o)?s[t]=(i=function(){return a.prototype[t].apply(this,arguments)},n=function(e){return a.prototype[t].apply(this,e)},function(){var e,t=this._super,a=this._superApply;return this._super=i,this._superApply=n,e=o.apply(this,arguments),this._super=t,this._superApply=a,e}):s[t]=o}),n.prototype=u.widget.extend(r,{widgetEventPrefix:i?r.widgetEventPrefix:e},s,{constructor:n,namespace:l,widgetName:e,widgetFullName:o}),i?(u.each(i._childConstructors,function(e,t){var a=t.prototype;u.widget(a.namespace+"."+a.widgetName,n,t._proto)}),delete i._childConstructors):a._childConstructors.push(n),u.widget.bridge(e,n)},u.widget.extend=function(e){for(var t,a,o=l.call(arguments,1),i=0,n=o.length;i<n;i++)for(t in o[i])a=o[i][t],o[i].hasOwnProperty(t)&&a!==s&&(u.isPlainObject(a)?e[t]=u.isPlainObject(e[t])?u.widget.extend({},e[t],a):u.widget.extend({},a):e[t]=a);return e},u.widget.bridge=function(n,t){var r=t.prototype.widgetFullName||n;u.fn[n]=function(a){var e="string"==typeof a,o=l.call(arguments,1),i=this;return a=!e&&o.length?u.widget.extend.apply(null,[a].concat(o)):a,e?this.each(function(){var e,t=u.data(this,r);return t?u.isFunction(t[a])&&"_"!==a.charAt(0)?(e=t[a].apply(t,o))!==t&&e!==s?(i=e&&e.jquery?i.pushStack(e.get()):e,!1):void 0:u.error("no such method '"+a+"' for "+n+" widget instance"):u.error("cannot call methods on "+n+" prior to initialization; attempted to call method '"+a+"'")}):this.each(function(){var e=u.data(this,r);e?e.option(a||{})._init():u.data(this,r,new t(a,this))}),i}},u.Widget=function(){},u.Widget._childConstructors=[],u.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,t){t=u(t||this.defaultElement||this)[0],this.element=u(t),this.uuid=a++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=u.widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=u(),this.hoverable=u(),this.focusable=u(),t!==this&&(u.data(t,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===t&&this.destroy()}}),this.document=u(t.style?t.ownerDocument:t.document||t),this.window=u(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:u.noop,_getCreateEventData:u.noop,_create:u.noop,_init:u.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(u.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:u.noop,widget:function(){return this.element},option:function(e,t){var a,o,i,n=e;if(0===arguments.length)return u.widget.extend({},this.options);if("string"==typeof e)if(n={},e=(a=e.split(".")).shift(),a.length){for(o=n[e]=u.widget.extend({},this.options[e]),i=0;i<a.length-1;i++)o[a[i]]=o[a[i]]||{},o=o[a[i]];if(e=a.pop(),t===s)return o[e]===s?null:o[e];o[e]=t}else{if(t===s)return this.options[e]===s?null:this.options[e];n[e]=t}return this._setOptions(n),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(r,s,e){var l,c=this;"boolean"!=typeof r&&(e=s,s=r,r=!1),e?(s=l=u(s),this.bindings=this.bindings.add(s)):(e=s,s=this.element,l=this.widget()),u.each(e,function(e,t){function a(){if(r||!0!==c.options.disabled&&!u(this).hasClass("ui-state-disabled"))return("string"==typeof t?c[t]:t).apply(c,arguments)}"string"!=typeof t&&(a.guid=t.guid=t.guid||a.guid||u.guid++);var o=e.match(/^(\w+)\s*(.*)$/),i=o[1]+c.eventNamespace,n=o[2];n?l.delegate(n,i,a):s.bind(i,a)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){var a=this;return setTimeout(function(){return("string"==typeof e?a[e]:e).apply(a,arguments)},t||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){u(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){u(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){u(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){u(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,t,a){var o,i,n=this.options[e];if(a=a||{},(t=u.Event(t)).type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),t.target=this.element[0],i=t.originalEvent)for(o in i)o in t||(t[o]=i[o]);return this.element.trigger(t,a),!(u.isFunction(n)&&!1===n.apply(this.element[0],[t].concat(a))||t.isDefaultPrevented())}},u.each({show:"fadeIn",hide:"fadeOut"},function(n,r){u.Widget.prototype["_"+n]=function(t,e,a){"string"==typeof e&&(e={effect:e});var o,i=e?!0===e||"number"==typeof e?r:e.effect||r:n;"number"==typeof(e=e||{})&&(e={duration:e}),o=!u.isEmptyObject(e),e.complete=a,e.delay&&t.delay(e.delay),o&&u.effects&&u.effects.effect[i]?t[n](e):i!==n&&t[i]?t[i](e.duration,e.easing,a):t.queue(function(e){u(this)[n](),a&&a.call(t[0]),e()})}})}),define("../JQueryUI/position",["jquery"],function(e){!function(C,e){C.ui=C.ui||{};var i,x=Math.max,w=Math.abs,A=Math.round,o=/left|center|right/,n=/top|center|bottom/,r=/[\+\-]\d+(\.[\d]+)?%?/,s=/^\w+/,l=/%$/,c=C.fn.position;function D(e,t,a){return[parseFloat(e[0])*(l.test(e[0])?t/100:1),parseFloat(e[1])*(l.test(e[1])?a/100:1)]}function S(e,t){return parseInt(C.css(e,t),10)||0}C.position={scrollbarWidth:function(){if(void 0!==i)return i;var e,t,a=C("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=a.children()[0];return C("body").append(a),e=o.offsetWidth,a.css("overflow","scroll"),e===(t=o.offsetWidth)&&(t=a[0].clientWidth),a.remove(),i=e-t},getScrollInfo:function(e){var t=e.isWindow?"":e.element.css("overflow-x"),a=e.isWindow?"":e.element.css("overflow-y"),o="scroll"===t||"auto"===t&&e.width<e.element[0].scrollWidth;return{width:"scroll"===a||"auto"===a&&e.height<e.element[0].scrollHeight?C.position.scrollbarWidth():0,height:o?C.position.scrollbarWidth():0}},getWithinInfo:function(e){var t=C(e||window),a=C.isWindow(t[0]);return{element:t,isWindow:a,offset:t.offset()||{left:0,top:0},scrollLeft:t.scrollLeft(),scrollTop:t.scrollTop(),width:a?t.width():t.outerWidth(),height:a?t.height():t.outerHeight()}}},C.fn.position=function(p){if(!p||!p.of)return c.apply(this,arguments);p=C.extend({},p);var d,m,h,f,g,e,t,a,v=C(p.of),_=C.position.getWithinInfo(p.within),y=C.position.getScrollInfo(_),k=(p.collision||"flip").split(" "),b={};return e=9===(a=(t=v)[0]).nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:C.isWindow(a)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:a.preventDefault?{width:0,height:0,offset:{top:a.pageY,left:a.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()},v[0].preventDefault&&(p.at="left top"),m=e.width,h=e.height,f=e.offset,g=C.extend({},f),C.each(["my","at"],function(){var e,t,a=(p[this]||"").split(" ");1===a.length&&(a=o.test(a[0])?a.concat(["center"]):n.test(a[0])?["center"].concat(a):["center","center"]),a[0]=o.test(a[0])?a[0]:"center",a[1]=n.test(a[1])?a[1]:"center",e=r.exec(a[0]),t=r.exec(a[1]),b[this]=[e?e[0]:0,t?t[0]:0],p[this]=[s.exec(a[0])[0],s.exec(a[1])[0]]}),1===k.length&&(k[1]=k[0]),"right"===p.at[0]?g.left+=m:"center"===p.at[0]&&(g.left+=m/2),"bottom"===p.at[1]?g.top+=h:"center"===p.at[1]&&(g.top+=h/2),d=D(b.at,m,h),g.left+=d[0],g.top+=d[1],this.each(function(){var a,e,r=C(this),s=r.outerWidth(),l=r.outerHeight(),t=S(this,"marginLeft"),o=S(this,"marginTop"),i=s+t+S(this,"marginRight")+y.width,n=l+o+S(this,"marginBottom")+y.height,c=C.extend({},g),u=D(b.my,r.outerWidth(),r.outerHeight());"right"===p.my[0]?c.left-=s:"center"===p.my[0]&&(c.left-=s/2),"bottom"===p.my[1]?c.top-=l:"center"===p.my[1]&&(c.top-=l/2),c.left+=u[0],c.top+=u[1],C.support.offsetFractions||(c.left=A(c.left),c.top=A(c.top)),a={marginLeft:t,marginTop:o},C.each(["left","top"],function(e,t){C.ui.position[k[e]]&&C.ui.position[k[e]][t](c,{targetWidth:m,targetHeight:h,elemWidth:s,elemHeight:l,collisionPosition:a,collisionWidth:i,collisionHeight:n,offset:[d[0]+u[0],d[1]+u[1]],my:p.my,at:p.at,within:_,elem:r})}),p.using&&(e=function(e){var t=f.left-c.left,a=t+m-s,o=f.top-c.top,i=o+h-l,n={target:{element:v,left:f.left,top:f.top,width:m,height:h},element:{element:r,left:c.left,top:c.top,width:s,height:l},horizontal:a<0?"left":0<t?"right":"center",vertical:i<0?"top":0<o?"bottom":"middle"};m<s&&w(t+a)<m&&(n.horizontal="center"),h<l&&w(o+i)<h&&(n.vertical="middle"),x(w(t),w(a))>x(w(o),w(i))?n.important="horizontal":n.important="vertical",p.using.call(this,e,n)}),r.offset(C.extend(c,{using:e}))})},C.ui.position={fit:{left:function(e,t){var a,o=t.within,i=o.isWindow?o.scrollLeft:o.offset.left,n=o.width,r=e.left-t.collisionPosition.marginLeft,s=i-r,l=r+t.collisionWidth-n-i;t.collisionWidth>n?0<s&&l<=0?(a=e.left+s+t.collisionWidth-n-i,e.left+=s-a):e.left=0<l&&s<=0?i:l<s?i+n-t.collisionWidth:i:0<s?e.left+=s:0<l?e.left-=l:e.left=x(e.left-r,e.left)},top:function(e,t){var a,o=t.within,i=o.isWindow?o.scrollTop:o.offset.top,n=t.within.height,r=e.top-t.collisionPosition.marginTop,s=i-r,l=r+t.collisionHeight-n-i;t.collisionHeight>n?0<s&&l<=0?(a=e.top+s+t.collisionHeight-n-i,e.top+=s-a):e.top=0<l&&s<=0?i:l<s?i+n-t.collisionHeight:i:0<s?e.top+=s:0<l?e.top-=l:e.top=x(e.top-r,e.top)}},flip:{left:function(e,t){var a,o,i=t.within,n=i.offset.left+i.scrollLeft,r=i.width,s=i.isWindow?i.scrollLeft:i.offset.left,l=e.left-t.collisionPosition.marginLeft,c=l-s,u=l+t.collisionWidth-r-s,p="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,d="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,m=-2*t.offset[0];c<0?((a=e.left+p+d+m+t.collisionWidth-r-n)<0||a<w(c))&&(e.left+=p+d+m):0<u&&(0<(o=e.left-t.collisionPosition.marginLeft+p+d+m-s)||w(o)<u)&&(e.left+=p+d+m)},top:function(e,t){var a,o,i=t.within,n=i.offset.top+i.scrollTop,r=i.height,s=i.isWindow?i.scrollTop:i.offset.top,l=e.top-t.collisionPosition.marginTop,c=l-s,u=l+t.collisionHeight-r-s,p="top"===t.my[1]?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,d="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,m=-2*t.offset[1];c<0?(o=e.top+p+d+m+t.collisionHeight-r-n,e.top+p+d+m>c&&(o<0||o<w(c))&&(e.top+=p+d+m)):0<u&&(a=e.top-t.collisionPosition.marginTop+p+d+m-s,e.top+p+d+m>u&&(0<a||w(a)<u)&&(e.top+=p+d+m))}},flipfit:{left:function(){C.ui.position.flip.left.apply(this,arguments),C.ui.position.fit.left.apply(this,arguments)},top:function(){C.ui.position.flip.top.apply(this,arguments),C.ui.position.fit.top.apply(this,arguments)}}},function(){var e,t,a,o,i,n=document.getElementsByTagName("body")[0],r=document.createElement("div");for(i in e=document.createElement(n?"div":"body"),a={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},n&&C.extend(a,{position:"absolute",left:"-1000px",top:"-1000px"}),a)e.style[i]=a[i];e.appendChild(r),(t=n||document.documentElement).insertBefore(e,t.firstChild),r.style.cssText="position: absolute; left: 10.7432222px;",o=C(r).offset().left,C.support.offsetFractions=10<o&&o<11,e.innerHTML="",t.removeChild(e)}()}(e)}),define("../JQueryUI/menu",["jquery","./core","./widget","./position"],function(e){var l;(l=e).widget("ui.menu",{version:"1.10.3",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,l.proxy(function(e){this.options.disabled&&e.preventDefault()},this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(e){e.preventDefault()},"click .ui-state-disabled > a":function(e){e.preventDefault()},"click .ui-menu-item:has(a)":function(e){var t=l(e.target).closest(".ui-menu-item");!this.mouseHandled&&t.not(".ui-state-disabled").length&&(this.mouseHandled=!0,this.select(e),t.has(".ui-menu").length?this.expand(e):this.element.is(":focus")||(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(e){var t=l(e.currentTarget);t.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(e,t)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var a=this.active||this.element.children(".ui-menu-item").eq(0);t||this.focus(e,a)},blur:function(e){this._delay(function(){l.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(e)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(e){l(e.target).closest(".ui-menu").length||this.collapseAll(e),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var e=l(this);e.data("ui-menu-submenu-carat")&&e.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(e){var t,a,o,i,n,r=!0;function s(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}switch(e.keyCode){case l.ui.keyCode.PAGE_UP:this.previousPage(e);break;case l.ui.keyCode.PAGE_DOWN:this.nextPage(e);break;case l.ui.keyCode.HOME:this._move("first","first",e);break;case l.ui.keyCode.END:this._move("last","last",e);break;case l.ui.keyCode.UP:this.previous(e);break;case l.ui.keyCode.DOWN:this.next(e);break;case l.ui.keyCode.LEFT:this.collapse(e);break;case l.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(e);break;case l.ui.keyCode.ENTER:case l.ui.keyCode.SPACE:this._activate(e);break;case l.ui.keyCode.ESCAPE:this.collapse(e);break;default:r=!1,a=this.previousFilter||"",o=String.fromCharCode(e.keyCode),i=!1,clearTimeout(this.filterTimer),o===a?i=!0:o=a+o,n=new RegExp("^"+s(o),"i"),t=this.activeMenu.children(".ui-menu-item").filter(function(){return n.test(l(this).children("a").text())}),(t=i&&-1!==t.index(this.active.next())?this.active.nextAll(".ui-menu-item"):t).length||(o=String.fromCharCode(e.keyCode),n=new RegExp("^"+s(o),"i"),t=this.activeMenu.children(".ui-menu-item").filter(function(){return n.test(l(this).children("a").text())})),t.length?(this.focus(e,t),1<t.length?(this.previousFilter=o,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter):delete this.previousFilter}r&&e.preventDefault()},_activate:function(e){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(e):this.select(e))},refresh:function(){var e,o=this.options.icons.submenu,t=this.element.find(this.options.menus);t.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var e=l(this),t=e.prev("a"),a=l("<span>").addClass("ui-menu-icon ui-icon "+o).data("ui-menu-submenu-carat",!0);t.attr("aria-haspopup","true").prepend(a),e.attr("aria-labelledby",t.attr("id"))}),(e=t.add(this.element)).children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),e.children(":not(.ui-menu-item)").each(function(){var e=l(this);/[^\-\u2014\u2013\s]/.test(e.text())||e.addClass("ui-widget-content ui-menu-divider")}),e.children(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!l.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(e,t){"icons"===e&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(t.submenu),this._super(e,t)},focus:function(e,t){var a,o;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),o=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",o.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),e&&"keydown"===e.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),(a=t.children(".ui-menu")).length&&/^mouse/.test(e.type)&&this._startOpening(a),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(e){var t,a,o,i,n,r;this._hasScroll()&&(t=parseFloat(l.css(this.activeMenu[0],"borderTopWidth"))||0,a=parseFloat(l.css(this.activeMenu[0],"paddingTop"))||0,o=e.offset().top-this.activeMenu.offset().top-t-a,i=this.activeMenu.scrollTop(),n=this.activeMenu.height(),r=e.height(),o<0?this.activeMenu.scrollTop(i+o):n<o+r&&this.activeMenu.scrollTop(i+o-n+r))},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active}))},_startOpening:function(e){clearTimeout(this.timer),"true"===e.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(e)},this.delay))},_open:function(e){var t=l.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden","true"),e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(t)},collapseAll:function(t,a){clearTimeout(this.timer),this.timer=this._delay(function(){var e=a?this.element:l(t&&t.target).closest(this.element.find(".ui-menu"));e.length||(e=this.element),this._close(e),this.blur(t),this.activeMenu=e},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,a){var o;this.active&&(o="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[e+"All"](".ui-menu-item").eq(0)),o&&o.length&&this.active||(o=this.activeMenu.children(".ui-menu-item")[t]()),this.focus(a,o)},nextPage:function(e){var t,a,o;this.active?this.isLastItem()||(this._hasScroll()?(a=this.active.offset().top,o=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return(t=l(this)).offset().top-a-o<0}),this.focus(e,t)):this.focus(e,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]())):this.next(e)},previousPage:function(e){var t,a,o;this.active?this.isFirstItem()||(this._hasScroll()?(a=this.active.offset().top,o=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return 0<(t=l(this)).offset().top-a+o}),this.focus(e,t)):this.focus(e,this.activeMenu.children(".ui-menu-item").first())):this.next(e)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||l(e.target).closest(".ui-menu-item");var t={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(e,!0),this._trigger("select",e,t)}})}),define("../JQueryUI/autocomplete",["jquery","./core","./widget","./position","./menu"],function(e){var r,o;o=0,(r=e).widget("ui.autocomplete",{version:"1.10.3",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},pending:0,_create:function(){var a,o,i,e=this.element[0].nodeName.toLowerCase(),t="textarea"===e,n="input"===e;this.isMultiLine=!!t||!n&&this.element.prop("isContentEditable"),this.valueMethod=this.element[t||n?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(e){if(this.element.prop("readOnly"))o=i=a=!0;else{o=i=a=!1;var t=r.ui.keyCode;switch(e.keyCode){case t.PAGE_UP:a=!0,this._move("previousPage",e);break;case t.PAGE_DOWN:a=!0,this._move("nextPage",e);break;case t.UP:a=!0,this._keyEvent("previous",e);break;case t.DOWN:a=!0,this._keyEvent("next",e);break;case t.ENTER:case t.NUMPAD_ENTER:this.menu.active&&(a=!0,e.preventDefault(),this.menu.select(e));break;case t.TAB:this.menu.active&&this.menu.select(e);break;case t.ESCAPE:this.menu.element.is(":visible")&&(this._value(this.term),this.close(e),e.preventDefault());break;default:o=!0,this._searchTimeout(e)}}},keypress:function(e){if(a)return a=!1,void(this.isMultiLine&&!this.menu.element.is(":visible")||e.preventDefault());if(!o){var t=r.ui.keyCode;switch(e.keyCode){case t.PAGE_UP:this._move("previousPage",e);break;case t.PAGE_DOWN:this._move("nextPage",e);break;case t.UP:this._keyEvent("previous",e);break;case t.DOWN:this._keyEvent("next",e)}}},input:function(e){if(i)return i=!1,void e.preventDefault();this._searchTimeout(e)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){this.cancelBlur?delete this.cancelBlur:(clearTimeout(this.searching),this.close(e),this._change(e))}}),this._initSource(),this.menu=r("<ul>").addClass("ui-autocomplete ui-front ui-PT-autocomplete").appendTo(this._appendTo()).menu({role:null}).hide().data("ui-menu"),this._on(this.menu.element,{mousedown:function(e){e.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var a=this.menu.element[0];r(e.target).closest(".ui-menu-item").length||this._delay(function(){var t=this;this.document.one("mousedown",function(e){e.target===t.element[0]||e.target===a||r.contains(a,e.target)||t.close()})})},menufocus:function(e,t){if(this.isNewMenu&&(this.isNewMenu=!1,e.originalEvent&&/^mouse/.test(e.originalEvent.type)))return this.menu.blur(),void this.document.one("mousemove",function(){r(e.target).trigger(e.originalEvent)});var a=t.item.data("ui-autocomplete-item");!1!==this._trigger("focus",e,{item:a})?e.originalEvent&&/^key/.test(e.originalEvent.type)&&this._value(a.value):this.liveRegion.text(a.value)},menuselect:function(e,t){var a=t.item.data("ui-autocomplete-item"),o=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=o,this._delay(function(){this.previous=o,this.selectedItem=a})),!1!==this._trigger("select",e,{item:a})&&this._value(a.value),this.term=this._value(),this.close(e),this.selectedItem=a}}),this.liveRegion=r("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertBefore(this.element),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this._appendTo()),"disabled"===e&&t&&this.xhr&&this.xhr.abort()},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?r(e):this.document.find(e).eq(0)),e||(e=this.element.closest(".ui-front")),e.length||(e=this.document[0].body),e},_initSource:function(){var a,o,i=this;r.isArray(this.options.source)?(a=this.options.source,this.source=function(e,t){t(r.ui.autocomplete.filter(a,e.term))}):"string"==typeof this.options.source?(o=this.options.source,this.source=function(e,t){i.xhr&&i.xhr.abort(),i.xhr=r.ajax({url:o,data:e,dataType:"json",success:function(e){t(e)},error:function(){t([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){this.term!==this._value()&&(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):!1!==this._trigger("search",t)?this._search(e):void 0},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var t=this,a=++o;return function(e){a===o&&t.__response(e),t.pending--,t.pending||t.element.removeClass("ui-autocomplete-loading")}},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(e){return e.length&&e[0].label&&e[0].value?e:r.map(e,function(e){return"string"==typeof e?{label:e,value:e}:r.extend({label:e.label||e.value,value:e.value||e.label},e)})},_suggest:function(e){var t=this.menu.element.empty();this._renderMenu(t,e),this.isNewMenu=!0,this.menu.refresh(),t.show(),this._resizeMenu(),t.position(r.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(a,e){var o=this;r.each(e,function(e,t){o._renderItemData(a,t)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(e,t){return r("<li>").append(r("<a>").text(t.label)).appendTo(e)},_move:function(e,t){if(this.menu.element.is(":visible"))return this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this._value(this.term),void this.menu.blur()):void this.menu[e](t);this.search(null,t)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){this.isMultiLine&&!this.menu.element.is(":visible")||(this._move(e,t),t.preventDefault())}}),r.extend(r.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(e,t){var a=new RegExp(r.ui.autocomplete.escapeRegex(t),"i");return r.grep(e,function(e){return a.test(e.label||e.value||e)})}}),r.widget("ui.autocomplete",r.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(1<e?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var t;this._superApply(arguments),this.options.disabled||this.cancelSearch||(t=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.text(t))}})}),define("../Common/autocomplete",["jquery","../JQueryUI/autocomplete"],function(d,e){return function(e){var l=d.extend({},{minLength:3,isNotAsync:!1,autoFocus:!0,dataType:"jsonp",createAltField:!0,mandatory:!1,errors:{},sliceSize:15,selected:!1},e),o=[9,13,27,32],n=function(e){return e.toLowerCase().replace(/á/gi,"a").replace(/é/gi,"e").replace(/í/gi,"i").replace(/ó/gi,"o").replace(/ú/gi,"u")},a=function(e){return null!=l.queryName&&(l.data[l.queryName]=e),d.ajax({url:l.uri+("jsonp"==l.dataType?"?jsoncallback=?":""),dataType:l.dataType,data:l.data})},c=function(e){return null!=l.mapping?(e.altValue="",l.mapping(e)):null},u=function(e,t){1==t&&d(l.selector).val(e.item.label),l.altSelector=l.altSelector||l.selector+"_hidden",d(l.altSelector).val(e.item.altValue).trigger("change"),null!=l.onSelectCallback&&l.onSelectCallback(e,l.selector),l.selected=!0},p=function(i){var e=d(l.selector).autocomplete({source:"function"==typeof i?i:function(e,t){var a=new RegExp(d.ui.autocomplete.escapeRegex(e.term),"i"),o=d.grep(i,function(e){return e=e.label||e.value||e,a.test(e)||a.test(n(e))});t(0<l.sliceSize?o.slice(0,l.sliceSize):o)},minLength:l.minLength,autoFocus:l.autoFocus,select:function(e,t){u(t)},create:function(e,t){d(".ui-PT-autocomplete").each(function(){var e=d(this).attr("id");0==d("#"+e).parent(".pt-customJqueryUi").length&&(0==d(".pt-customJqueryUi").length?d("#"+e).wrap("<div class='pt-customJqueryUi' />"):d(".pt-customJqueryUi").append(d("#"+e)))})}});return 1==l.mandatory&&d(l.selector).on("autocompletechange",function(e,t){null!=t.item&&null!=t.item||d(l.selector).val("")}),e},t=function(){d(l.selector).bind("keyup",function(e){for(var t=!0,a=0;a<o.length;a++)if(e.keyCode===o[a]){t=!1;break}t&&(""!=d(l.altSelector).val()&&1!=l.selected&&(d(l.altSelector).val(""),null!=l.onClear&&l.onClear()),l.selected=!1)})},i=function(){return l.altSelector||l.selector+"_hidden"};return{init:function(){l.altSelector=i(),1==l.createAltField&&0==d(l.altSelector).length&&d("<input/>",{type:"hidden",id:l.altSelector.replace(/(\B)(#|\.)(\w+)\b/g,"$3")}).insertBefore(l.selector),t();var r,s=new d.Deferred;return null!=l.source&&l.source!=[]&&null!=l.source?(l.minLength=0,r=p(l.source),s.resolve(r),s.done(function(t){t.click(function(){var e={minLength:0,source:function(e,t){var a=new RegExp(d.ui.autocomplete.escapeRegex(e.term),"i"),o=d.grep(l.source,function(e){return e=e.label||e.value||e,a.test(e)||a.test(n(e))});t(0<l.sliceSize?o.slice(0,l.sliceSize):o)},search:function(e,t){}};t.autocomplete(e).autocomplete("search","")})})):1==l.isNotAsync?(a("").done(function(e){var t=d.map(e,function(e){return c(e)});if(l.minLength=0,r=p(t),1==t.length){var a={item:t[0]};u(a,!0)}else if(d(l.altSelector).length)for(var o=d(l.altSelector).val(),i=0;i<t.length;i++){var n={item:t[i]};n.item.altValue===o&&u(n,!0)}s.resolve(r)}),s.done(function(e){e.click(function(){e.autocomplete("search","")})})):(r=p(function(e,t){a(e.term).done(function(e){t(d.map(e,function(e){return c(e)}))})}),s.resolve(r)),s.promise()},fill:function(e){var t=d.trim(d(l.selector).val()),a=d.trim(d(l.altSelector).val()),o=new d.Deferred;return e.revalidate=e.revalidate||!0,l.data[l.queryName]=function(){return d(l.selector).val()},1==e.revalidate&&""!=t&&(""==a||"0"==a)||1==e.forceRevalidation?d.ajax({url:e.revalidateUri+("jsonp"==l.dataType?"?jsoncallback=?":""),dataType:l.dataType,data:l.data}).done(function(e){o.resolve(e,l.selector,l.altSelector)}):o.resolve(),o.promise()},validate:function(e){var t=new d.Deferred,a=d.trim(d(l.selector).val()),o=d.trim(d(l.altSelector).val()),i=[],n=!1;return d(l.selector).removeClass(e.errorClass),""==a&&(e.validateEmpty,1)&&(i.push({key:l.selector,value:l.errors.empty}),n=!0),""==o&&(i.push({key:l.selector,value:l.errors.invalid}),n=!0),n&&d(l.selector).addClass(e.errorClass),e.onEndValidationCallback&&e.onEndValidationCallback(l.selector,l.altSelector),t.resolve(i),t.promise()},getAltSelector:i}}}),define("localization",[],function(){return{es:{closeText:"Cerrar",prevText:"&#x3c;Ant",nextText:"Sig&#x3e;",currentText:"Hoy",monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthNamesShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayNames:["Domingo","Lunes","Martes","Mi&eacute;rcoles","Jueves","Viernes","S&aacute;bado"],dayNamesShort:["Dom","Lun","Mar","Mi&eacute;","Juv","Vie","S&aacute;b"],dayNamesMin:["Do","Lu","Ma","Mi","Ju","Vi","S&aacute;"],weekHeader:"Sm",dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},"pt-BR":{closeText:"Fechar",prevText:"&#x3C;Anterior",nextText:"Pr&oacute;ximo&#x3E;",currentText:"Hoje",monthNames:["Janeiro","Fevereiro","Mar&ccedil;o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],monthNamesShort:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],dayNames:["Domingo","Segunda-feira","Ter&ccedil;a-feira","Quarta-feira","Quinta-feira","Sexta-feira","S&aacute;bado"],dayNamesShort:["Dom","Seg","Ter","Qua","Qui","Sex","S&aacute;b"],dayNamesMin:["Dom","Seg","Ter","Qua","Qui","Sex","S&aacute;b"],weekHeader:"Sm",dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""}}}),define("../JQueryUI/datepicker",["jquery","./core"],function(e){!function(x,l){x.extend(x.ui,{datepicker:{version:"1.10.3"}});var i,p="datepicker";function e(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ptw-ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},x.extend(this._defaults,this.regional[""]),this.dpDiv=a(x("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function a(e){var t="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.delegate(t,"mouseout",function(){x(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&x(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&x(this).removeClass("ui-datepicker-next-hover")}).delegate(t,"mouseover",function(){x.datepicker._isDisabledDatepicker(i.inline?e.parent()[0]:i.input[0])||(x(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),x(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&x(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&x(this).addClass("ui-datepicker-next-hover"))})}function d(e,t){for(var a in x.extend(e,t),t)null==t[a]&&(e[a]=t[a]);return e}x.extend(e.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return d(this._defaults,e||{}),this},_attachDatepicker:function(e,t){var a,o,i;o="div"===(a=e.nodeName.toLowerCase())||"span"===a,e.id||(this.uuid+=1,e.id="dp"+this.uuid),(i=this._newInst(x(e),o)).settings=x.extend({},t||{}),"input"===a?this._connectDatepicker(e,i):o&&this._inlineDatepicker(e,i)},_newInst:function(e,t){return{id:e[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1"),input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:t,dpDiv:t?a(x("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(e,t){var a=x(e);t.append=x([]),t.trigger=x([]),a.hasClass(this.markerClassName)||(this._attachments(a,t),a.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(t),x.data(e,p,t),t.settings.disabled&&this._disableDatepicker(e))},_attachments:function(e,t){var a,o,i,n=this._get(t,"appendText"),r=this._get(t,"isRTL");t.append&&t.append.remove(),n&&(t.append=x("<span class='"+this._appendClass+"'>"+n+"</span>"),e[r?"before":"after"](t.append)),e.unbind("focus",this._showDatepicker),t.trigger&&t.trigger.remove(),"focus"!==(a=this._get(t,"showOn"))&&"both"!==a||e.focus(this._showDatepicker),"button"!==a&&"both"!==a||(o=this._get(t,"buttonText"),i=this._get(t,"buttonImage"),t.trigger=x(this._get(t,"buttonImageOnly")?x("<img/>").addClass(this._triggerClass).attr({src:i,alt:o,title:o}):x("<button type='button'></button>").addClass(this._triggerClass).html(i?x("<img/>").attr({src:i,alt:o,title:o}):o)),e[r?"before":"after"](t.trigger),t.trigger.click(function(){x.datepicker._datepickerShowing&&x.datepicker._lastInput===e[0]?x.datepicker._hideDatepicker():(x.datepicker._datepickerShowing&&x.datepicker._lastInput!==e[0]&&x.datepicker._hideDatepicker(),x.datepicker._showDatepicker(e[0]))}))},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t,a,o,i,n=new Date(2009,11,20),r=this._get(e,"dateFormat");r.match(/[DM]/)&&(t=function(e){for(i=o=a=0;i<e.length;i++)e[i].length>a&&(a=e[i].length,o=i);return o},n.setMonth(t(this._get(e,r.match(/MM/)?"monthNames":"monthNamesShort"))),n.setDate(t(this._get(e,r.match(/DD/)?"dayNames":"dayNamesShort"))+20-n.getDay())),e.input.attr("size",this._formatDate(e,n).length)}},_inlineDatepicker:function(e,t){var a=x(e);a.hasClass(this.markerClassName)||(a.addClass(this.markerClassName).append(t.dpDiv),x.data(e,p,t),this._setDate(t,this._getDefaultDate(t),!0),this._updateDatepicker(t),this._updateAlternate(t),t.settings.disabled&&this._disableDatepicker(e),t.dpDiv.css("display","block"))},_dialogDatepicker:function(e,t,a,o,i){var n,r,s,l,c,u=this._dialogInst;return u||(this.uuid+=1,n="dp"+this.uuid,this._dialogInput=x("<input type='text' id='"+n+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),x("body").append(this._dialogInput),(u=this._dialogInst=this._newInst(this._dialogInput,!1)).settings={},x.data(this._dialogInput[0],p,u)),d(u.settings,o||{}),t=t&&t.constructor===Date?this._formatDate(u,t):t,this._dialogInput.val(t),this._pos=i?i.length?i:[i.pageX,i.pageY]:null,this._pos||(r=document.documentElement.clientWidth,s=document.documentElement.clientHeight,l=document.documentElement.scrollLeft||document.body.scrollLeft,c=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[r/2-100+l,s/2-150+c]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),u.settings.onSelect=a,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),x.blockUI&&x.blockUI(this.dpDiv),x.data(this._dialogInput[0],p,u),this},_destroyDatepicker:function(e){var t,a=x(e),o=x.data(e,p);a.hasClass(this.markerClassName)&&(t=e.nodeName.toLowerCase(),x.removeData(e,p),"input"===t?(o.append.remove(),o.trigger.remove(),a.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):"div"!==t&&"span"!==t||a.removeClass(this.markerClassName).empty())},_enableDatepicker:function(t){var e,a,o=x(t),i=x.data(t,p);o.hasClass(this.markerClassName)&&("input"===(e=t.nodeName.toLowerCase())?(t.disabled=!1,i.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):"div"!==e&&"span"!==e||((a=o.children("."+this._inlineClass)).children().removeClass("ui-state-disabled"),a.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=x.map(this._disabledInputs,function(e){return e===t?null:e}))},_disableDatepicker:function(t){var e,a,o=x(t),i=x.data(t,p);o.hasClass(this.markerClassName)&&("input"===(e=t.nodeName.toLowerCase())?(t.disabled=!0,i.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):"div"!==e&&"span"!==e||((a=o.children("."+this._inlineClass)).children().addClass("ui-state-disabled"),a.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=x.map(this._disabledInputs,function(e){return e===t?null:e}),this._disabledInputs[this._disabledInputs.length]=t)},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;t<this._disabledInputs.length;t++)if(this._disabledInputs[t]===e)return!0;return!1},_getInst:function(e){try{return x.data(e,p)}catch(e){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(e,t,a){var o,i,n,r,s=this._getInst(e);if(2===arguments.length&&"string"==typeof t)return"defaults"===t?x.extend({},x.datepicker._defaults):s?"all"===t?x.extend({},s.settings):this._get(s,t):null;o=t||{},"string"==typeof t&&((o={})[t]=a),s&&(this._curInst===s&&this._hideDatepicker(),i=this._getDateDatepicker(e,!0),n=this._getMinMaxDate(s,"min"),r=this._getMinMaxDate(s,"max"),d(s.settings,o),null!==n&&o.dateFormat!==l&&o.minDate===l&&(s.settings.minDate=this._formatDate(s,n)),null!==r&&o.dateFormat!==l&&o.maxDate===l&&(s.settings.maxDate=this._formatDate(s,r)),"disabled"in o&&(o.disabled?this._disableDatepicker(e):this._enableDatepicker(e)),this._attachments(x(e),s),this._autoSize(s),this._setDate(s,i),this._updateAlternate(s),this._updateDatepicker(s))},_changeDatepicker:function(e,t,a){this._optionDatepicker(e,t,a)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var a=this._getInst(e);a&&(this._setDate(a,t),this._updateDatepicker(a),this._updateAlternate(a))},_getDateDatepicker:function(e,t){var a=this._getInst(e);return a&&!a.inline&&this._setDateFromField(a,t),a?this._getDate(a):null},_doKeyDown:function(e){var t,a,o,i=x.datepicker._getInst(e.target),n=!0,r=i.dpDiv.is(".ui-datepicker-rtl");if(i._keyEvent=!0,x.datepicker._datepickerShowing)switch(e.keyCode){case 9:x.datepicker._hideDatepicker(),n=!1;break;case 13:return(o=x("td."+x.datepicker._dayOverClass+":not(."+x.datepicker._currentClass+")",i.dpDiv))[0]&&x.datepicker._selectDay(e.target,i.selectedMonth,i.selectedYear,o[0]),(t=x.datepicker._get(i,"onSelect"))?(a=x.datepicker._formatDate(i),t.apply(i.input?i.input[0]:null,[a,i])):x.datepicker._hideDatepicker(),!1;case 27:x.datepicker._hideDatepicker();break;case 33:x.datepicker._adjustDate(e.target,e.ctrlKey?-x.datepicker._get(i,"stepBigMonths"):-x.datepicker._get(i,"stepMonths"),"M");break;case 34:x.datepicker._adjustDate(e.target,e.ctrlKey?+x.datepicker._get(i,"stepBigMonths"):+x.datepicker._get(i,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&x.datepicker._clearDate(e.target),n=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&x.datepicker._gotoToday(e.target),n=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&x.datepicker._adjustDate(e.target,r?1:-1,"D"),n=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&x.datepicker._adjustDate(e.target,e.ctrlKey?-x.datepicker._get(i,"stepBigMonths"):-x.datepicker._get(i,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&x.datepicker._adjustDate(e.target,-7,"D"),n=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&x.datepicker._adjustDate(e.target,r?-1:1,"D"),n=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&x.datepicker._adjustDate(e.target,e.ctrlKey?+x.datepicker._get(i,"stepBigMonths"):+x.datepicker._get(i,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&x.datepicker._adjustDate(e.target,7,"D"),n=e.ctrlKey||e.metaKey;break;default:n=!1}else 36===e.keyCode&&e.ctrlKey?x.datepicker._showDatepicker(this):n=!1;n&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(e){var t,a,o=x.datepicker._getInst(e.target);if(x.datepicker._get(o,"constrainInput"))return t=x.datepicker._possibleChars(x.datepicker._get(o,"dateFormat")),a=String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),e.ctrlKey||e.metaKey||a<" "||!t||-1<t.indexOf(a)},_doKeyUp:function(e){var t=x.datepicker._getInst(e.target);if(t.input.val()!==t.lastVal)try{x.datepicker.parseDate(x.datepicker._get(t,"dateFormat"),t.input?t.input.val():null,x.datepicker._getFormatConfig(t))&&(x.datepicker._setDateFromField(t),x.datepicker._updateAlternate(t),x.datepicker._updateDatepicker(t))}catch(e){}return!0},_showDatepicker:function(e){var t,a,o,i,n,r,s;("input"!==(e=e.target||e).nodeName.toLowerCase()&&(e=x("input",e.parentNode)[0]),x.datepicker._isDisabledDatepicker(e)||x.datepicker._lastInput===e)||(t=x.datepicker._getInst(e),x.datepicker._curInst&&x.datepicker._curInst!==t&&(x.datepicker._curInst.dpDiv.stop(!0,!0),t&&x.datepicker._datepickerShowing&&x.datepicker._hideDatepicker(x.datepicker._curInst.input[0])),!1!==(o=(a=x.datepicker._get(t,"beforeShow"))?a.apply(e,[e,t]):{})&&(d(t.settings,o),t.lastVal=null,x.datepicker._lastInput=e,x.datepicker._setDateFromField(t),x.datepicker._inDialog&&(e.value=""),x.datepicker._pos||(x.datepicker._pos=x.datepicker._findPos(e),x.datepicker._pos[1]+=e.offsetHeight),i=!1,x(e).parents().each(function(){return!(i|="fixed"===x(this).css("position"))}),n={left:x.datepicker._pos[0],top:x.datepicker._pos[1]},x.datepicker._pos=null,t.dpDiv.empty(),t.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),x.datepicker._updateDatepicker(t),n=x.datepicker._checkOffset(t,n,i),t.dpDiv.css({position:x.datepicker._inDialog&&x.blockUI?"static":i?"fixed":"absolute",display:"none",left:n.left+"px",top:n.top+"px"}),t.inline||(r=x.datepicker._get(t,"showAnim"),s=x.datepicker._get(t,"duration"),t.dpDiv.zIndex(x(e).zIndex()+1),x.datepicker._datepickerShowing=!0,x.effects&&x.effects.effect[r]?t.dpDiv.show(r,x.datepicker._get(t,"showOptions"),s):t.dpDiv[r||"show"](r?s:null),x.datepicker._shouldFocusInput(t)&&t.input.focus(),x.datepicker._curInst=t)))},_updateDatepicker:function(e){this.maxRows=4,(i=e).dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e),e.dpDiv.find("."+this._dayOverClass+" a").mouseover();var t,a=this._getNumberOfMonths(e),o=a[1];e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),1<o&&e.dpDiv.addClass("ui-datepicker-multi-"+o).css("width",17*o+"em"),e.dpDiv[(1!==a[0]||1!==a[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e===x.datepicker._curInst&&x.datepicker._datepickerShowing&&x.datepicker._shouldFocusInput(e)&&e.input.focus(),e.yearshtml&&(t=e.yearshtml,setTimeout(function(){t===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),t=e.yearshtml=null},0))},_shouldFocusInput:function(e){return e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&!e.input.is(":focus")},_checkOffset:function(e,t,a){var o=e.dpDiv.outerWidth(),i=e.dpDiv.outerHeight(),n=e.input?e.input.outerWidth():0,r=e.input?e.input.outerHeight():0,s=document.documentElement.clientWidth+(a?0:x(document).scrollLeft()),l=document.documentElement.clientHeight+(a?0:x(document).scrollTop());return t.left-=this._get(e,"isRTL")?o-n:0,t.left-=a&&t.left===e.input.offset().left?x(document).scrollLeft():0,t.top-=a&&t.top===e.input.offset().top+r?x(document).scrollTop():0,t.left-=Math.min(t.left,t.left+o>s&&o<s?Math.abs(t.left+o-s):0),t.top-=Math.min(t.top,t.top+i>l&&i<l?Math.abs(i+r):0),t},_findPos:function(e){for(var t,a=this._getInst(e),o=this._get(a,"isRTL");e&&("hidden"===e.type||1!==e.nodeType||x.expr.filters.hidden(e));)e=e[o?"previousSibling":"nextSibling"];return[(t=x(e).offset()).left,t.top]},_hideDatepicker:function(e){var t,a,o,i,n=this._curInst;!n||e&&n!==x.data(e,p)||this._datepickerShowing&&(t=this._get(n,"showAnim"),a=this._get(n,"duration"),o=function(){x.datepicker._tidyDialog(n)},x.effects&&(x.effects.effect[t]||x.effects[t])?n.dpDiv.hide(t,x.datepicker._get(n,"showOptions"),a,o):n.dpDiv["slideDown"===t?"slideUp":"fadeIn"===t?"fadeOut":"hide"](t?a:null,o),t||o(),this._datepickerShowing=!1,(i=this._get(n,"onClose"))&&i.apply(n.input?n.input[0]:null,[n.input?n.input.val():"",n]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),x.blockUI&&(x.unblockUI(),x("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(e){if(x.datepicker._curInst){var t=x(e.target),a=x.datepicker._getInst(t[0]);(t[0].id===x.datepicker._mainDivId||0!==t.parents("#"+x.datepicker._mainDivId).length||t.hasClass(x.datepicker.markerClassName)||t.closest("."+x.datepicker._triggerClass).length||!x.datepicker._datepickerShowing||x.datepicker._inDialog&&x.blockUI)&&(!t.hasClass(x.datepicker.markerClassName)||x.datepicker._curInst===a)||x.datepicker._hideDatepicker()}},_adjustDate:function(e,t,a){var o=x(e),i=this._getInst(o[0]);this._isDisabledDatepicker(o[0])||(this._adjustInstDate(i,t+("M"===a?this._get(i,"showCurrentAtPos"):0),a),this._updateDatepicker(i))},_gotoToday:function(e){var t,a=x(e),o=this._getInst(a[0]);this._get(o,"gotoCurrent")&&o.currentDay?(o.selectedDay=o.currentDay,o.drawMonth=o.selectedMonth=o.currentMonth,o.drawYear=o.selectedYear=o.currentYear):(t=new Date,o.selectedDay=t.getDate(),o.drawMonth=o.selectedMonth=t.getMonth(),o.drawYear=o.selectedYear=t.getFullYear()),this._notifyChange(o),this._adjustDate(a)},_selectMonthYear:function(e,t,a){var o=x(e),i=this._getInst(o[0]);i["selected"+("M"===a?"Month":"Year")]=i["draw"+("M"===a?"Month":"Year")]=parseInt(t.options[t.selectedIndex].value,10),this._notifyChange(i),this._adjustDate(o)},_selectDay:function(e,t,a,o){var i,n=x(e);x(o).hasClass(this._unselectableClass)||this._isDisabledDatepicker(n[0])||((i=this._getInst(n[0])).selectedDay=i.currentDay=x("a",o).html(),i.selectedMonth=i.currentMonth=t,i.selectedYear=i.currentYear=a,this._selectDate(e,this._formatDate(i,i.currentDay,i.currentMonth,i.currentYear)))},_clearDate:function(e){var t=x(e);this._selectDate(t,"")},_selectDate:function(e,t){var a,o=x(e),i=this._getInst(o[0]);t=null!=t?t:this._formatDate(i),i.input&&i.input.val(t),this._updateAlternate(i),(a=this._get(i,"onSelect"))?a.apply(i.input?i.input[0]:null,[t,i]):i.input&&i.input.trigger("change"),i.inline?this._updateDatepicker(i):(this._hideDatepicker(),this._lastInput=i.input[0],"object"!=typeof i.input[0]&&i.input.focus(),this._lastInput=null)},_updateAlternate:function(e){var t,a,o,i=this._get(e,"altField");i&&(t=this._get(e,"altFormat")||this._get(e,"dateFormat"),a=this._getDate(e),o=this.formatDate(t,a,this._getFormatConfig(e)),x(i).each(function(){x(this).val(o)}))},noWeekends:function(e){var t=e.getDay();return[0<t&&t<6,""]},iso8601Week:function(e){var t,a=new Date(e.getTime());return a.setDate(a.getDate()+4-(a.getDay()||7)),t=a.getTime(),a.setMonth(0),a.setDate(1),Math.floor(Math.round((t-a)/864e5)/7)+1},parseDate:function(a,n,e){if(null==a||null==n)throw"Invalid arguments";if(""===(n="object"==typeof n?n.toString():n+""))return null;var o,t,i,r,s=0,l=(e?e.shortYearCutoff:null)||this._defaults.shortYearCutoff,c="string"!=typeof l?l:(new Date).getFullYear()%100+parseInt(l,10),u=(e?e.dayNamesShort:null)||this._defaults.dayNamesShort,p=(e?e.dayNames:null)||this._defaults.dayNames,d=(e?e.monthNamesShort:null)||this._defaults.monthNamesShort,m=(e?e.monthNames:null)||this._defaults.monthNames,h=-1,f=-1,g=-1,v=-1,_=!1,y=function(e){var t=o+1<a.length&&a.charAt(o+1)===e;return t&&o++,t},k=function(e){var t=y(e),a=new RegExp("^\\d{1,"+("@"===e?14:"!"===e?20:"y"===e&&t?4:"o"===e?3:2)+"}"),o=n.substring(s).match(a);if(!o)throw"Missing number at position "+s;return s+=o[0].length,parseInt(o[0],10)},b=function(e,t,a){var o=-1,i=x.map(y(e)?a:t,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)});if(x.each(i,function(e,t){var a=t[1];if(n.substr(s,a.length).toLowerCase()===a.toLowerCase())return o=t[0],s+=a.length,!1}),-1!==o)return o+1;throw"Unknown name at position "+s},C=function(){if(n.charAt(s)!==a.charAt(o))throw"Unexpected literal at position "+s;s++};for(o=0;o<a.length;o++)if(_)"'"!==a.charAt(o)||y("'")?C():_=!1;else switch(a.charAt(o)){case"d":g=k("d");break;case"D":b("D",u,p);break;case"o":v=k("o");break;case"m":f=k("m");break;case"M":f=b("M",d,m);break;case"y":h=k("y");break;case"@":h=(r=new Date(k("@"))).getFullYear(),f=r.getMonth()+1,g=r.getDate();break;case"!":h=(r=new Date((k("!")-this._ticksTo1970)/1e4)).getFullYear(),f=r.getMonth()+1,g=r.getDate();break;case"'":y("'")?C():_=!0;break;default:C()}if(s<n.length&&(i=n.substr(s),!/^\s+/.test(i)))throw"Extra/unparsed characters found in date: "+i;if(-1===h?h=(new Date).getFullYear():h<100&&(h+=(new Date).getFullYear()-(new Date).getFullYear()%100+(h<=c?0:-100)),-1<v)for(f=1,g=v;;){if(g<=(t=this._getDaysInMonth(h,f-1)))break;f++,g-=t}if((r=this._daylightSavingAdjust(new Date(h,f-1,g))).getFullYear()!==h||r.getMonth()+1!==f||r.getDate()!==g)throw"Invalid date";return r},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*60*60*1e7,formatDate:function(a,e,t){if(!e)return"";var o,i=(t?t.dayNamesShort:null)||this._defaults.dayNamesShort,n=(t?t.dayNames:null)||this._defaults.dayNames,r=(t?t.monthNamesShort:null)||this._defaults.monthNamesShort,s=(t?t.monthNames:null)||this._defaults.monthNames,l=function(e){var t=o+1<a.length&&a.charAt(o+1)===e;return t&&o++,t},c=function(e,t,a){var o=""+t;if(l(e))for(;o.length<a;)o="0"+o;return o},u=function(e,t,a,o){return l(e)?o[t]:a[t]},p="",d=!1;if(e)for(o=0;o<a.length;o++)if(d)"'"!==a.charAt(o)||l("'")?p+=a.charAt(o):d=!1;else switch(a.charAt(o)){case"d":p+=c("d",e.getDate(),2);break;case"D":p+=u("D",e.getDay(),i,n);break;case"o":p+=c("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":p+=c("m",e.getMonth()+1,2);break;case"M":p+=u("M",e.getMonth(),r,s);break;case"y":p+=l("y")?e.getFullYear():(e.getYear()%100<10?"0":"")+e.getYear()%100;break;case"@":p+=e.getTime();break;case"!":p+=1e4*e.getTime()+this._ticksTo1970;break;case"'":l("'")?p+="'":d=!0;break;default:p+=a.charAt(o)}return p},_possibleChars:function(a){var o,e="",t=!1,i=function(e){var t=o+1<a.length&&a.charAt(o+1)===e;return t&&o++,t};for(o=0;o<a.length;o++)if(t)"'"!==a.charAt(o)||i("'")?e+=a.charAt(o):t=!1;else switch(a.charAt(o)){case"d":case"m":case"y":case"@":e+="0123456789";break;case"D":case"M":return null;case"'":i("'")?e+="'":t=!0;break;default:e+=a.charAt(o)}return e},_get:function(e,t){return e.settings[t]!==l?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()!==e.lastVal){var a=this._get(e,"dateFormat"),o=e.lastVal=e.input?e.input.val():null,i=this._getDefaultDate(e),n=i,r=this._getFormatConfig(e);try{n=this.parseDate(a,o,r)||i}catch(e){o=t?"":o}e.selectedDay=n.getDate(),e.drawMonth=e.selectedMonth=n.getMonth(),e.drawYear=e.selectedYear=n.getFullYear(),e.currentDay=o?n.getDate():0,e.currentMonth=o?n.getMonth():0,e.currentYear=o?n.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(s,e,t){var a,o,i=null==e||""===e?t:"string"==typeof e?function(e){try{return x.datepicker.parseDate(x.datepicker._get(s,"dateFormat"),e,x.datepicker._getFormatConfig(s))}catch(e){}for(var t=(e.toLowerCase().match(/^c/)?x.datepicker._getDate(s):null)||new Date,a=t.getFullYear(),o=t.getMonth(),i=t.getDate(),n=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,r=n.exec(e);r;){switch(r[2]||"d"){case"d":case"D":i+=parseInt(r[1],10);break;case"w":case"W":i+=7*parseInt(r[1],10);break;case"m":case"M":o+=parseInt(r[1],10),i=Math.min(i,x.datepicker._getDaysInMonth(a,o));break;case"y":case"Y":a+=parseInt(r[1],10),i=Math.min(i,x.datepicker._getDaysInMonth(a,o))}r=n.exec(e)}return new Date(a,o,i)}(e):"number"==typeof e?isNaN(e)?t:(a=e,(o=new Date).setDate(o.getDate()+a),o):new Date(e.getTime());return(i=i&&"Invalid Date"===i.toString()?t:i)&&(i.setHours(0),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0)),this._daylightSavingAdjust(i)},_daylightSavingAdjust:function(e){return e?(e.setHours(12<e.getHours()?e.getHours()+2:0),e):null},_setDate:function(e,t,a){var o=!t,i=e.selectedMonth,n=e.selectedYear,r=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=r.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=r.getMonth(),e.drawYear=e.selectedYear=e.currentYear=r.getFullYear(),i===e.selectedMonth&&n===e.selectedYear||a||this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(o?"":this._formatDate(e))},_getDate:function(e){return!e.currentYear||e.input&&""===e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay))},_attachHandlers:function(e){var t=this._get(e,"stepMonths"),a="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){x.datepicker._adjustDate(a,-t,"M")},next:function(){x.datepicker._adjustDate(a,+t,"M")},hide:function(){x.datepicker._hideDatepicker()},today:function(){x.datepicker._gotoToday(a)},selectDay:function(){return x.datepicker._selectDay(a,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return x.datepicker._selectMonthYear(a,this,"M"),!1},selectYear:function(){return x.datepicker._selectMonthYear(a,this,"Y"),!1}};x(this).bind(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(e){var t,a,o,i,n,r,s,l,c,u,p,d,m,h,f,g,v,_,y,k,b,C,x,w,A,D,S,T,I,M,P,F,E,N,O,B,U,j,R,H=new Date,q=this._daylightSavingAdjust(new Date(H.getFullYear(),H.getMonth(),H.getDate())),Y=this._get(e,"isRTL"),V=this._get(e,"showButtonPanel"),L=this._get(e,"hideIfNoPrevNext"),W=this._get(e,"navigationAsDateFormat"),z=this._getNumberOfMonths(e),K=this._get(e,"showCurrentAtPos"),J=this._get(e,"stepMonths"),Q=1!==z[0]||1!==z[1],G=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),$=this._getMinMaxDate(e,"min"),Z=this._getMinMaxDate(e,"max"),X=e.drawMonth-K,ee=e.drawYear;if(X<0&&(X+=12,ee--),Z)for(t=this._daylightSavingAdjust(new Date(Z.getFullYear(),Z.getMonth()-z[0]*z[1]+1,Z.getDate())),t=$&&t<$?$:t;this._daylightSavingAdjust(new Date(ee,X,1))>t;)--X<0&&(X=11,ee--);for(e.drawMonth=X,e.drawYear=ee,a=this._get(e,"prevText"),a=W?this.formatDate(a,this._daylightSavingAdjust(new Date(ee,X-J,1)),this._getFormatConfig(e)):a,o=this._canAdjustMonth(e,-1,ee,X)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+a+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+a+"</span></a>":L?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+a+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+a+"</span></a>",i=this._get(e,"nextText"),i=W?this.formatDate(i,this._daylightSavingAdjust(new Date(ee,X+J,1)),this._getFormatConfig(e)):i,n=this._canAdjustMonth(e,1,ee,X)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+i+"</span></a>":L?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+i+"</span></a>",r=this._get(e,"currentText"),s=this._get(e,"gotoCurrent")&&e.currentDay?G:q,r=W?this.formatDate(r,s,this._getFormatConfig(e)):r,l=e.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(e,"closeText")+"</button>",c=V?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(Y?l:"")+(this._isInRange(e,s)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+r+"</button>":"")+(Y?"":l)+"</div>":"",u=parseInt(this._get(e,"firstDay"),10),u=isNaN(u)?0:u,p=this._get(e,"showWeek"),d=this._get(e,"dayNames"),m=this._get(e,"dayNamesMin"),h=this._get(e,"monthNames"),f=this._get(e,"monthNamesShort"),g=this._get(e,"beforeShowDay"),v=this._get(e,"showOtherMonths"),_=this._get(e,"selectOtherMonths"),y=this._getDefaultDate(e),k="",C=0;C<z[0];C++){for(x="",this.maxRows=4,w=0;w<z[1];w++){if(A=this._daylightSavingAdjust(new Date(ee,X,e.selectedDay)),D=" ui-corner-all",S="",Q){if(S+="<div class='ui-datepicker-group",1<z[1])switch(w){case 0:S+=" ui-datepicker-group-first",D=" ui-corner-"+(Y?"right":"left");break;case z[1]-1:S+=" ui-datepicker-group-last",D=" ui-corner-"+(Y?"left":"right");break;default:S+=" ui-datepicker-group-middle",D=""}S+="'>"}for(S+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+D+"'>"+(/all|left/.test(D)&&0===C?Y?n:o:"")+(/all|right/.test(D)&&0===C?Y?o:n:"")+this._generateMonthYearHeader(e,X,ee,$,Z,0<C||0<w,h,f)+"</div><table class='ui-datepicker-calendar'><thead><tr>",T=p?"<th class='ui-datepicker-week-col'>"+this._get(e,"weekHeader")+"</th>":"",b=0;b<7;b++)T+="<th"+(5<=(b+u+6)%7?" class='ui-datepicker-week-end'":"")+"><span title='"+d[I=(b+u)%7]+"'>"+m[I]+"</span></th>";for(S+=T+"</tr></thead><tbody>",M=this._getDaysInMonth(ee,X),ee===e.selectedYear&&X===e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,M)),P=(this._getFirstDayOfMonth(ee,X)-u+7)%7,F=Math.ceil((P+M)/7),E=Q&&this.maxRows>F?this.maxRows:F,this.maxRows=E,N=this._daylightSavingAdjust(new Date(ee,X,1-P)),O=0;O<E;O++){for(S+="<tr>",B=p?"<td class='ui-datepicker-week-col'>"+this._get(e,"calculateWeek")(N)+"</td>":"",b=0;b<7;b++)U=g?g.apply(e.input?e.input[0]:null,[N]):[!0,""],R=(j=N.getMonth()!==X)&&!_||!U[0]||$&&N<$||Z&&Z<N,B+="<td class='"+(5<=(b+u+6)%7?" ui-datepicker-week-end":"")+(j?" ui-datepicker-other-month":"")+(N.getTime()===A.getTime()&&X===e.selectedMonth&&e._keyEvent||y.getTime()===N.getTime()&&y.getTime()===A.getTime()?" "+this._dayOverClass:"")+(R?" "+this._unselectableClass+" ui-state-disabled":"")+(j&&!v?"":" "+U[1]+(N.getTime()===G.getTime()?" "+this._currentClass:"")+(N.getTime()===q.getTime()?" ui-datepicker-today":""))+"'"+(j&&!v||!U[2]?"":" title='"+U[2].replace(/'/g,"&#39;")+"'")+(R?"":" data-handler='selectDay' data-event='click' data-month='"+N.getMonth()+"' data-year='"+N.getFullYear()+"'")+">"+(j&&!v?"&#xa0;":R?"<span class='ui-state-default'>"+N.getDate()+"</span>":"<a class='ui-state-default"+(N.getTime()===q.getTime()?" ui-state-highlight":"")+(N.getTime()===G.getTime()?" ui-state-active":"")+(j?" ui-priority-secondary":"")+"' href='#'>"+N.getDate()+"</a>")+"</td>",N.setDate(N.getDate()+1),N=this._daylightSavingAdjust(N);S+=B+"</tr>"}11<++X&&(X=0,ee++),x+=S+="</tbody></table>"+(Q?"</div>"+(0<z[0]&&w===z[1]-1?"<div class='ui-datepicker-row-break'></div>":""):"")}k+=x}return k+=c,e._keyEvent=!1,k},_generateMonthYearHeader:function(e,t,a,o,i,n,r,s){var l,c,u,p,d,m,h,f,g=this._get(e,"changeMonth"),v=this._get(e,"changeYear"),_=this._get(e,"showMonthAfterYear"),y="<div class='ui-datepicker-title'>",k="";if(n||!g)k+="<span class='ui-datepicker-month'>"+r[t]+"</span>";else{for(l=o&&o.getFullYear()===a,c=i&&i.getFullYear()===a,k+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",u=0;u<12;u++)(!l||u>=o.getMonth())&&(!c||u<=i.getMonth())&&(k+="<option value='"+u+"'"+(u===t?" selected='selected'":"")+">"+s[u]+"</option>");k+="</select>"}if(_||(y+=k+(!n&&g&&v?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",n||!v)y+="<span class='ui-datepicker-year'>"+a+"</span>";else{for(p=this._get(e,"yearRange").split(":"),d=(new Date).getFullYear(),h=(m=function(e){var t=e.match(/c[+\-].*/)?a+parseInt(e.substring(1),10):e.match(/[+\-].*/)?d+parseInt(e,10):parseInt(e,10);return isNaN(t)?d:t})(p[0]),f=Math.max(h,m(p[1]||"")),h=o?Math.max(h,o.getFullYear()):h,f=i?Math.min(f,i.getFullYear()):f,e.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";h<=f;h++)e.yearshtml+="<option value='"+h+"'"+(h===a?" selected='selected'":"")+">"+h+"</option>";e.yearshtml+="</select>",y+=e.yearshtml,e.yearshtml=null}return y+=this._get(e,"yearSuffix"),_&&(y+=(!n&&g&&v?"":"&#xa0;")+k),y+="</div>"},_adjustInstDate:function(e,t,a){var o=e.drawYear+("Y"===a?t:0),i=e.drawMonth+("M"===a?t:0),n=Math.min(e.selectedDay,this._getDaysInMonth(o,i))+("D"===a?t:0),r=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(o,i,n)));e.selectedDay=r.getDate(),e.drawMonth=e.selectedMonth=r.getMonth(),e.drawYear=e.selectedYear=r.getFullYear(),"M"!==a&&"Y"!==a||this._notifyChange(e)},_restrictMinMax:function(e,t){var a=this._getMinMaxDate(e,"min"),o=this._getMinMaxDate(e,"max"),i=a&&t<a?a:t;return o&&o<i?o:i},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return null==t?[1,1]:"number"==typeof t?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,a,o){var i=this._getNumberOfMonths(e),n=this._daylightSavingAdjust(new Date(a,o+(t<0?t:i[0]*i[1]),1));return t<0&&n.setDate(this._getDaysInMonth(n.getFullYear(),n.getMonth())),this._isInRange(e,n)},_isInRange:function(e,t){var a,o,i=this._getMinMaxDate(e,"min"),n=this._getMinMaxDate(e,"max"),r=null,s=null,l=this._get(e,"yearRange");return l&&(a=l.split(":"),o=(new Date).getFullYear(),r=parseInt(a[0],10),s=parseInt(a[1],10),a[0].match(/[+\-].*/)&&(r+=o),a[1].match(/[+\-].*/)&&(s+=o)),(!i||t.getTime()>=i.getTime())&&(!n||t.getTime()<=n.getTime())&&(!r||t.getFullYear()>=r)&&(!s||t.getFullYear()<=s)},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return{shortYearCutoff:t="string"!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10),dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,a,o){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var i=t?"object"==typeof t?t:this._daylightSavingAdjust(new Date(o,a,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),i,this._getFormatConfig(e))}}),x.fn.datepicker=function(e){if(!this.length)return this;x.datepicker.initialized||(x(document).mousedown(x.datepicker._checkExternalClick),x.datepicker.initialized=!0),0===x("#"+x.datepicker._mainDivId).length&&x("body").append(x.datepicker.dpDiv);var t=Array.prototype.slice.call(arguments,1);return"string"!=typeof e||"isDisabled"!==e&&"getDate"!==e&&"widget"!==e?"option"===e&&2===arguments.length&&"string"==typeof arguments[1]?x.datepicker["_"+e+"Datepicker"].apply(x.datepicker,[this[0]].concat(t)):this.each(function(){"string"==typeof e?x.datepicker["_"+e+"Datepicker"].apply(x.datepicker,[this].concat(t)):x.datepicker._attachDatepicker(this,e)}):x.datepicker["_"+e+"Datepicker"].apply(x.datepicker,[this[0]].concat(t))},x.datepicker=new e,x.datepicker.initialized=!1,x.datepicker.uuid=(new Date).getTime(),x.datepicker.version="1.10.3"}(e)}),define("../Common/calendar",["jquery","localization","../JQueryUI/datepicker"],function(y,a,e){return function(e){var i,c=y.extend({},{allowSameDates:!1,numberOfMonths:2,showAnim:"",showButtonPanel:!1,buttonImage:"",buttonImageOnly:!0,showOn:"focus",minDate:null,altFormat:null,listCalendars:!0,calendars:[],highlightSelectedDates:!0,highlightInterDates:!0},e),t=function(i,e){if(null!=i){if(i.index=_(c.calendars)+1,1==e&&c.calendars.push(i),i.altSelector=i.altSelector||i.selector+"_hidden",null!=i.createAltField&&1!=i.createAltField||0==y(i.altSelector).length&&y("<input/>",{type:"hidden",id:i.altSelector.replace(/(\B)(#|\.)(\w+)\b/g,"$3")}).insertBefore(i.selector),null!=i.restrictedDates&&null!=i.restrictedDates)for(var t=0;t<i.restrictedDates.length;t++)i.restrictedDates[t]=i.restrictedDates[t].replace(new RegExp("/","g"),"-");var a;a=i.selector,y(a).datepicker({numberOfMonths:c.numberOfMonths,showAnim:c.showAnim,showButtonPanel:c.showButtonPanel,showOn:c.showOn,minDate:c.minDate,altField:i.altSelector,altFormat:c.altFormat,onSelect:function(e){l(e,i),i.justSelected=!0},onClose:function(e){var t=y(this).datepicker("getDate"),a=y.datepicker.formatDate("yy-mm-dd",t);if(n(e,i,a),1==i.justSelected&&1==c.listCalendars){var o=v(i.index);o&&""!=o.selector&&y(o.selector).is(":visible")&&(y(o.selector).focus(),setTimeout(function(){y(o.selector).focus()},0)),i.justSelected=!1}else 0==i.justSelected&&(r(t,i),s(t,i));y("body").off("mouseenter",".ui-datepicker-calendar tbody"),y("body").off("mouseleave",".ui-datepicker-calendar tbody"),y("body").off("mouseleave",".ui-state-default"),y("body").off("mouseenter",".ui-state-default"),m("#range-plugin-tooltip")},beforeShowDay:function(e){return o(e,a,i.restrictedDates)},beforeShow:function(){u(i)}}),""!=c.buttonImage&&(y(i.selector).datepicker("option","buttonImage",c.buttonImage),y(i.selector).datepicker("option","buttonText",""),y(i.selector).datepicker("option","buttonImageOnly",c.buttonImageOnly),y(i.selector).datepicker("option","showOn","both")),""==y(i.selector).val()&&y(i.selector).val(c.formatDisplay),y(i.selector).attr("autocomplete","off"),""!=y(i.selector).val()&&y(i.selector).val()!=c.formatDisplay&&(y(i.selector).datepicker("setDate",y(i.selector).val()),l(y(i.selector).val(),i),n(y(i.selector).val(),i))}},o=function(e,t,a){var o=e.getFullYear(),i=e.getMonth(),n=e.getDate();if(null!=a&&null!=a){var r=y.datepicker.formatDate("yy-mm-dd",e);if(-1<y.inArray(r,a))return[!1]}for(var s=0;s<c.calendars.length;s++){if(c.calendars[s].selectedDate&&o==c.calendars[s].selectedDate.year&&i==c.calendars[s].selectedDate.month&&n==c.calendars[s].selectedDate.day){var l="";return 1==c.highlightSelectedDates&&(l=1==c.calendars.length?"ptw-only-date ":0==s?"ptw-start-date ":s==c.calendars.length-1?"ptw-end-date ":"ptw-interSelected-date "),[!0,l+"ptw-date-active"]}if(1==c.highlightInterDates&&1<c.calendars.length&&s!=c.calendars.length-1&&c.calendars[s].selectedDate&&c.calendars[s+1].selectedDate&&e>c.calendars[s].selectedDate.date&&e<c.calendars[s+1].selectedDate.date)return[!0,"ptw-date-active"]}return[!0,""]},n=function(e,t,a){if(0==h(e))t.selectedDate=null,y(t.selector).val(c.formatDisplay),y(t.altSelector).val("");else{var o=f(e);t.selectedDate={year:o.getFullYear(),month:o.getMonth(),day:o.getDate()},t.selectedDate.date=o,t.selectedDate.textDate=e}a&&null!=t.restrictedDates&&null!=t.restrictedDates&&-1<y.inArray(a,t.restrictedDates)&&(t.selectedDate=null,y(t.selector).val(c.formatDisplay),y(t.altSelector).val(""))},r=function(e,t){if(null!=e&&""!=e)for(var a=0;a<c.calendars.length;a++)c.calendars[a].index<=t.index||null!=c.calendars[a].selectedDate&&(1==c.allowSameDates&&e>c.calendars[a].selectedDate.date||0==c.allowSameDates&&e>=c.calendars[a].selectedDate.date)&&(c.calendars[a].selectedDate=null,y(c.calendars[a].selector).val(c.formatDisplay),y(c.calendars[a].altSelector).val(""))},s=function(e,t){if(null!=e&&""!=e)for(var a=c.calendars.length-1;0<=a;a--)c.calendars[a].index>=t.index||null!=c.calendars[a].selectedDate&&(1==c.allowSameDates&&e<c.calendars[a].selectedDate.date||0==c.allowSameDates&&e<=c.calendars[a].selectedDate.date)&&(c.calendars[a].selectedDate=null,y(c.calendars[a].selector).val(c.formatDisplay),y(c.calendars[a].altSelector).val(""))},l=function(e,t){var a=f(e);if(null==a)return!1;t.selectedDate={year:a.getFullYear(),month:a.getMonth(),day:a.getDate()},t.selectedDate.date=a,t.selectedDate.textDate=e;var o=t.selectedDate.date;return r(o,t),s(o,t),i&&"function"==typeof i&&i(t.selector,t.selectedDate),!0},u=function(e){if(0<c.calendars.length){var t=g(e.index),a=0<e.index?null!=e.selectedDate?null:t.selectedDate:null;null==a&&(a=t.index<c.calendars.length-1?null!=e.selectedDate?null:e.selectedDate:null),null!=a&&(y(e.selector).val(""),y(e.selector).datepicker("option","defaultDate",new Date(a.date))),0==e.index&&y("body").on("mouseenter",".ui-datepicker-calendar tbody",function(e){var t=y(e.currentTarget).parents("div#ptw-ui-datepicker-div").find("td.ptw-end-date").removeClass("ptw-end-date");0<t.length&&(t.removeClass("ptw-end-date"),y(t.children().first()).removeClass("ui-state-active"))}),1==e.index&&void 0!==c.textValues&&(y("body").on("mouseenter",".ui-datepicker-calendar tbody",function(e){var t=y(e.currentTarget).parents("div#ptw-ui-datepicker-div").find("td.ptw-end-date").removeClass("ptw-end-date");0<t.length&&(t.removeClass("ptw-end-date"),y(t.children().first()).removeClass("ui-state-active"))}),y("body").on("mouseleave",".ui-datepicker-calendar tbody",function(e){var t=y(e.currentTarget).parents("div#ptw-ui-datepicker-div").find(".ui-datepicker-current-day");if(0<t.length){t.addClass("ptw-end-date"),y(t.children().first()).addClass("ui-state-active");var a,o,i=c,n=i.calendars[0],r=y(n.altSelector),s=i.calendars[1],l=y(s.altSelector);if(""!==r.val()?a=new Date(r.val()):void 0!==n.selectedDate&&null!==n.selectedDate&&(a=new Date(n.selectedDate.year,n.selectedDate.month,n.selectedDate.day)),""!==l.val()?o=new Date(l.val()):void 0!==s.selectedDate&&null!==s.selectedDate&&(o=new Date(s.selectedDate.year,s.selectedDate.month,s.selectedDate.day)),isNaN(o)||isNaN(a))return;y("td.ptw-date-active").removeClass("ptw-date-active"),p(a,o)}}),y("body").on("mouseleave",".ui-state-default",function(e){y("#range-plugin-tooltip").attr("style","display: none;")}),y("body").on("mouseenter",".ui-state-default",function(e){var t=y(y(e.currentTarget));if(!y(t.parent()).hasClass("ui-state-disabled")){y("td.ptw-date-active").removeClass("ptw-date-active");var a,o=c,i=o.calendars[0],n=y(i.altSelector),r=new Date(t.parent().data("year"),t.parent().data("month"),+t.html());if(""!==n.val()?a=new Date(n.val()):void 0!==i.selectedDate&&null!==i.selectedDate&&(a=new Date(i.selectedDate.year,i.selectedDate.month,i.selectedDate.day)),!isNaN(r)&&!isNaN(a)){var s=(r.getTime()-a.getTime())/864e5;if("nights"!==c.typePopUp&&s++,!(s<=0)){if(void 0!==o.textValues){var l=s+" "+("nights"===c.typePopUp?1<s?o.textValues.nights:o.textValues.night:1<s?o.textValues.days:o.textValues.day);0===y("#range-plugin-tooltip").length&&y("body").append(y("<span>").addClass("range-plugin-tooltip").attr("id","range-plugin-tooltip").attr("style","display:none;").html("")),d("#range-plugin-tooltip",t,l)}p(a,r)}}}}))}},p=function(o,i){var e=y(".ui-state-default");y.each(e,function(e,t){var a=y(t);t=new Date(a.parent().data("year"),a.parent().data("month"),+a.html());o.getTime()<=t.getTime()&&t.getTime()<=i.getTime()&&y(a.parent()).addClass("ptw-date-active")})},d=function(e,t,a){var o=y(e),i=t.offset().left+t.width()/2-o.width()/2,n=t.offset().top-o.height();o.attr("style","left: "+i+"px; top: "+n+"px;visibility:visible;"),o.html(a)},m=function(e){var t=y(e);t.attr("style","display: none;"),t.html("")},h=function(e){try{if(""==e)return!1;y.datepicker.parseDate(c.format,e);return!0}catch(e){return!1}},f=function(e){new Date;return 1==h(e)?y.datepicker.parseDate(c.format,e):null},g=function(e){if(0<c.calendars.length)for(var t=c.calendars[0],a=0;a<c.calendars.length;a++){if(c.calendars[a].index==e)return t;t=c.calendars[a]}return!1},v=function(e){var t=c.calendars.length;if(0<c.calendars.length&&e<t-1)for(var a=c.calendars[t-1],o=t-1;0<=o;o--){if(c.calendars[o].index==e)return a;a=c.calendars[o]}return!1},_=function(e){for(var t=-1,a=0;a<e.length;a++)e[a].index>t&&(t=e[a].index);return t};return{calendars:c.calendars,init:function(){y.datepicker.regional.es=a.es,y.datepicker.regional[c.region]=a[c.region],y.datepicker.setDefaults(y.datepicker.regional[c.region]);for(var e=0;e<c.calendars.length;e++)t(c.calendars[e])},addCalendar:t,validate:function(e){for(var t=new y.Deferred,a=[],o=!0,i=null!=e.optionCode&&""!=e.optionCode,n=0;n<c.calendars.length;n++)c.calendars[n].optionCodes=c.calendars[n].optionCodes||[],(!i||i&&-1!=y.inArray(e.optionCode,c.calendars[n].optionCodes))&&(o=o&&null==c.calendars[n].selectedDate);if(1==e.validateEmpty&&1==o)for(n=0;n<c.calendars.length;n++)(!i||i&&-1!=y.inArray(e.optionCode,c.calendars[n].optionCodes))&&(y(c.calendars[n].selector).addClass(e.errorClass),a.push({key:c.calendars[n].selector,value:c.calendars[n].errors.empty}));else if(0==o)for(n=0;n<c.calendars.length;n++)y(c.calendars[n].selector).removeClass(e.errorClass),(!i||i&&-1!=y.inArray(e.optionCode,c.calendars[n].optionCodes))&&(y(c.calendars[n].selector).removeClass(e.errorClass),null==c.calendars[n].selectedDate&&(y(c.calendars[n].selector).addClass(e.errorClass),a.push({key:c.calendars[n].selector,value:c.calendars[n].errors.empty})));return t.resolve(a),t.promise()},onSelect:function(e){e&&"function"==typeof e&&(i=e)}}}}),define("../Common/getDataValue",["jquery"],function(s){return function(e,t){if(null!=e){var a=s(e).attr("class");if(a){var o=a.split(" ");if(0!=o.length&&(1!=o.length||o[0]))for(var i=0;i<o.length;++i){var n=o[i];if(0===n.indexOf("ap-data_"+t+"-")){var r=n.replace("ap-data_"+t+"-","");return r=r.replace(/{e}/g," ")}}}}}}),define("minors",["jquery","../Common/getDataValue"],function(y,k){return function(e){var m,u,p,t={roomsSelector:"",roomsTemplateSelector:"",roomsContainerSelector:"",roomsTemplateBaseId:"",minorsAgesSelector:"",minorsAgesTemplateSelector:"",minorsAgesContainerBaseSelector:"",minorsAgesTemplateBaseId:"",minorsAgesAltValueBaseSelector:"",minorsAgesContainerBaseId:"",minorsAgesContainerContainerSelector:"",minorsAgesContainerTemplateSelector:"",adultsTemplateBaseId:"",bookerSelector:"",currentMaxRooms:0,loadRooms:!0,loadMinors:!0,manageRoomsClone:void 0,manageMinorsAgesClone:void 0,onUpdatePopover:void 0,errors:{}},h=y.extend({},t,e),d=[],a=function(){1==h.loadRooms&&y(h.roomsSelector).change(function(e){for(var t=parseInt(y(this).val()),a=h.currentMaxRooms>t?h.currentMaxRooms:t,o=0;o<a;o++){var i=g(o);i&&i.RoomIndex<t?i.Status=!0:i&&(i.Status=!1)}h.currentMaxRooms=t,y(h.roomsContainerSelector,h.bookerSelector).hide();for(var n=0;n<t;n++){var r="#"+h.roomsTemplateBaseId+n;if(0==y(r,h.bookerSelector).length){var s=m.clone();s.find(".ap_collection").each(function(){var e=y(this).attr("name")||"";y(this).attr("name",e.replace("{0}",n))}),null!=h.manageRoomsClone&&h.manageRoomsClone(s,y(h.roomsContainerSelector,h.bookerSelector),n),"function"==typeof h.changeInfant&&h.changeInfant(r,n)}}var l=y("."+h.roomsTemplateBaseId,h.bookerSelector).length-1;"function"==typeof h.clearFieldAgeInfant&&t<l&&h.clearFieldAgeInfant(t,l,"#"+h.roomsTemplateBaseId),y(".ap_roomIndex",h.bookerSelector).attr("style",1<t?"display:":"display:none"),y("."+h.roomsTemplateBaseId,h.bookerSelector).hide(),y("select",y("."+h.roomsTemplateBaseId,h.roomsContainerSelector)).attr("disabled",!0),1==h.loadMinors&&(y("."+h.minorsAgesContainerBaseId,h.bookerSelector).hide(),y("select",y("."+h.minorsAgesTemplateBaseId,h.bookerSelector+" ."+h.minorsAgesContainerBaseId)).attr("disabled",!0));var c=!1,u=!1;for(n=0;n<t;n++){y("#"+h.roomsTemplateBaseId+n,h.bookerSelector).show(),y("select",y("#"+h.roomsTemplateBaseId+n,h.bookerSelector)).attr("disabled",!1);var p=g(n);if(p&&1==p.Status&&0<p.Elements.length){y("#"+h.minorsAgesContainerBaseId+n,h.bookerSelector).show();for(var d=0;d<p.Elements.length;d++)y("select.ap_age",p.Elements[d]).attr("disabled",!1);u=!0}c=!0}1==c&&y(h.roomsContainerSelector,h.bookerSelector).show(),1==u?y(h.minorsAgesContainerContainerSelector,h.bookerSelector).show():y(h.minorsAgesContainerContainerSelector,h.bookerSelector).hide(),_()}).change(),1==h.loadMinors&&(y(h.bookerSelector+" form").delegate(h.minorsAgesSelector,"change",function(e){var t=parseInt(y(this).val()),a=k(this,"room"),o=parseInt(a);if(_(),0==y("#"+h.minorsAgesContainerBaseId+o,h.bookerSelector).length){var i=p.clone();i.find(".ap_index").html(o+1),i.attr("id",h.minorsAgesContainerBaseId+o).addClass(h.minorsAgesContainerBaseId).appendTo(h.minorsAgesContainerContainerSelector)}y("#"+h.minorsAgesContainerBaseId+o,h.bookerSelector).hide();for(var n=0;n<t;n++)if(0==y("#"+h.minorsAgesTemplateBaseId+n+a,h.bookerSelector).length){var r=u.clone();r.find(".ap_collection").each(function(){var e=y(this).attr("name")||"";y(this).attr("name",e.replace("{0}",a).replace("{1}",n))}),null!=h.manageMinorsAgesClone&&h.manageMinorsAgesClone(r,y("#"+h.minorsAgesContainerBaseId+o,h.bookerSelector),a,n)}y("."+h.minorsAgesTemplateBaseId,y(h.minorsAgesContainerBaseSelector+o,h.bookerSelector)).hide(),y("select",y("."+h.minorsAgesTemplateBaseId,h.minorsAgesContainerBaseSelector+o)).attr("disabled",!0);var s=!1,l=[];for(n=0;n<t;n++){var c=y("#"+h.minorsAgesTemplateBaseId+n+a,y(h.minorsAgesContainerBaseSelector+o,h.bookerSelector));c.show(),y("select.ap_age",c).attr("disabled",!1),l.push(c),s=s||o<=h.currentMaxRooms}1==s&&y(h.minorsAgesContainerBaseSelector+o,h.bookerSelector).show(),f(o,s,l),s=!1;for(n=0;n<d.length;n++)if(1==d[n].Status&&0<d[n].Elements.length&&d[n].RoomIndex<=h.currentMaxRooms){s=!0;break}1==s?y(h.minorsAgesContainerContainerSelector,h.bookerSelector).show():y(h.minorsAgesContainerContainerSelector,h.bookerSelector).hide()}),y(h.minorsAgesSelector).trigger("change")),1==h.showMonths&&(y(h.bookerSelector+" form").delegate(h.yearSelector,"change",function(e){var t=parseInt(y(this).val());0==t?(y(this).siblings(".ap_age_month").show(),y(this).siblings(".ap_age_month").children("select").attr("disabled",!1),y(h.monthSelector).trigger("change")):(y(this).siblings(".ap_age_month").hide(),y(this).siblings(".ap_age_month").children("select").attr("disabled",!0)),null!=h.onYearSelect&&h.onYearSelect(this,t)}),y(h.yearSelector).trigger("change"),y(h.bookerSelector+" form").delegate(h.monthSelector,"change",function(e){var t=parseInt(y(this).val());null!=h.onMonthSelect&&h.onMonthSelect(this,t)}),y(h.monthSelector).trigger("change")),y("body").on("change","select."+h.adultsTemplateBaseId,function(e){_()}),y("select."+h.adultsTemplateBaseId).change()},f=function(e,t,a){var o=g(e);null==o?d.push({RoomIndex:e,Status:t,Elements:a}):(o.Status=t,o.Elements=a)},g=function(e){for(var t=0;t<d.length;t++)if(d[t].RoomIndex==e)return d[t];return null},o=function(){for(var e=v(),t=0,a=0,o=[],i=0;i<e.length;i++){NaN!=e[i].adults.value&&(t+=e[i].adults.value),NaN!=e[i].minors.value&&(a+=e[i].minors.value);for(var n=0;n<e[i].minorsAges.length;n++)NaN!=e[i].minorsAges[n].value&&o.push(e[i].minorsAges[n].value)}1==h.calculateTotals&&(y(h.totalAdultsSelector).val(t),y(h.totalMinorsSelector).val(a),y(h.totalMinorsAgesSelector).val(o.join()))},v=function(){for(var e=[],t=1==h.loadRooms?parseInt(y(h.roomsSelector).val()):1,a=1;a<=t&&!(a>h.currentMaxRooms);a++){var o={key:"#"+h.adultsTemplateBaseId+a,value:parseInt(y("#"+h.adultsTemplateBaseId+a,h.bookerSelector).val())},i={};y(h.minorsAgesSelector,h.bookerSelector).each(function(){var e=k(this,"room");parseInt(e)==a&&(i={key:y(this).attr("id"),value:parseInt(y(this).val())})});var n=[];y("."+h.minorsAgesTemplateBaseId,"#"+h.minorsAgesContainerBaseId+a).each(function(e,t){if(e>=i.value)return!1;n.push({key:y(this).attr("id"),value:y("select",t).val()})}),e.push({index:a,adults:o,minors:i,minorsAges:n})}return e},_=function(){if(void 0!==h.onUpdatePopover){var e=parseInt(y(h.roomsSelector).val()),t=0;y(h.roomsContainerSelector+" select."+h.adultsTemplateBaseId).not(":disabled").each(function(){t+=parseInt(y(this).val())}),y(h.roomsContainerSelector+" select"+h.minorsAgesSelector).not(":disabled").each(function(){t+=parseInt(y(this).val())}),h.loadInfants&&y(h.roomsContainerSelector+" select"+h.infantsAgesSelector).not(":disabled").each(function(){t+=parseInt(y(this).val())}),h.onUpdatePopover({numRooms:e,pax:t})}};return{init:function(){m=y(h.roomsTemplateSelector,h.bookerSelector).clone(),u=y(h.minorsAgesTemplateSelector,h.bookerSelector).clone(),p=y(h.minorsAgesContainerTemplateSelector,h.bookerSelector).clone(),a(),o(!1)},validate:function(e){y.extend({maxPassengers:0},h);for(var t=new y.Deferred,a=v(),o=0,i=0,n=[],r=!1,s=[],l=0;l<a.length;l++){NaN!=a[l].adults.value&&(o+=a[l].adults.value),NaN!=a[l].minors.value&&(i+=a[l].minors.value);for(var c=0;c<a[l].minorsAges.length;c++)NaN!=a[l].minorsAges[c].value?n.push(a[l].minorsAges[c].value):r=!0}return r&&s.push({key:"minorAge",value:h.errors.emptyMinorAge}),0<e.maxPassengers&&o+i>e.maxPassengers&&s.push({key:"maxPassengers",value:h.errors.maxPassengers}),t.resolve(s),t.promise()},getSummary:v}}}),define("validation",["jquery"],function(c){return function(){var i=function(e,t){for(var a=0;a<e.length;a++)if(e[a].key==t.key)return a;return-1};return{fill:function(e,t){if(e)for(var a=0;a<e.length;a++)if(1==e[a].createDestinationElement)for(var o=e[a].name,i=c(e[a].origin,t),n=0,r=0;r<i.length;r++)if(0<c(i[r]).closest(e[a].selectorException).length)n++;else{var s=r+(e[a].startIndex||0)-n,l=c('input[name="'+o.replace(/\{0\}/gi,s)+'"]',e[a].destinationContainer);0<l.length?l.val(i[r].value):c("<input>",{type:"hidden",name:o.replace(/\{0\}/gi,s)}).val(i[r].value).appendTo(e[a].destinationContainer)}else c(e[a].destination).val(c(e[a].origin,t).val())},showErrors:function(e,a){var o=[];return c(a).hide().empty(),c.when.apply(c,e).pipe(function(){for(var e=0;e<arguments.length;e++)for(var t=0;t<arguments[e].length;t++)-1==i(o,arguments[e][t])&&(c("<div/>",{html:"*"+arguments[e][t].value}).appendTo(a),o.push(arguments[e][t]));return 0<o.length&&(c(a).show(),c(o[0].key).focus()),0<o.length})}}}}),define("../Common/popover",["jquery"],function(s){return function(e){var n=s.extend({},{ptwTravelersLinkId:"",ptwPopoverCloseId:"",ptwPopoverId:"ptw-fp-popover",attr:"data-id",personText:"persona",peopleText:"personas",roomText:"habitacion",roomsText:"habitaciones",ptwPopoverNumPaxId:"ptw-num-pax",ptwPopoverPaxTextId:"ptw-pax-text",ptwPopoverRoomsId:"ptw-num-rooms",ptwPopoverRoomTextId:"ptw-room-text",useInfantTexts:!1,ptwPopoverInfantTexts:"ptw-infant-text",ptwPopoverInfantContainer:"ptw-infant-text-container",mainPopoverContainerId:"#none",people:0,rooms:0},e),t=(n.people,n.rooms),a=function(){s("html").on("click touchend",function(e){var t=s(e.target);t.closest("#"+n.ptwPopoverId).length||t.closest("#ptw-container-travelers").length||o()}),s("#"+n.ptwTravelersLinkId).bind("click",function(e){r(),e.preventDefault()}),s("#"+n.ptwPopoverCloseId).bind("click",function(){"block"===s("#"+n.ptwPopoverId).css("display")?o():(s("#"+n.ptwPopoverId).css("display","block"),s("#"+n.ptwPopoverCloseId).css("display","block"))})},o=function(){s("#"+n.ptwPopoverId).css("display","none"),s("#"+n.ptwPopoverCloseId).css("display","none")},i=function(){var e=s("#"+n.ptwTravelersLinkId).position().top;s("#"+n.ptwPopoverId).css("display","block");var t=s("#"+n.ptwPopoverId).width(),a=(s("#"+n.ptwPopoverId).height(),s("#"+n.ptwTravelersLinkId).width()),o=s("#"+n.ptwTravelersLinkId).position().left,i=o+a-t;s("#"+n.ptwPopoverId).css("left",i-12),s("#"+n.ptwPopoverId).css("top",e+25),s("#"+n.ptwPopoverCloseId).css("left",o+a-25),s("#"+n.ptwPopoverCloseId).css("top",e+45),s("#"+n.ptwPopoverCloseId).css("display","block")},r=function(){"block"===s("#"+n.ptwPopoverId).css("display")?o():i()};return{init:function(){a()},setOccupaton:function(e){t=e.numRooms,pax=e.pax,t&&(s("#"+n.ptwPopoverRoomsId).html(t),1<t?s("#"+n.ptwPopoverRoomTextId).html(n.roomsText):s("#"+n.ptwPopoverRoomTextId).html(n.roomText)),s("#"+n.ptwPopoverNumPaxId).html(pax),1<pax?s("#"+n.ptwPopoverPaxTextId).html(n.peopleText):s("#"+n.ptwPopoverPaxTextId).html(n.personText)},toggleVisible:i}}}),define("hotelBooker",["jquery","../Common/autocomplete","../Common/calendar","minors","validation","../Common/popover"],function(u,p,d,m,h,f){return function(e){var o,i,a,n=u.extend(!0,{texts:{},autocomplete:{autocompletes:[]},calendar:{calendars:[],typePopUp:"nights"},formMapping:[],prefix:"",maxPassengers:0},e);u(".icon-calendar").click(function(){u(this).siblings(".ui-datepicker-trigger").click()});var r=function(){u(".ap_booker_submit",n.selector).prop("disabled",!1),u("body").delegate(n.selector+" .ap_removeCard","click",function(e){e.preventDefault(),u("#UseSingleHotelQuoteMode").val("False"),u(this).closest(".ap_field").hide(),u(".ptw-field-destination",n.selector).show(),u("#Searchbox_PostUrl",n.selector).val(u("#Searchbox_PostUrl2",n.selector).val()),n.texts.SearchButtonText&&""!=n.texts.SearchButtonText&&u(".ap_booker_submit",n.selector).val(n.texts.SearchButtonText)}),u("body").delegate(".change_destination","change",function(e){e.preventDefault(),u("#UseSingleHotelQuoteMode").val("False"),u("#Searchbox_PostUrl",n.selector).val(u("#Searchbox_PostUrl2",n.selector).val()),n.texts.SearchButtonText&&""!=n.texts.SearchButtonText&&u(".ap_booker_submit",n.selector).val(n.texts.SearchButtonText)})},s=function(e,t,a){e.instance=new p({selector:e.selector,uri:t,createAltField:e.createAltField,isNotAsync:e.isNotAsync,source:a,mapping:function(e){return{label:e.Display,description:"("+e.HotelsCount+" "+(1<e.HotelsCount?n.texts.Hotels:n.texts.Hotel)+")",uri:e.URI,tableName:e.TableName,altValue:e.Id,display:e.Display,country:e.CountryA2}},queryName:"query",data:{compareType:"initial",isNotAsync:e.isNotAsync},errors:e.errors,onSelectCallback:function(e){l(e.item.display,e.item.altValue,e.item.tableName,e.item.uri,e.item.country)}}),e.instance.init().done(function(e){0<e.length&&(e.data("ui-autocomplete")._renderItem=function(e,t){return u("<li>").append('<a><span class="destination">'+t.label+'</span><span class="numHotels">'+t.description+"</span></a>").appendTo(e)})})},l=function(e,t,a,o,i){u("#ap_dest_keywordTable").val(a),u("#ap_dest_uri").val(o)},t=function(){var e=new Array;return e=e.concat(function(e){for(var t=[],a=0;a<e.autocompletes.length;a++)t.push(e.autocompletes[a].instance.fill({revalidateUri:e.revalidateUri,forceRevalidation:0<u("#ap_dest_uri").length&&""==u.trim(u("#ap_dest_uri").val())}).done(function(e,t,a){if(e&&0<e.length){var o=e[0];u(t).val(o.Display),u(a).val(o.Id),u(n.uriComponent).val(o.URI),l(o.Display,o.Id,o.TableName,o.URI,o.CountryA2)}}));return t}(n.autocomplete))},c=function(e){void 0!==a&&a.setOccupaton(e)};return{code:n.code,isActive:n.isActive,init:function(){n.selector="#"+n.prefix+"_"+n.code;for(var e=0;e<n.autocomplete.autocompletes.length;e++)s(n.autocomplete.autocompletes[e],n.autocomplete.uri,n.autocomplete.source);if((o=new d(n.calendar)).init(),n.usePopover){var t=n.servicePrefix;(a=new f({ptwTravelersLinkId:t+"ptw-travelers-link",ptwPopoverCloseId:t+"ptw-popover-close",ptwPopoverId:t+"ptw-fp-popover",attr:"data-id",ptwPopoverRoomsId:t+"ptw-num-rooms",ptwPopoverNumPaxId:t+"ptw-num-pax",ptwPopoverPaxTextId:t+"ptw-pax-text",ptwPopoverRoomTextId:t+"ptw-room-text",personText:n.popoverText.person,peopleText:n.popoverText.people,roomText:n.popoverText.room,roomsText:n.popoverText.rooms})).init()}(i=new m({roomsSelector:"#ap_booker_Hotel_rooms",roomsTemplateSelector:".ap_roomOccupancy_template",roomsContainerSelector:".ap_roomOccupancy_container",roomsTemplateBaseId:"ap_booker_Hotelroom",minorsAgesSelector:".ap_booker_Hotel_minors",minorsAgesTemplateSelector:".ap_minorAge_template",minorsAgesContainerBaseSelector:"#ap_minorsAges_Hotel_container",minorsAgesTemplateBaseId:"ap_booker_Hotel_minorAge",minorsAgesAltValueBaseSelector:"#ap_booker_Hotel_minorsAges",minorsAgesContainerBaseId:"ap_minorsAges_Hotel_container",minorsAgesContainerContainerSelector:".ap_booker_Hotel_minorsAgesContainer",adultsTemplateBaseId:"ap_booker_Hotel_adults",totalMinorsAgesSelector:"#ap_booker_hotel_totalMinorsAges",totalMinorsSelector:"#ap_booker_hotel_totalMinors",totalAdultsSelector:"#ap_booker_hotel_totalAdults",calculateTotals:!0,bookerSelector:n.selector,errors:{emptyMinorAge:n.texts.MinorsAgesError},manageRoomsClone:function(e,t,a){e.find(".ap_index").html(a+1),e.attr("id","ap_booker_Hotelroom"+a).removeClass("ap_roomOccupancy_template"),e.find("#ap_booker_Hotel_adults").attr("id","ap_booker_Hotel_adults"+a).removeClass("ap-data_room-").addClass("ap-data_room-"+a),e.find("#ap_booker_Hotel_minors").attr("id","ap_booker_Hotel_minors"+a).removeClass("ap-data_room-").addClass("ap-data_room-"+a),e.find("#ap_booker_Hotel_minorsAges").attr("id","ap_booker_Hotel_minorsAges"+a).removeClass("ap-data_room-").addClass("ap-data_room-"+a),e.appendTo(t)},manageMinorsAgesClone:function(e,t,a,o){e.find(".ap_index").html(o+1),e.attr("id","ap_booker_Hotel_minorAge"+o+a).removeClass("ap_minorAge_template").removeClass("ap-data_room-").addClass("ap-data_room-"+o),e.find(".Err_MinorsAge").attr("id","Err_HotelRooms_"+a+"__MinorsAges_"+o+"__Years"),e.appendTo(t)},minorsAgesContainerTemplateSelector:"#ap_minorsAges_Hotel_containerTemplate",onUpdatePopover:!0===n.usePopover?c:void 0})).init(),u(n.formMappingForm).attr("action",n.submitUri),r()},fillAndValidate:function(){var e=t();return u.when.apply(u,e).pipe(function(){return 0==n.skipValidation?function(){var t=new h,e=[];(e=e.concat(function(e){for(var t=[],a=0;a<e.autocompletes.length;a++)t.push(e.autocompletes[a].instance.validate({errorClass:"inputError"}));return t}(n.autocomplete))).push(o.validate({errorClass:"inputError",validateEmpty:!1})),e.push(i.validate({errorClass:"inputError",maxPassengers:n.maxPassengers}));var a=new u.Deferred;return t.showErrors(e,n.errorsSelector).done(function(e){n.formMappingForm&&(t.fill(n.formMapping,n.selector),0==e&&a.resolve()),a.reject()}),a.promise()}():{}})},toggleVisible:0!=n.usePopover?function(){if(null!=a)return a.toggleVisible}:void 0}}}),define("infant",["jquery"],function(f){return function(e){var s=0,l=f.extend({},{adultsSelector:".ap_booker_flight_adults",infantSelector:".ap_booker_flight_infants",nameHidden:["AgeInfants"],agesHidden:[""],multipleDestinations:"MultipleDestinations",containerRoom:"",workSpaces:[]},e),c=function(e){return void 0===e&&null===e},i=function(e,t,a,o){f("option",t).remove();var i=0;for(a=c(a)?0:a,1*e<1&&(e=0);0<=e;e--){var n=f("<option>").attr("value",i).text(i);t.append(n),i++}i--,i=a<0?i:0<a?a--:0,f("option:eq("+i+")",t).prop("selected",!0),"function"==typeof o&&o(t)},n=function(e,t){for(var a=e[0],o=e,i=o.siblings("input[type='hidden'][name='"+t.nameHidden+"']"),n=1*a.value,r=[];0<n;n--)r.push("0");var s={type:"hidden",value:"0",name:"",class:"",id:""},l={};if(i.length?i.val(r.join()):(l=f.extend({},s,{value:r.join(),name:t.nameHidden,id:t.nameHidden}),h(l).insertBefore(o)),r.length||i.remove(),!t.agesHidden.length)return!1;var c=".{id}ages".replace("{id}",a.id),u=f(c);null!=t.containerRoom&&(u=f("input"+c,t.containerRoom)),u.remove();for(var p=r.length-1;0<=p;p--){var d=t.agesHidden.replace("{0}",p),m=o.siblings("input[type='hidden'][name='"+d+"']");null!=t.containerRoom&&(m=f("input[type='hidden'][name='"+d+"']:first",t.containerRoom)),m.length?m.val("0"):(l=f.extend({},s,{name:d,id:d,class:"{id}ages".replace("{id}",a.id)}),h(l).insertBefore(o))}return r.length-1<0?(i.remove(),!1):void 0},h=function(e){return f("<input>",e)},r=function(e,t){var a=1*e.value,o=1*t.infant.val();a<o&&(o=a),0===o&&(o=a),0===t.default&&(o=t.default),i(a,t.infant,o,function(e){n(e,t)})},u=function(o,e,t){if(!o.infant.length)return!1;e="boolean"==typeof e&&e,o.adults.change(function(e){var t=Object.assign({},o),a=1*o.infant.val();return t.default=0<a?a:0,r(this,t),!1}),o.infant.change(function(e){n(f(this),o)});var a=o.adults.val();i(1*a,o.infant,o.default),e&&r(o.adults[0],o),"function"==typeof t&&t()},a=function(e){if(!e.length)return!1;e.val(0),e.trigger("change")},p=function(e,t){a(e),t.attr("style","display: none")},d=function(e,t){e.val(s),e.trigger("change"),t.attr("style","display: ")};return{init:function(){var e=f(l.infantSelector);if(!e.length)return!1;var t=f(l.adultsSelector),a=t.length-1,o={adults:t,infant:e,nameHidden:l.nameHidden.join("."),agesHidden:l.agesHidden.join("."),default:null!=e?1*e.val():0,containerRoom:null};if(a<=0)return l.workSpaces[e[0].id]=o,u(o,!0),!1;for(;0<=a;a--){var i=f(t[a]),n=i.parents(l.containerRoom+":first"),r=i.attr("name").split(".")[0].trim();e=f("select"+l.infantSelector+":first",n),o.adults=i,o.infant=e,c(e)?o.default=0:(l.nameHidden[0]=r,l.agesHidden[0]=r,o.nameHidden=l.nameHidden.join("."),o.agesHidden=l.agesHidden.join("."),o.default=1*e.val(),o.containerRoom=n);var s=Object.assign({},o);u(s,!0)}},change:u,clearAgeField:a,hidden:p,shown:d,multipleDestinations:function(e){var t=e.trim().toLowerCase(),a=l.multipleDestinations.trim().toLowerCase(),o=a===t||0<a.indexOf(t),i=f(l.infantSelector),n=i.parents("div.ptw-field-infants:first"),r=n.is(":visible");return s=1*i.val(),r&&o?(p(i,n),!1):r||o?void 0:(d(i,n),!1)}}}}),define("packageBooker",["jquery","../Common/autocomplete","../Common/calendar","minors","validation","../Common/popover","infant"],function(_,y,k,b,C,x,w){return function(e){var i,n,t,r,s=_.extend(!0,{texts:{},autocomplete:{originAutocomplete:[],destinationAutocomplete:[]},calendar:{calendars:[],typePopUp:"nights"},keyValueText:[],prefix:"",maxPassengers:0,destinationaAutocompleteSliceSize:15,usePopover:!1,ptwInfantTextsId:"ptw-flight-infant-text",ptwInfantContainerId:"ptw-flight-infant-text-container"},e),o=[];_(".icon-calendar").click(function(){_(this).siblings(".ui-datepicker-trigger").click()});var a=function(e){void 0!==t&&t.setOccupaton(e)},l=function(){_(".ap_booker_submit",s.selector).prop("disabled",!1),_("body").delegate(s.selector+" .ap_removeCard","click",function(e){e.preventDefault(),_("#UseSingleHotelQuoteMode").val("False"),_(this).closest(".ap_field").hide(),_("#Searchbox_PostUrl",s.selector).val(_("#Searchbox_PostUrl2",s.selector).val()),s.texts.SearchButtonText&&""!=s.texts.SearchButtonText&&_(".ap_booker_submit",s.selector).val(s.texts.SearchButtonText)}),_("body").delegate(".change_destination","change",function(e){e.preventDefault(),_("#UseSingleHotelQuoteMode").val("False"),_("#Searchbox_PostUrl",s.selector).val(_("#Searchbox_PostUrl2",s.selector).val()),s.texts.SearchButtonText&&""!=s.texts.SearchButtonText&&_(".ap_booker_submit",s.selector).val(s.texts.SearchButtonText)}),null!=s.hotelCalendar&&v()},c=function(e,t){e.instance=new y({selector:e.selector,uri:t,isNotAsync:e.isNotAsync,mapping:function(e){return{label:e.Name+" ("+e.Code+")",value:e.Name+" ("+e.Code+")",description:e.Description,altValue:e.Code,restrictions:e.Restrictions}},queryName:"query",data:{verifyDestinations:!1,gtOrigin:!0,isNotAsync:e.isNotAsync},errors:e.errors,onSelectCallback:function(e){m(e.item.restrictions)},onClear:function(){if(0<o.length)for(var e=0;e<s.destinationAutocomplete.autocompletes.length;e++)_(s.destinationAutocomplete.autocompletes[e].selector).val(""),_(s.destinationAutocomplete.autocompletes[e].selector).autocomplete("destroy"),_(s.destinationAutocomplete.autocompletes[e].selector).unbind("keyup"),u(s.destinationAutocomplete.autocompletes[e],s.destinationAutocomplete.uri)},sliceSize:null!=e.sliceSize?e.sliceSize:s.destinationaAutocompleteSliceSize}),e.instance.init()},u=function(e,t,a){e.instance=new y({selector:e.selector,uri:t,isNotAsync:e.isNotAsync,source:a,mapping:function(e){return{label:""!=e.Name?e.City:e.Description,description:""!=e.Name?e.Name+" ("+e.Code+")":e.Description,value:e.Description,altValue:e.Code,uri:e.Uri,display:e.City,mappingId:e.MappingId,mappingType:e.MappingType,name:e.Name}},queryName:"query",data:{compareType:"initial",verifyDestinations:!1,restrictions:function(){return o},isNotAsync:e.isNotAsync},errors:e.errors,onSelectCallback:function(e){p(e.item.mappingType,e.item.mappingId,e.item.uri,e.item.display)},sliceSize:null!=e.sliceSize?e.sliceSize:s.destinationaAutocompleteSliceSize}),e.instance.init().done(function(e){0<e.length&&(e.data("ui-autocomplete")._renderItem=function(e,t){return""!=t.name?_("<li>").append("<a><strong>"+t.label+"</strong><br /><span>"+t.description+"</span></a>").appendTo(e):_("<li><a>"+t.description+"</a></li>").appendTo(e)})})},p=function(e,t,a,o){_("#ap_dest_flightPackage_display").val(o),_("#ap_dest_flightPackage_mappingId").val(t),_("#ap_dest_flightPackage_mappingType").val(e),_("#ap_dest_flightPackage_uri").val(a)},d=function(e){var t=[];if(null!=e||null!=e)for(var a=0;a<e.length;a++){var o=e[a],i={label:o.Description,description:o.Description,altValue:o.Code,uri:"",display:o.Description,mappingId:o.MappingId,mappingType:o.MappingType,name:""};t.push(i)}return t},m=function(e){if(null!=e&&null!=e&&0<e.length){o=h(e);for(var t=0;t<s.destinationAutocomplete.autocompletes.length;t++){_(s.destinationAutocomplete.autocompletes[t].selector).autocomplete("destroy"),_(s.destinationAutocomplete.autocompletes[t].selector).unbind("keyup");(function(e,a){_.ajax({url:s.destinationAutocomplete.uri+"?jsoncallback=?",dataType:"jsonp",data:{query:"",compareType:"initial",verifyDestinations:!1,restrictions:function(){return o}},success:function(e){var t=d(e);u(s.destinationAutocomplete.autocompletes[a],s.destinationAutocomplete.uri,t)}})})(0,t)}}},h=function(e){var t=[];if(null!=e||null!=e&&0<e.length)for(var a=0;a<e.length;a++){var o=e[a].AirportCode;-1==_.inArray(o,t)&&t.push(o)}return t},f=function(e){for(var t=[],a=0;a<e.autocompletes.length;a++)t.push(e.autocompletes[a].instance.validate({errorClass:"inputError"}));return t},g=function(){var e=new Array;return e=e.concat(function(o){for(var e=[],t=0;t<o.autocompletes.length;t++)!function(a){e.push(o.autocompletes[a].instance.fill({revalidateUri:o.revalidateUri}).done(function(e){if(e&&0<e.length){var t=e[0];_(o.autocompletes[a].selector).val(t.Name+" ("+t.Code+")"),_(o.autocompletes[a].instance.getAltSelector()).val(t.Code)}}))}(t);return e}(s.originAutocomplete),function(o){for(var e=[],t=0;t<o.autocompletes.length;t++)!function(a){e.push(o.autocompletes[a].instance.fill({revalidateUri:o.revalidateUri}).done(function(e){if(e&&0<e.length){var t=e[0];_(o.autocompletes[a].selector).val(t.City+" ("+t.Code+")"),_(o.autocompletes[a].instance.getAltSelector()).val(t.Code),p(t.MappingType,t.MappingId,t.Uri,t.City)}}))}(t);return e}(s.destinationAutocomplete))},v=function(){var e=_("#ap_flightPackage_partialStay_hidden"),t=e.val();_("#partialStayCheck").on("click",function(){_("#partialStayContainer").toggleClass("ptw-hide"),t="False"==t?"True":"False",e.val(t)})};return{code:s.code,isActive:s.isActive,init:function(){s.selector="#"+s.prefix+"_"+s.code,s.usePopover&&(t=new x({ptwTravelersLinkId:"ptw-travelers-link",ptwPopoverCloseId:"ptw-popover-close",ptwPopoverId:"ptw-fp-popover",attr:"data-id",ptwPopoverRoomsId:"ptw-num-rooms",personText:s.popoverText.person,peopleText:s.popoverText.people,roomText:s.popoverText.room,roomsText:s.popoverText.rooms,useInfantTexts:!0,ptwPopoverInfantTexts:"ptw-flight-infant-text",ptwPopoverInfantContainer:"ptw-flight-infant-text-container",mainPopoverContainerId:"#"+s.prefix+"_"+s.code})).init();for(var e=0;e<s.originAutocomplete.autocompletes.length;e++)c(s.originAutocomplete.autocompletes[e],s.originAutocomplete.uri);for(e=0;e<s.destinationAutocomplete.autocompletes.length;e++)u(s.destinationAutocomplete.autocompletes[e],s.destinationAutocomplete.uri);(i=new k(s.calendar)).init(),new k(s.hotelCalendar).init();var o="ap_booker_FlightPackageroom";n=new b({roomsSelector:"#ap_booker_FlightPackage_rooms",roomsTemplateSelector:".ap_roomOccupancy_template",roomsContainerSelector:".ap_roomOccupancy_container",roomsTemplateBaseId:o,minorsAgesSelector:".ap_booker_FlightPackage_minors",minorsAgesTemplateSelector:".ap_minorAge_template",minorsAgesContainerBaseSelector:"#ap_minorsAges_FlightPackage_container",minorsAgesTemplateBaseId:"ap_booker_FlightPackage_minorAge",minorsAgesAltValueBaseSelector:"#ap_booker_FlightPackage_minorsAges",minorsAgesContainerBaseId:"ap_minorsAges_FlightPackage_container",minorsAgesContainerContainerSelector:".ap_booker_FlightPackage_minorsAgesContainer",adultsTemplateBaseId:"ap_booker_FlightPackage_adults",totalMinorsAgesSelector:"#ap_booker_FlightPackage_totalMinorsAges",totalMinorsSelector:"#ap_booker_FlightPackage_totalMinors",totalAdultsSelector:"#ap_booker_FlightPackage_totalAdults",calculateTotals:!0,bookerSelector:s.selector,errors:{maxPassengers:s.texts.MaxPassengers,emptyMinorAge:s.texts.MinorsAgesError},manageRoomsClone:function(e,t,a){e.find(".ap_index").html(a+1),e.attr("id",o+a).removeClass("ap_roomOccupancy_template"),e.find("#ap_booker_FlightPackage_adults").attr("id","ap_booker_FlightPackage_adults"+a).removeClass("ap-data_room-").addClass("ap-data_room-"+a),e.find("#ap_booker_FlightPackage_minors").attr("id","ap_booker_FlightPackage_minors"+a).removeClass("ap-data_room-").addClass("ap-data_room-"+a),e.find("#ap_booker_FlightPackage_minorsAges").attr("id","ap_booker_FlightPackage_minorsAges"+a).removeClass("ap-data_room-").addClass("ap-data_room-"+a),e.find("#ap_booker_FlightPackage_infants").attr("id","ap_booker_FlightPackage_infants"+a).removeClass("ap-data_room-").addClass("ap-data_room-"+a),e.find(".Err_Infants").attr("id","Err_HotelRooms_"+a+"__Infants"),e.appendTo(t)},manageMinorsAgesClone:function(e,t,a,o){e.find(".ap_index").html(o+1),e.attr("id","ap_booker_FlightPackage_minorAge"+o+a).removeClass("ap_minorAge_template").removeClass("ap-data_room-").addClass("ap-data_room-"+o),e.find(".Err_MinorsAge").attr("id","Err_HotelRooms_"+a+"__MinorsAges_"+o+"__Years"),e.appendTo(t)},minorsAgesContainerTemplateSelector:"#ap_minorsAges_FlightPackage_containerTemplate",onUpdatePopover:!0===s.usePopover?a:void 0,changeInfant:function(e,t){var a="HotelRooms[{roomId}].{field}".replace("{roomId}",t),o={adults:_(".ap_booker_FlightPackage_adults:first",_(e)),infant:_(".ap_booker_FlightPackage_infants:first",_(e)),nameHidden:a.replace("{field}","AgeInfant"),agesHidden:a.replace("{field}","InfantsAges[{0}].Years"),containerRoom:".ap_booker_FlightPackageroom",default:0};r.change(o,!0)},clearFieldAgeInfant:function(e,t,a){for(;e<=t;t--){var o=_(".ap_booker_FlightPackage_infants:first",_(a+t));r.clearAgeField(o)}}}),_(s.formMappingForm).attr("action",s.submitUri),(r=new w({adultsSelector:"."+o+" .ap_booker_FlightPackage_adults",infantSelector:".ap_booker_FlightPackage_infants",nameHidden:["HotelRooms[0]","AgeInfant"],agesHidden:["'HotelRooms[0]","InfantsAges[{0}].Years"],containerRoom:".ap_booker_FlightPackageroom"})).init(),n.init(),l()},fillAndValidate:function(){var e=g();return _.when.apply(_,e).pipe(function(){var e=_("#Searchbox_IsProductDetail",s.selector);if(0<e.length&&"True"==e.val()){var t=_("#ap_dest_originalReturningAirportCode",s.selector).val(),a=_("#ap_dest_flightPackage_hidden",s.selector).val();void 0!==a&&a!=t&&_("#Searchbox_PostUrl",s.selector).val(_("#Searchbox_PostUrl2",s.selector).val())}return 0==s.skipValidation?function(){var t=C(),e=[];(e=e.concat(f(s.originAutocomplete),f(s.destinationAutocomplete))).push(i.validate({errorClass:"inputError",validateEmpty:!0,optionCode:s.currentTripOptionCode})),e.push(n.validate({errorClass:"inputError",maxPassengers:s.maxPassengers}));var a=new _.Deferred;return t.showErrors(e,s.errorsSelector).done(function(e){s.formMappingForm&&(t.fill(s.formMapping,s.selector),0==e&&a.resolve()),a.reject()}),a.promise()}():{}})},toggleVisible:0!=s.usePopover?function(){if(null!=t)return t.toggleVisible}:void 0}}}),define("flightBooker",["jquery","../Common/autocomplete","../Common/calendar","minors","../Common/getDataValue","validation","../Common/popover","infant"],function(D,S,T,I,M,P,F,E){return function(e){var n,r,c,u,s,p="MultipleDestinations",d=D.extend({},{departureAutocomplete:{autocompletes:[]},arrivalAutocomplete:{autocompletes:[]},calendar:{calendars:[]},skipValidation:!1,formMapping:[],tripOptions:[],prefix:"",multiDestinationFlightsBase:0,multiDestinationFlights:[],maxPassengers:0,texts:{}},e),l=[],m=new E({adultsSelector:".ap_booker_flight_adults",infantSelector:".ap_booker_flight_infants"});D(".icon-calendar").click(function(){D(this).siblings(".ui-datepicker-trigger").click()});var h=function(e){for(var t=0;t<e.autocompletes.length;t++){f(e.autocompletes[t],e.uri);var a=e.autocompletes[t].flightIndex;if(null!=a){var o=k(d.multiDestinationFlights,a),i=!1;-1==o&&(o={index:a,autocompletes:[],calendars:[]},i=!0),o.autocompletes.push(e.autocompletes[t].instance),1==i&&d.multiDestinationFlights.push(o)}}},f=function(e,t,a){var o=!0;null!=e.isOrigin&&null!=e.isOrigin&&(o=e.isOrigin),e.instance=new S({selector:e.selector,uri:t,isNotAsync:e.isNotAsync,source:a,mapping:function(e){return{label:e.Name+" ("+e.Code+")",value:e.Name+" ("+e.Code+")",altValue:e.Code,country:e.Country,mappingId:e.MappingId,mappingType:e.MappingType,restrictions:e.Restrictions}},data:{query:function(){return D(e.selector).val()},verifyDestinations:!1,restrictions:function(){return l},gtOrigin:o,isNotAsync:e.isNotAsync},errors:e.errors,onSelectCallback:function(e,t){i(t,e.item.country,e.item.mappingId,e.item.mappingType,e.item.restrictions)}}),e.instance.init()},i=function(e,t,a,o,i){if(D(e+"_country").val(t),D(e+"_mappingId").val(a),D(e+"_mappingType").val(o),l=g(i),null!=i&&null!=i&&0<i.length)for(var n=0;n<d.arrivalAutocomplete.autocompletes.length;n++){D(d.arrivalAutocomplete.autocompletes[n].selector).autocomplete("destroy");(function(i){D.ajax({url:d.arrivalAutocomplete.uri+"?jsoncallback=?",dataType:"jsonp",data:{query:"",verifyDestinations:!1,gtOrigin:!0,restrictions:function(){return l}},success:function(e){console.log(e);for(var t=[],a=0;a<e.length;a++){var o={label:e[a].Name+" ("+e[a].Code+")",value:e[a].Name+" ("+e[a].Code+")",altValue:e[a].Code,country:e[a].Country,mappingId:e[a].MappingId,mappingType:e[a].MappingType,restrictions:e[a].Restrictions};t.push(o)}f(d.arrivalAutocomplete.autocompletes[i],d.arrivalAutocomplete.uri,t)}})})(n)}},g=function(e){var t=[];if(null!=e||null!=e&&0<e.length)for(var a=0;a<e.length;a++){var o=e[a].AirportCode;-1==D.inArray(o,t)&&t.push(o)}return t},v=function(e){for(var t=0;t<d.departureAutocomplete.autocompletes.length;t++)if(d.departureAutocomplete.autocompletes[t].selector==e.selector){d.departureAutocomplete.autocompletes.splice(t,1);break}for(t=0;t<d.arrivalAutocomplete.autocompletes.length;t++)if(d.arrivalAutocomplete.autocompletes[t].selector==e.selector){d.arrivalAutocomplete.autocompletes.splice(t,1);break}},_=function(e){for(var t=0;t<c.calendars.length;t++)if(c.calendars[t].selector==e.selector){c.calendars.splice(t,1);break}for(t=0;t<d.calendar.calendars.length;t++)if(d.calendar.calendars[t].selector==e.selector){d.calendar.calendars.splice(t,1);break}},y=function(){D(".ap_flightTitle",d.templateParentSelector).each(function(e){D(this).find("span.ap_fn").html(e+1)})},k=function(e,t){for(var a=0;a<e.length;a++)if(e[a].index==t)return e[a];return-1},b=function(e){e=e&&""!=e?e:d.tripOption[0].code,D(".ap_flightType",d.selector).removeClass("active"),D(".ap-data_tripMode-"+e,d.selector).addClass("active");var t=o(e);d.currentTripOptionCode=t.code,D("."+d.prefix+"_flightType").hide(),D(t.exceptionsSelector,"#"+d.prefix+"_"+t.destinationTypeCode).hide();for(var a=0;a<d.tripOptions.length;a++)d.tripOptions[a].code!=t.code&&D(d.tripOptions[a].exceptionsSelector,"#"+d.prefix+"_"+d.tripOptions[a].destinationTypeCode).show();m.multipleDestinations(e),D("#"+d.prefix+"_"+t.destinationTypeCode).show(),D(d.tripOptionSelector).val(t.code)},o=function(e){for(var t=0;t<d.tripOptions.length;t++)if(d.tripOptions[t].code==e)return d.tripOptions[t];return null},C=function(){D(".ap_booker_submit",d.selector).prop("disabled",!1),D(d.addFlightsButtonSelector,d.selector).click(function(e){e.preventDefault();var a=function(e){for(var t=-1,a=0;a<e.length;a++)e[a].index>t&&(t=e[a].index);return t}(d.multiDestinationFlights)+1,t=u.clone();t.attr("id","ap_booker_multiTemplate"+a),t.find(".ap_flightRemove").attr("class","ap_flightRemove ap-data_flight-"+a),t.find("#ap_flight_index").attr("id","ap_flight_index"+a).val(a),t.find("input.ap_collection").each(function(){var e=D(this).attr("name")||"",t=D(this).attr("id")||"";D(this).attr("name",e.replace("{0}",a)),D(this).attr("id",t.replace("{0}",a))}),t.find(".ptw-errormsg").each(function(){var e=D(this).attr("id")||"";D(this).attr("id",e.replace("{0}",a))}),t.find("label.ap_collection").each(function(){var e=D(this).attr("for")||"";D(this).attr("for",e.replace("{0}",a))}),t.appendTo(d.templateParentSelector);var o=k(d.multiDestinationFlights,a-1),i=[],n=[];i.push({selector:"#ap_origin_multi_flight"+a,optionCodes:[p],errors:o.autocompletes[0].errors}),n.push({selector:"#ap_dest_multi_flight"+a,optionCodes:[p],errors:o.autocompletes[1].errors});var r=[];r.push({selector:"#ap_flight_multi_calendar"+a,optionCodes:[p],errors:o.calendars[0].errors});for(var s={index:a,autocompletes:[],calendars:[]},l=0;l<i.length;l++)f(i[l],d.departureAutocomplete.uri),d.departureAutocomplete.autocompletes.push(i[l]),s.autocompletes.push(i[l]);for(l=0;l<n.length;l++)f(n[l],d.arrivalAutocomplete.uri),d.arrivalAutocomplete.autocompletes.push(n[l]),s.autocompletes.push(n[l]);for(l=0;l<r.length;l++)c.addCalendar(r[l],!0),s.calendars.push(r[l]);d.multiDestinationFlights.push(s),D(".ui-datepicker").each(function(){var e=D(this).attr("id");0==D("#"+e).parent(".pt-customJqueryUi").length&&(0==D(".pt-customJqueryUi").length?D("#"+e).wrap("<div class='pt-customJqueryUi' />"):D(".pt-customJqueryUi").append(D("#"+e)))}),D(".ui-PT-autocomplete").each(function(){var e=D(this).attr("id");0==D("#"+e).parent(".pt-customJqueryUi").length&&(0==D(".pt-customJqueryUi").length?D("#"+e).wrap("<div class='pt-customJqueryUi' />"):D(".pt-customJqueryUi").append(D("#"+e)))}),y()}),D(d.selector).on("click",d.tripOptionsSelector,function(e){var t=M(this,"tripMode");b(t)}),D("#Cabin").val("N"),D("#flight_preferences_toggle").click(function(e){e.preventDefault(),D("#flight_preferences").toggle()}),D(d.selector).on("click",".ap_flightRemove",function(e){e.preventDefault();var t=parseInt(M(this,"flight")),a=k(d.multiDestinationFlights,t);if(-1!=a){for(var o=0;o<a.autocompletes.length;o++)v(a.autocompletes[o]);for(o=0;o<a.calendars.length;o++)_(a.calendars[o]);for(o=0;o<d.multiDestinationFlights.length;o++)d.multiDestinationFlights[o].index==t&&d.multiDestinationFlights.splice(o,1);D("#ap_booker_multiTemplate"+a.index,d.selector).fadeOut(200),D("#ap_booker_multiTemplate"+a.index,d.selector).promise().done(function(){D(this).remove(),y()})}})},t=function(o){for(var e=[],t=0;t<o.autocompletes.length;t++)-1!=D.inArray(d.currentTripOptionCode,o.autocompletes[t].optionCodes)&&function(a){e.push(o.autocompletes[a].instance.fill({revalidateUri:o.revalidateUri}).done(function(e){if(e&&0<e.length){var t=e[0];D(o.autocompletes[a].selector).val(t.Name+" ("+t.Code+")"),D(o.autocompletes[a].instance.getAltSelector()).val(t.Code)}}))}(t);return e},x=function(e){for(var t=[],a=0;a<e.autocompletes.length;a++)e.autocompletes[a].optionCodes=e.autocompletes[a].optionCodes||[],-1!=D.inArray(d.currentTripOptionCode,e.autocompletes[a].optionCodes)&&t.push(e.autocompletes[a].instance.validate({errorClass:"inputError"}));return t},a=function(){var e=new Array;return e=e.concat(t(d.departureAutocomplete),t(d.arrivalAutocomplete))},w=function(){var t=P(),e=[];(e=e.concat(x(d.departureAutocomplete),x(d.arrivalAutocomplete))).push(n.validate({errorClass:"inputError",validateEmpty:!0,optionCode:d.currentTripOptionCode})),d.currentTripOptionCode==p&&e.push(c.validate({errorClass:"inputError",validateEmpty:!0,optionCode:d.currentTripOptionCode})),e.push(r.validate({errorClass:"inputError",maxPassengers:d.maxPassengers}));var a=new D.Deferred;return t.showErrors(e,d.errorsSelector).done(function(e){d.formMappingForm&&(t.fill(d.formMapping,d.selector),0==e&&a.resolve()),a.reject()}),a.promise()},A=function(e){void 0!==s&&s.setOccupaton(e)};return{code:d.code,isActive:d.isActive,init:function(){d.selector="#"+d.prefix+"_"+d.code,u=D(d.templateSelector).clone(),d.currentTripOptionCode=D(d.tripOptionSelector,d.selector).val(),b(d.currentTripOptionCode),h(d.departureAutocomplete),h(d.arrivalAutocomplete),(n=new T(d.calendar)).init(),(c=new T(d.multiDestinationCalendar)).init();for(var e=0;e<c.calendars.length;e++){var t=c.calendars[e].flightIndex;if(null!=t){var a=k(d.multiDestinationFlights,t),o=!1;-1==a&&(a={index:t,autocompletes:[],calendars:[]},o=!0),a.calendars.push(c.calendars[e]),1==o&&d.multiDestinationFlights.push(a)}}if(d.usePopover){var i=d.servicePrefix;(s=new F({ptwTravelersLinkId:i+"ptw-travelers-link",ptwPopoverCloseId:i+"ptw-popover-close",ptwPopoverId:i+"ptw-fp-popover",attr:"data-id",ptwPopoverNumPaxId:i+"ptw-num-pax",ptwPopoverPaxTextId:i+"ptw-pax-text",personText:d.popoverText.person,peopleText:d.popoverText.people,roomText:d.popoverText.room,roomsText:d.popoverText.rooms,useInfantTexts:!0,ptwPopoverInfantTexts:"ptw-flight-infant-text",ptwPopoverInfantContainer:"ptw-flight-infant-text-container",mainPopoverContainerId:"#"+d.prefix+"_"+d.code})).init()}r=new I({minorsAgesSelector:".ap_booker_flight_minors",minorsAgesTemplateSelector:".ap_minorAge_template",minorsAgesContainerBaseSelector:"#ap_minorsAges_flight_container",minorsAgesTemplateBaseId:"ap_booker_flight_minorAge",minorsAgesAltValueBaseSelector:"#ap_booker_flight_minorsAges",minorsAgesContainerBaseId:"ap_minorsAges_flight_container",minorsAgesContainerContainerSelector:".ap_booker_flight_minorsAgesContainer",adultsTemplateBaseId:"ap_booker_flight_adults",bookerSelector:d.selector,currentMaxRooms:1,loadRooms:!1,errors:{maxPassengers:d.texts.MaxPassengers,emptyMinorAge:d.texts.MinorsAgesError},manageMinorsAgesClone:function(e,t,a,o){e.find(".ap_index").html(o+1);var i=e.find(".ap_age").attr("id");e.find(".ap_age").attr("id",i+a+o),e.find(".Err_MinorsAge").attr("id","Err_MinorsAges_"+o+"__Years"),e.attr("id","ap_booker_flight_minorAge"+o+a).removeClass("ap_minorAge_template").removeClass("ap-data_room-").addClass("ap-data_room-"+a),e.appendTo(t)},minorsAgesContainerTemplateSelector:"#ap_minorsAges_Flight_containerTemplate",onUpdatePopover:!0===d.usePopover?A:void 0}),m.init(),r.init(),C(),D(d.formMappingForm).attr("action",d.submitUri)},getTripOptions:o,fillAndValidate:function(){var e=a();return D.when.apply(D,e).pipe(function(){return 0==d.skipValidation?w():{}})},fill:a,validate:w,toggleVisible:0!=d.usePopover?function(){if(null!=s)return s.toggleVisible}:void 0}}}),define("busPackageBooker",["jquery","../Common/autocomplete","../Common/calendar","minors","validation","../Common/getDataValue","../Common/popover"],function(m,h,f,g,v,_,y){return function(e){var n,r,a,o,l=m.extend({},{texts:{},autocomplete:{autocompletes:[]},calendar:{calendars:[]},text:{},keyValueText:[],prefix:"",maxPassengers:0,originValue:0,destinationValue:0},e);m(".icon-calendar").click(function(){m(this).siblings(".ui-datepicker-trigger").click()});var i=function(){m(".ap_booker_submit",l.selector).prop("disabled",!1),m("body").delegate(l.selector+" .ap_removeCard","click",function(e){e.preventDefault(),m("#UseSingleHotelQuoteMode").val("False"),m(this).closest(".ap_field").hide(),m("#Searchbox_PostUrl",l.selector).val(m("#Searchbox_PostUrl2",l.selector).val()),l.texts.SearchButtonText&&""!=l.texts.SearchButtonText&&m(".ap_booker_submit",l.selector).val(l.texts.SearchButtonText)}),m("body").on("change",".ap_booker_BusPackage_adults",function(){var e=_(this,"room");if(""!=e){var t=parseInt(m(this).val()),a=parseInt(m(".ap_booker_BusPackage_minors.ap-data_room-"+e).val());s(t,a,e)}}),m("body").on("change",".ap_booker_BusPackage_minors",function(){var e=_(this,"room");if(""!=e){var t=parseInt(m(".ap_booker_BusPackage_adults.ap-data_room-"+e).val()),a=parseInt(m(this).val());s(t,a,e)}}),m("#ap_booker_busPackage_rooms").change(function(){a=m(this).val(),m(".ap_discount_BusPackage_container",l.selector+" form").attr("style","display:none"),m("select",m(".ap_discount_BusPackage_container",l.selector+" form")).attr("disabled","disabled");for(var e=0;e<a;e++)m("#ap_discount_BusPackage_container"+e,l.selector+" form").attr("style","display:"),m("select","#ap_discount_BusPackage_container"+e).removeAttr("disabled");m(".ap_booker_BusPackage_adults").trigger("change"),m(".ap_booker_BusPackage_minors").trigger("change")}),m("#ap_booker_busPackage_rooms").trigger("change"),m("body").on("click",".ap_BusPackage_addDiscount",function(e){e.preventDefault(),m(".ap_booker_BusPackage_discountContainer").toggle()})},s=function(e,t,a){if(a=parseInt(a),0==m("#ap_discount_BusPackage_container"+a).length){var o=m("#ap_discount_BusPackage_containerTemplate").clone();o.find(".ap_index").html(a+1),o.attr("id","ap_discount_BusPackage_container"+a),o.appendTo(".ap_booker_BusPackage_discountContainer")}m(".ap_passengerType","#ap_discount_BusPackage_container"+a).attr("style","display:none"),m(".ap_passengerType select","#ap_discount_BusPackage_container"+a).attr("disabled","disabled");for(var i=0;i<e;i++){if(0==m("#ap_passengerType_"+i,"#ap_discount_BusPackage_container"+a).length){var n=m(".ap_passengerType_template",l.selector).clone();n.removeClass("ap_passengerType_template"),n.attr("id","ap_passengerType_"+i),(n=c(n,i,a)).appendTo("#ap_discount_BusPackage_container"+a+" .ap_discount_adults")}m("#ap_passengerType_"+i,"#ap_discount_BusPackage_container"+a).attr("style","display:"),m("#ap_passengerType_"+i+" select","#ap_discount_BusPackage_container"+a).removeAttr("disabled")}for(var r=0;r<t;r++){if(0==m("#ap_passengerTypeMinor_"+r,"#ap_discount_BusPackage_container"+a).length){var s=m(".ap_passengerTypeMinor_template",l.selector).clone();s.removeClass("ap_passengerTypeMinor_template"),s.attr("id","ap_passengerTypeMinor_"+r),(s=c(s,r,a)).appendTo("#ap_discount_BusPackage_container"+a+" .ap_discount_minors")}m("#ap_passengerTypeMinor_"+r,"#ap_discount_BusPackage_container"+a).attr("style","display:"),m("#ap_passengerTypeMinor_"+r+" select","#ap_discount_BusPackage_container"+a).removeAttr("disabled")}},c=function(e,a,o){return e.find(".ap_index").html(a+1),e.find(".ap_collection").each(function(){var e=m(this).attr("name")||"",t=m(this).attr("id")||"";m(this).attr("name",e.replace("{0}",o).replace("{1}",a)),m(this).attr("id",t.replace("_0_",o).replace("_1_",a))}),e},u=function(e,t){e.instance=new h({selector:e.selector,uri:t,mapping:function(e){return{label:e.search,value:e.search,altValue:e.id}},data:{query:function(){return m(e.selector).val()}},errors:e.errors,onSelectCallback:function(e){p(e.item.altValue)}}),e.instance.init()},p=function(e){m.ajax({url:l.destinationDropDownSource+"?jsoncallback=?",dataType:"jsonp",data:{originOfficeId:e}}).done(function(e){m(l.destinationDropDownSelector).empty(),m("<option/>",{value:0,text:l.texts.SelectText}).appendTo(l.destinationDropDownSelector);for(var t=0;t<e.length;t++)m("<option/>",{value:e[t].id,text:e[t].name,selected:e[t].id==l.destinationValue}).appendTo(l.destinationDropDownSelector)})},t=function(){var e=[];return e=e.concat(function(o){for(var e=[],t=0;t<o.autocompletes.length;t++)!function(a){e.push(o.autocompletes[a].instance.fill({revalidateUri:o.revalidateUri}).done(function(e){if(e&&0<e.length){var t=e[0];m(o.autocompletes[a].selector).val(t.search),m(o.autocompletes[a].instance.getAltSelector()).val(t.id),p(t.id)}}))}(t);return e}(l.autocomplete))},d=function(e){void 0!==o&&o.setOccupaton(e)};return{code:l.code,isActive:l.isActive,init:function(){l.selector="#"+l.prefix+"_"+l.code;for(var e=0;e<l.autocomplete.autocompletes.length;e++)u(l.autocomplete.autocompletes[e],l.autocomplete.uri);if((r=new f(l.calendar)).init(),l.usePopover){var t=l.servicePrefix;(o=new y({ptwTravelersLinkId:t+"ptw-travelers-link",ptwPopoverCloseId:t+"ptw-popover-close",ptwPopoverId:t+"ptw-fp-popover",attr:"data-id",ptwPopoverRoomsId:t+"ptw-num-rooms",ptwPopoverNumPaxId:t+"ptw-num-pax",ptwPopoverPaxTextId:t+"ptw-pax-text",ptwPopoverRoomTextId:t+"ptw-room-text",personText:l.popoverText.person,peopleText:l.popoverText.people,roomText:l.popoverText.room,roomsText:l.popoverText.rooms})).init()}(n=new g({roomsSelector:"#ap_booker_busPackage_rooms",roomsTemplateSelector:".ap_roomOccupancy_template",roomsContainerSelector:".ap_roomOccupancy_container",roomsTemplateBaseId:"ap_booker_BusPackageroom",minorsAgesSelector:".ap_booker_BusPackage_minors",minorsAgesTemplateSelector:".ap_minorAge_template",minorsAgesContainerBaseSelector:"#ap_minorsAges_BusPackage_container",minorsAgesTemplateBaseId:"ap_booker_BusPackage_minorAge",minorsAgesAltValueBaseSelector:"#ap_booker_BusPackage_minorsAges",minorsAgesContainerBaseId:"ap_minorsAges_BusPackage_container",minorsAgesContainerContainerSelector:".ap_booker_BusPackage_minorsAgesContainer",adultsTemplateBaseId:"ap_booker_BusPackage_adults",totalMinorsAgesSelector:"#ap_booker_BusPackage_totalMinorsAges",totalMinorsSelector:"#ap_booker_BusPackage_totalMinors",totalAdultsSelector:"#ap_booker_BusPackage_totalAdults",calculateTotals:!0,bookerSelector:l.selector,errors:{emptyMinorAge:l.texts.MinorsAgesError},manageRoomsClone:function(e,t,a){e.find(".ap_index").html(a+1),e.attr("id","ap_booker_BusPackageroom"+a).removeClass("ap_roomOccupancy_template"),e.find("#ap_booker_BusPackage_adults").attr("id","ap_booker_BusPackage_adults"+a).removeClass("ap-data_room-").addClass("ap-data_room-"+a),e.find("#ap_booker_BusPackage_minors").attr("id","ap_booker_BusPackage_minors"+a).removeClass("ap-data_room-").addClass("ap-data_room-"+a),e.find("#ap_booker_BusPackage_minorsAges").attr("id","ap_booker_BusPackage_minorsAges"+a).removeClass("ap-data_room-").addClass("ap-data_room-"+a),e.appendTo(t)},manageMinorsAgesClone:function(e,t,a,o){e.find(".ap_index").html(o+1),e.attr("id","ap_booker_BusPackage_minorAge"+o+a).removeClass("ap_minorAge_template").removeClass("ap-data_room-").addClass("ap-data_room-"+o),e.find(".Err_MinorsAge").attr("id","Err_HotelRooms_"+a+"__MinorsAges_"+o+"__Years"),e.appendTo(t)},minorsAgesContainerTemplateSelector:"#ap_minorsAges_BusPackage_containerTemplate",onUpdatePopover:!0===l.usePopover?d:void 0})).init(),i(),0!=l.originValue&&p(l.originValue),a=parseInt(m("#ap_booker_busPackage_rooms").val()),m(l.formMappingForm).attr("action",l.submitUri)},fillAndValidate:function(){var e=t();return m.when.apply(m,e).pipe(function(){return 0==l.skipValidation?function(){var e,t,a=v(),o=[];(o=o.concat(function(e){for(var t=[],a=0;a<e.autocompletes.length;a++)t.push(e.autocompletes[a].instance.validate({errorClass:"inputError"}));return t}(l.autocomplete))).push((e=new m.Deferred,t=[],m(l.destinationDropDownSelector).removeClass("inputError"),0==m(l.destinationDropDownSelector).val()&&(m(l.destinationDropDownSelector).addClass("inputError"),t.push({key:l.destinationDropDownSelector,value:l.texts.DestinationNotSelected})),e.resolve(t),e.promise())),o.push(r.validate({errorClass:"inputError",validateEmpty:!0})),o.push(n.validate({errorClass:"inputError",maxPassengers:l.maxPassengers}));var i=new m.Deferred;return a.showErrors(o,l.errorsSelector).done(function(e){l.formMappingForm&&(a.fill(l.formMapping,l.selector),0==e&&i.resolve()),i.reject()}),i.promise()}():{}})},toggleVisible:0!=l.usePopover?function(){if(null!=o)return o.toggleVisible}:void 0}}}),define("busBooker",["jquery","../Common/calendar","../Common/autocomplete","minors","../Common/getDataValue","validation","../Common/popover"],function(m,h,f,g,v,_,y){return function(e){var n,a,r=m.extend({},{autocomplete:{autocompletes:[]},calendar:{calendars:[]},texts:{},prefix:"",maxPassengers:0,originValue:0,destinationValue:0},e);m(".icon-calendar").click(function(){m(this).siblings(".ui-datepicker-trigger").click()});var o=function(){m(".ap_booker_submit",r.selector).prop("disabled",!1),m("body").on("click",r.tripOptionsSelector,function(e){var t=v(this,"tripMode");i(t)}),m(".ap_booker_Bus_adults").change(function(){var e=parseInt(m(this).val()),t=parseInt(m(".ap_booker_Bus_minors").val());s(e,t)}),m(".ap_booker_Bus_adults").trigger("change"),m(".ap_booker_Bus_minors").change(function(){var e=parseInt(m(".ap_booker_Bus_adults").val()),t=parseInt(m(this).val());s(e,t)}),m(".ap_booker_Bus_minors").trigger("change"),m("body").on("click",".ap_Bus_addDiscount",function(e){e.preventDefault(),m(".ap_booker_Bus_discountContainer").toggle()})},i=function(e){e==e&&""!=e||r.tripOption[0].code,m(".ap_busType",r.selector).removeClass("active"),m(".ap-data_tripMode-"+e,r.selector).addClass("active");var t=c(e);r.currentTripOptionCode=t.code,m("."+r.prefix+"_busType").hide(),m(t.exceptionsSelector,"#"+r.prefix+"_"+t.destinationTypeCode).hide();for(var a=0;a<r.tripOptions.length;a++)r.tripOptions[a].code!=t.code&&m(r.tripOptions[a].exceptionsSelector,"#"+r.prefix+"_"+r.tripOptions[a].destinationTypeCode).show();m("#"+r.prefix+"_"+t.destinationTypeCode).show(),m(r.tripOptionSelector).val(t.code)},s=function(e,t){m(".ap_passengerType",r.selector).attr("style","display:none"),m(".ap_passengerType select",r.selector).attr("disabled","disabled");for(var a=0;a<e;a++){if(0==m("#ap_passengerType_"+a,r.selector).length){var o=m(".ap_passengerType_template",r.selector).clone();o.removeClass("ap_passengerType_template"),o.attr("id","ap_passengerType_"+a),(o=l(o,a)).appendTo(".ap_booker_Bus_discountContainer .ap_discount_adults")}m("#ap_passengerType_"+a,r.selector).attr("style","display:"),m("#ap_passengerType_"+a+" select",r.selector).removeAttr("disabled")}for(var i=0;i<t;i++){if(0==m("#ap_passengerTypeMinor_"+i,r.selector).length){var n=m(".ap_passengerTypeMinor_template",r.selector).clone();n.removeClass("ap_passengerTypeMinor_template"),n.attr("id","ap_passengerTypeMinor_"+i),(n=l(n,i)).appendTo(".ap_booker_Bus_discountContainer .ap_discount_minors")}m("#ap_passengerTypeMinor_"+i,r.selector).attr("style","display:"),m("#ap_passengerTypeMinor_"+i+" select",r.selector).removeAttr("disabled")}},l=function(e,a){return e.find(".ap_index").html(a+1),e.find(".ap_collection").each(function(){var e=m(this).attr("name")||"",t=m(this).attr("id")||"";m(this).attr("name",e.replace("{0}",a)),m(this).attr("id",t.replace("_0_",a))}),e},c=function(e){for(var t=0;t<r.tripOptions.length;t++)if(r.tripOptions[t].code==e)return r.tripOptions[t];return null},u=function(e,t){e.instance=new f({selector:e.selector,uri:t,mapping:function(e){return{label:e.search,value:e.search,altValue:e.id}},data:{query:function(){return m(e.selector).val()}},errors:e.errors,onSelectCallback:function(e){p(e.item.altValue)}}),e.instance.init()},p=function(e){m.ajax({url:r.destinationDropDownSource+"?jsoncallback=?",dataType:"jsonp",data:{originOfficeId:e}}).done(function(e){m(r.destinationDropDownSelector).empty(),m("<option/>",{value:0,text:r.texts.SelectText}).appendTo(r.destinationDropDownSelector);for(var t=0;t<e.length;t++)m("<option/>",{value:e[t].id,text:e[t].name,selected:e[t].id==r.destinationValue}).appendTo(r.destinationDropDownSelector)})},t=function(){var e=[];return e=e.concat(function(o){for(var e=[],t=0;t<o.autocompletes.length;t++)!function(a){e.push(o.autocompletes[a].instance.fill({revalidateUri:o.revalidateUri}).done(function(e){if(e&&0<e.length){var t=e[0];m(o.autocompletes[a].selector).val(t.search),m(o.autocompletes[a].instance.getAltSelector()).val(t.id),p(t.id)}}))}(t);return e}(r.autocomplete))},d=function(e){void 0!==a&&a.setOccupaton(e)};return{code:r.code,isActive:r.isActive,init:function(){r.selector="#"+r.prefix+"_"+r.code;for(var e=0;e<r.autocomplete.autocompletes.length;e++)u(r.autocomplete.autocompletes[e],r.autocomplete.uri);if(new h(r.calendar).init(),r.usePopover){var t=r.servicePrefix;(a=new y({ptwTravelersLinkId:t+"ptw-travelers-link",ptwPopoverCloseId:t+"ptw-popover-close",ptwPopoverId:t+"ptw-fp-popover",attr:"data-id",ptwPopoverNumPaxId:t+"ptw-num-pax",ptwPopoverPaxTextId:t+"ptw-pax-text",personText:r.popoverText.person,peopleText:r.popoverText.people,roomText:r.popoverText.room,roomsText:r.popoverText.rooms})).init()}(n=new g({minorsAgesSelector:".ap_booker_Bus_minors",minorsAgesTemplateSelector:".ap_minorAge_template",minorsAgesContainerBaseSelector:"#ap_minorsAges_Bus_container",minorsAgesTemplateBaseId:"ap_booker_Bus_minorAge",minorsAgesAltValueBaseSelector:"#ap_booker_Bus_minorsAges",minorsAgesContainerBaseId:"ap_minorsAges_Bus_container",minorsAgesContainerContainerSelector:".ap_booker_Bus_minorsAgesContainer",adultsTemplateBaseId:"ap_booker_Bus_adults",bookerSelector:r.selector,currentMaxRooms:1,loadRooms:!1,errors:{emptyMinorAge:r.texts.MinorsAgesError},manageMinorsAgesClone:function(e,t,a,o){e.find(".ap_index").html(o+1),e.find(".Err_MinorsAge").attr("id","Err_MinorsAges_"+o+"__Years"),e.attr("id","ap_booker_Bus_minorAge"+o+a).removeClass("ap_minorAge_template").removeClass("ap-data_room-").addClass("ap-data_room-"+a),e.appendTo(t)},minorsAgesContainerTemplateSelector:"#ap_minorsAges_Bus_containerTemplate",onUpdatePopover:!0===r.usePopover?d:void 0})).init(),o(),i(r.currentTripOptionCode),0!=r.originValue&&p(r.originValue),m(r.formMappingForm).attr("action",r.submitUri)},fillAndValidate:function(){var e=t();return m.when.apply(m,e).pipe(function(){return 0==r.skipValidation?function(){var e,t,a=_(),o=[];(o=o.concat(function(e){for(var t=[],a=0;a<e.autocompletes.length;a++)t.push(e.autocompletes[a].instance.validate({errorClass:"inputError"}));return t}(r.autocomplete))).push((e=new m.Deferred,t=[],m(r.destinationDropDownSelector).removeClass("inputError"),0==m(r.destinationDropDownSelector).val()&&(m(r.destinationDropDownSelector).addClass("inputError"),t.push({key:r.destinationDropDownSelector,value:r.texts.DestinationNotSelected})),e.resolve(t),e.promise())),o.push(calendars.validate({errorClass:"inputError",validateEmpty:!0})),o.push(n.validate({errorClass:"inputError",maxPassengers:r.maxPassengers}));var i=new m.Deferred;return a.showErrors(o,r.errorsSelector).done(function(e){r.formMappingForm&&(a.fill(r.formMapping,r.selector),0==e&&i.resolve()),i.reject()}),i.promise()}():{}})},toggleVisible:0!=r.usePopover?function(){if(null!=a)return a.toggleVisible}:void 0}}}),define("carBooker",["jquery","../Common/autocomplete","../Common/calendar","validation"],function(u,p,d,m){return function(e){var n,r=u.extend({},{calendar:{calendars:[]},autocomplete:{autocompletes:[]},startOfficeProvId:0,startOfficeType:0,isAffiliateBooker:!1},e);u(".icon-calendar").click(function(){u(this).siblings(".ui-datepicker-trigger").click()});var o=function(t,a){t.altSelector=t.selector+"_hidden",u.ajax({url:a+"?jsoncallback=?",dataType:"jsonp",data:{query:"",matchQuery:!0},success:function(e){e.length<16?(u(t.selector).autocomplete("destroy"),i(t,a,!0,void 0)):(u(t.selector).autocomplete("destroy"),i(t,a,!1,void 0))}})},t=function(e){r.currentTripOptionCode=e;for(var t=0;t<r.tripOptions.length;t++)r.tripOptions[t].code!=e&&u(r.tripOptions[t].exceptionsSelector,"#"+r.prefix+"_"+r.tripOptions[t].destinationTypeCode).hide();for(t=0;t<r.tripOptions.length;t++)r.tripOptions[t].code==e&&u(r.tripOptions[t].exceptionsSelector,"#"+r.prefix+"_"+r.tripOptions[t].destinationTypeCode).show()},a=function(){u(".ap_booker_submit",r.selector).prop("disabled",!1),u("body").on("change",r.tripOptionsSelector,function(){"True"==this.value?t("1"):t("2")})},i=function(e,t,a,o){var i,n;n={query:function(){return u(e.selector).val()}},"#ap_carEnd_office"==(i=e).selector&&(n.provId=function(){return r.startOfficeProvId},n.type=function(){return r.startOfficeType}),e.instance=new p({selector:e.selector,uri:t,isNotAsync:a,source:o,mapping:function(e){return{label:e.name,value:e.name,altValue:e.id,ExternalId:e.provId,type:e.type}},data:n,errors:e.errors,onSelectCallback:function(e){s(i,e.item.ExternalId,e.item.type)}}),e.instance.init()},s=function(e,t,a){"#ap_carStart_office"==e.selector&&(r.startOfficeProvId=t,r.startOfficeType=a,u(r.autocomplete.autocompletes[1].selector).val(""),r.isAffiliateBooker&&o(r.autocomplete.autocompletes[1],r.autocomplete.uri)),u(e.selectorEId).val(t),u(e.selectorType).val(a)},l=function(){var e=[];return e=e.concat(function(o){for(var e=[],t=0;t<o.autocompletes.length;t++)-1!=u.inArray(r.currentTripOptionCode,o.autocompletes[t].optionCodes)&&function(a){e.push(o.autocompletes[a].instance.fill({revalidateUri:o.revalidateUri}).done(function(e){if(e&&0<e.length){var t=e[0];u(o.autocompletes[a].selector).val(t.name),u(o.autocompletes[a].instance.getAltSelector()).val(t.id),s(o.autocompletes[a],t.provId,t.type)}}))}(t);return e}(r.autocomplete))},c=function(){var e,t,a=m(),o=[];(o=o.concat(function(e){for(var t=[],a=0;a<e.autocompletes.length;a++)-1!=u.inArray(r.currentTripOptionCode,e.autocompletes[a].optionCodes)&&t.push(e.autocompletes[a].instance.validate({errorClass:"inputError"}));return t}(r.autocomplete))).push(n.validate({errorClass:"inputError",validateEmpty:!0})),o.push((e=new u.Deferred,t=[],u(r.pickUpTimeSelector).removeClass("inputError"),u(r.dropOffTimeSelector).removeClass("inputError"),""==u(r.pickUpTimeSelector).val()&&(u(r.pickUpTimeSelector).addClass("inputError"),t.push({key:r.pickUpTimeSelector,value:r.texts.PickUpTimeNotSelected})),""==u(r.dropOffTimeSelector).val()&&(u(r.dropOffTimeSelector).addClass("inputError"),t.push({key:r.dropOffTimeSelector,value:r.texts.DropOffTimeNotSelected})),e.resolve(t),e.promise()));var i=new u.Deferred;return a.showErrors(o,r.errorsSelector).done(function(e){r.formMappingForm&&0==e&&i.resolve(),i.reject()}),i.promise()};return{code:r.code,isActive:r.isActive,init:function(){r.selector="#"+r.prefix+"_"+r.code;for(var e=0;e<r.autocomplete.autocompletes.length;e++)r.autocomplete.autocompletes[e].altSelector=r.autocomplete.autocompletes[e].selector+"_hidden",i(r.autocomplete.autocompletes[e],r.autocomplete.uri);r.isAffiliateBooker&&o(r.autocomplete.autocompletes[0],r.autocomplete.uri),(n=new d(r.calendar)).init(),a(),t(r.currentTripOptionCode),u(r.formMappingForm).attr("action",r.submitUri)},fillAndValidate:function(){var e=l();return u.when.apply(u,e).pipe(function(){return 0==r.skipValidation?c():{}})}}}}),define("transferBooker",["jquery","../Common/autocomplete","../Common/calendar","validation"],function(s,l,c,u){return function(e){var n,r=s.extend({},{calendar:{calendars:[]},autocomplete:{autocompletes:[]},formMapping:[],prefix:"",texts:{}},e);s(".icon-calendar").click(function(){s(this).siblings(".ui-datepicker-trigger").click()});var t=function(){s(".ap_booker_submit",r.selector).prop("disabled",!1),s(r.tripOptionsSelector).change(function(){!function(e){r.currentTripOptionCode=e;for(var t=0;t<r.tripOptions.length;t++)r.tripOptions[t].code!=e&&s(r.tripOptions[t].exceptionsSelector,"#"+r.prefix+"_"+r.tripOptions[t].destinationTypeCode).hide();for(t=0;t<r.tripOptions.length;t++)r.tripOptions[t].code==e&&s(r.tripOptions[t].exceptionsSelector,"#"+r.prefix+"_"+r.tripOptions[t].destinationTypeCode).show()}(s(this).val())}).change(),s(r.airportIdSelector).change(function(){if(s(r.airportKeywordSelector).val(s(r.airportIdSelector+" option:selected").text()),s(r.airportCode).val(s(r.airportIdSelector).find(":selected").attr("data-airportcode")),r.isAffiliateTransfer)e=s(r.airportIdSelector).val(),s.ajax({url:r.autocomplete.uri+"?jsoncallback=?",dataType:"jsonp",data:{query:"",airportId:e},success:function(e){if(e.length<11)for(var t=0;t<r.autocomplete.autocompletes.length;t++)s(r.autocomplete.autocompletes[t].selector).autocomplete("destroy"),r.autocomplete.autocompletes[t].altSelector=r.autocomplete.autocompletes[t].selector+"_hidden",o(r.autocomplete.autocompletes[t],r.autocomplete.uri,void 0);else for(t=0;t<r.autocomplete.autocompletes.length;t++)s(r.autocomplete.autocompletes[t].selector).autocomplete("destroy"),r.autocomplete.autocompletes[t].altSelector=r.autocomplete.autocompletes[t].selector+"_hidden",a(r.autocomplete.autocompletes[t],r.autocomplete.uri)}});for(var e,t=0;t<r.autocomplete.autocompletes.length;t++)s(r.autocomplete.autocompletes[t].selector).val(""),s(r.autocomplete.autocompletes[t].altSelector).val("")})},a=function(e,t){e.instance=new l({selector:e.selector,altSelector:e.altselector,uri:t,mapping:function(e){return{label:e.display,value:e.display,altValue:e.id}},data:{query:function(){return s(e.selector).val()},type:r.placeTypeId,airportId:function(){return s(r.airportIdSelector).val()},airportCode:function(){return s(r.airportCode).val()}},errors:e.errors}),e.instance.init()},o=function(e,t,a){e.instance=new l({selector:e.selector,altSelector:e.altselector,uri:t,isNotAsync:!0,source:a,mapping:function(e){return{label:e.display,value:e.display,altValue:e.id}},data:{query:function(){return s(e.selector).val()},type:r.placeTypeId,airportId:function(){return s(r.airportIdSelector).val()},airportCode:function(){return s(r.airportCode).val()}},errors:e.errors}),e.instance.init()},i=function(){var e=[];return e=e.concat(function(o){for(var e=[],t=0;t<o.autocompletes.length;t++)-1!=s.inArray(r.currentTripOptionCode,o.autocompletes[t].optionCodes)&&function(a){e.push(o.autocompletes[a].instance.fill({revalidateUri:o.revalidateUri}).done(function(e){if(e&&0<e.length){var t=e[0];s(o.autocompletes[a].selector).val(t.display),s(o.autocompletes[a].instance.getAltSelector()).val(t.id)}}))}(t);return e}(r.autocomplete))};return{code:r.code,init:function(){r.selector="#"+r.prefix+"_"+r.code;for(var e=0;e<r.autocomplete.autocompletes.length;e++)r.autocomplete.autocompletes[e].altSelector=r.autocomplete.autocompletes[e].selector+"_hidden",a(r.autocomplete.autocompletes[e],r.autocomplete.uri);(n=new c(r.calendar)).init(),t(),s(r.formMappingForm).attr("action",r.submitUri)},isActive:r.isActive,fillAndValidate:function(){var e=i();return s.when.apply(s,e).pipe(function(){return 0==r.skipValidation?function(){var e,t,a=new u,o=[];(o=o.concat(function(e){for(var t=[],a=0;a<e.autocompletes.length;a++)t.push(e.autocompletes[a].instance.validate({errorClass:"inputError"}));return t}(r.autocomplete))).push((e=new s.Deferred,t=[],s(r.airportIdSelector).removeClass("inputError"),0==s(r.airportIdSelector).val()&&(s(r.airportIdSelector).addClass("inputError"),t.push({key:r.airportIdSelector,value:r.texts.DestinationNotSelected})),e.resolve(t),e.promise())),o.push(n.validate({errorClass:"inputError",validateEmpty:!0,optionCode:r.currentTripOptionCode}));var i=new s.Deferred;return a.showErrors(o,r.errorsSelector).done(function(e){r.formMappingForm&&0==e&&i.resolve(),i.reject()}),i.promise()}():{}})}}}}),define("tourBooker",["jquery","../Common/autocomplete","validation"],function(r,s,l){return function(e){var o=r.extend({},{autocomplete:{autocompletes:[]}},e),t=function(e,t){e.instance=new s({selector:e.selector,uri:t,mapping:function(e){return{label:e.displayName,value:e.displayName,altValue:e.keywordDestinationId,uri:n(null!=e.Keyword?e.Keyword:e.displayName),tourId:e.tourId,display:e.DisplayNameHtml,placeItemDescription:e.PlaceTypeString,description:"",placeType:e.type}},isNotAsync:e.isNotAsync,queryName:"query",data:{compareType:"initial"},errors:{},onSelectCallback:function(e){i(e.item.uri,e.item.tourId,e.item.placeType)}}),e.instance.init().done(function(e){0<e.length&&(e.data("ui-autocomplete")._renderMenu=function(a,e){var o=this;r(a).addClass("ptw-resultPrediction"),r.each(e,function(e,t){o._renderItemData(a,t)})},e.data("ui-autocomplete")._renderItem=function(e,t){var a=t.placeItemDescription.charAt(0).toLowerCase()+t.placeItemDescription.slice(1);return r("<li>").append('<a><span class="name">'+t.display.replace(/ /g,"&nbsp;")+'</span><span class="places-itemCount">'+t.description.replace(/ /g,"&nbsp;")+"</span></a>").addClass("first ptw-icon-places-"+a).appendTo(e)})}),e.instance.init(),r(o.formMappingForm).attr("action",o.submitUri)},i=function(e,t,a){r(o.uriComponent).val(e),null!=a&&r("#ap_tourDestinationType").val(a),null!=t&&r(o.tourIdComponent).val(t)},a=function(){var e=new Array;return e=e.concat(function(o){for(var e=[],t=0;t<o.autocompletes.length;t++)!function(a){e.push(o.autocompletes[t].instance.fill({revalidateUri:o.revalidateUri}).done(function(e){if(e&&0<e.length){var t=e[0];r(o.autocompletes[a].selector).val(t.displayName),r(o.autocompletes[a].instance.getAltSelector()).val(t.keywordDestinationId),i(n(null!=t.Keyword?t.Keyword:t.displayName))}}))}(t);return e}(o.autocomplete))},n=function(e){return e.replace(/Ã±/gi,"n").replace(/Ã‘/gi,"N").replace(/ \/ /gi,"-").replace(/ & /gi,"-").replace(",","").replace(/Ã¡/gi,"a").replace(/Ã©/gi,"e").replace(/Ã­/gi,"i").replace(/Ã³/gi,"o").replace(/Ãº/gi,"u").replace(/Ã/gi,"A").replace(/Ã‰/gi,"E").replace(/Ã/gi,"I").replace(/Ã“/gi,"O").replace(/Ãš/gi,"U").toLowerCase().replace(/-/gi,"_").replace(/ /gi,"-").replace(/_/gi,"-").replace(/\(/gi,"").replace(/\)/gi,"")};return{code:o.code,isActive:o.isActive,fillAndValidate:function(){var e=a();return r.when.apply(r,e).pipe(function(){return 0==o.skipValidation?function(){var t=l(),e=[];e=e.concat(function(e){for(var t=[],a=0;a<e.autocompletes.length;a++)t.push(e.autocompletes[a].instance.validate({errorClass:"inputError"}));return t}(o.autocomplete));var a=new r.Deferred;return t.showErrors(e,o.errorsSelector).done(function(e){o.formMappingForm&&(t.fill(o.formMapping,o.selector),0==e&&a.resolve()),a.reject()}),a.promise()}():{}})},init:function(){for(var e=0;e<o.autocomplete.autocompletes.length;e++)t(o.autocomplete.autocompletes[e],o.autocomplete.uri)}}}}),define("../Common/overlay",["jquery"],function(c){return function(l){c(l.context).each(function(){var t=c(this),a=c(l.toggledSelector,t),o=c(a[0]).is("visible");function i(){c.isFunction(l.onClosing)&&!1===l.onClosing()||(a.hide(),c("body").unbind("click",n),o=!1,c.isFunction(l.onClose)&&l.onClose({context:t}))}function n(e){r?r=!1:i()}var r=!1;function s(e){o=!0,c.isFunction(l.onOpen)&&l.onOpen({context:t,item:e}),setTimeout(function(){c("body").click(n)},0)}a.click(function(){o&&(r=!0)}),a.delegate(l.closerSelector,"click",function(){if(c.isFunction(l.onCloserClicking)&&!1===l.onCloserClicking.call(this,{context:t,eventArgs:arguments}))return;r=!1,i()}),c(t).delegate(l.togglerSelector,"click",function(e){e.preventDefault(),c(a[0]).is(":visible")||(a.show(),s(this))}),o&&s()})}}),define("../Common/monthCalendar",["jquery","../Common/getDataValue","../Common/overlay"],function(k,m,t){return function(f){var e=f.contextSelector;function s(e){return parseInt(k(".ap_calYear_UI",e).val())}function o(e){return parseInt(k(".ap_calMonth",e).val())}function i(e){return parseInt(k(".ap_calYear",e).val())}function g(e){return"true"==k(".ap_calIsSet",e).val().toLowerCase()}function l(e,t){k(".ap_calIsSet",e).val(t)}function v(e){var t=i(e),a=o(e);return new Date(t,a-1,1)}function a(e){return v(e).getTime()}function n(e,t){k(".ap_calSelDisplay",e).html(t)}function c(e){d(e,s(e))}function r(e){return{selectedYear:i(e),selectedMonth:o(e),selectedDate:v(e),selectedTime:a(e)}}function u(e){if(k.isFunction(f.onSelecting)){var t=r(e);f.onSelecting(t)}}function p(e,t,a){if(n(e,f.monthNames[a]+" "+t),k.isFunction(f.onSelect)){var o=r(e);f.onSelect(o)}}var _=[];this.months=_;var y=[];function d(e,t){k(".ap_calYear_UI",e).val(t),k(".ap_calYearDisplay",e).html(t);var a,o,i=v(e);k(".ap_calSel",e).removeClass("previous ap_calSelActive today selected");for(var n=0;n<12;++n){var r=new Date(t,n,1),s=[],l=(void 0,a=f.todayYear,o=f.todayMonth,new Date(a,o-1,1)),c=r.getTime()<l.getTime();s.push(c?"previous":"ap_calSelActive"),r.getTime()==l.getTime()&&s.push("today");for(var u=!1,p=k.inArray(e[0],y),d=_[p]._auxiliarMonths,m=0;m<d.length;++m)if(d[m].getTime()==r.getTime()){u=!0;break}var h=g(e);(u||h&&r.getTime()==i.getTime())&&s.push("selected"),s=s.join(" "),k(".ap-data_m-"+(n+1),e).addClass(s)}}k(e).each(function(){y.push(this);var t=k(this);_.push({getSelectedYear:function(){return i(t)},getSelectedMonth:function(){return o(t)},getSelectedDate:function(){return v(t)},getSelectedTime:function(){return a(t)},getSelectedIsSet:function(){return g(t)},reset:function(){return k(".ap_calSel",e=t).removeClass("selected"),l(e,!1),void n(e,f.resetText);var e},resetUi:function(){return c(t)},setUiYear:function(e){d(t,e)},_auxiliarMonths:[],addAuxiliarMonth:function(e){this._auxiliarMonths.push(e)},removeAuxiliarMonth:function(e){for(var t=[],a=0;a<this._auxiliarMonths.length;++a)this._auxiliarMonths[a].getTime()!=e.getTime()&&t.push(this._auxiliarMonths[a]);this._auxiliarMonths=t}})}),t({context:e,togglerSelector:".ap_calToggler",toggledSelector:".ap_calToggled",closerSelector:".ap_calSel",onCloserClicking:function(e){var t=k(this);if(!t.hasClass("ap_calSelActive"))return!1;var a=parseInt(m(t,"m")),o=e.context;u(o);var i,n,r=s(o);l(o,!0),i=a,k(".ap_calMonth",o).val(i),n=r,k(".ap_calYear",o).val(n),p(o,r,a),c(o)},onOpen:function(e){var t=e.context,a=k(".ap_calToggler",t),o=a.attr("title");o&&(a.attr("title",""),a.attr("data-htitle",o))},onClose:function(e){var t=e.context,a=k(".ap_calToggler",t),o=a.attr("data-htitle");o&&(a.attr("data-htitle",""),a.attr("title",o))}}),k(e).each(function(){var t=k(this);if(k(".ap_calNext",t).click(function(){var e=s(t);d(t,++e)}),k(".ap_calPrev",t).click(function(){var e=s(t);d(t,--e)}),g(t)){u(t);var e=i(t),a=o(t);p(t,e,a)}})}}),define("cruiseBooker",["jquery","../Common/monthCalendar","minors","../Common/popover"],function(l,c,u,p){return function(e){var o,i=e,n=function(e,t){l.each(t.months,function(){this.removeAuxiliarMonth(e.selectedDate)})},r=function(t,a,e,o){var i,n;l.each(e.months,function(){if(this.setUiYear(a.months[0].getSelectedYear()),this.getSelectedIsSet()&&o(t.selectedTime,this.getSelectedTime())){for(var e=0;e<a.months.length;++e){a.months[e].removeAuxiliarMonth(this.getSelectedDate())}this.reset()}}),i=e,n=t.selectedDate,l.each(i.months,function(){this.addAuxiliarMonth(n),this.resetUi()})},s=function(e){void 0!==o&&o.setOccupaton(e)};return{code:i.code,isActive:i.isActive,init:function(){var t;i.selector="#"+i.prefix+"_"+i.code;var a=new c({todayYear:i.todayYear,todayMonth:i.todayMonth,monthNames:i.monthNames,resetText:i.monthResetText,contextSelector:l(".ap_monthCalendarStart",i.selector),onSelecting:function(e){t&&n(e,t)},onSelect:function(e){t&&r(e,a,t,function(e,t){return t<e})}});if(t=new c({todayYear:i.todayYear,todayMonth:i.todayMonth,monthNames:i.monthNames,resetText:i.monthResetText,contextSelector:l(".ap_monthCalendarEnd",i.selector),onSelecting:function(e){t&&n(e,a)},onSelect:function(e){t&&r(e,t,a,function(e,t){return e<t})}}),i.usePopover){var e=i.servicePrefix;(o=new p({ptwTravelersLinkId:e+"ptw-travelers-link",ptwPopoverCloseId:e+"ptw-popover-close",ptwPopoverId:e+"ptw-fp-popover",attr:"data-id",ptwPopoverRoomsId:e+"ptw-num-rooms",ptwPopoverNumPaxId:e+"ptw-num-pax",ptwPopoverPaxTextId:e+"ptw-pax-text",ptwPopoverRoomTextId:e+"ptw-room-text",personText:i.popoverText.person,peopleText:i.popoverText.people,roomText:i.popoverText.room,roomsText:i.popoverText.rooms})).init()}new u({roomsSelector:"#ap_booker_Cruise_cabins",roomsTemplateSelector:".ap_roomOccupancy_template",roomsContainerSelector:".ap_roomOccupancy_container",roomsTemplateBaseId:"ap_booker_Cruiseroom",minorsAgesSelector:".ap_booker_Cruise_minors",minorsAgesTemplateSelector:".ap_minorAge_template",minorsAgesContainerBaseSelector:"#ap_minorsAges_Cruise_container",minorsAgesTemplateBaseId:"ap_booker_Cruise_minorAge",minorsAgesAltValueBaseSelector:"#ap_booker_Cruise_minorsAges",minorsAgesContainerBaseId:"ap_minorsAges_Cruise_container",minorsAgesContainerContainerSelector:".ap_booker_Cruise_minorsAgesContainer",adultsTemplateBaseId:"ap_booker_Cruise_adults",yearSelector:".ap_Cruise_year",monthSelector:".ap_Cruise_month",bookerSelector:i.selector,showMonths:!0,manageRoomsClone:function(e,t,a){e.find(".ap_index").html(a+1),e.attr("id","ap_booker_Cruiseroom"+a).removeClass("ap_roomOccupancy_template"),e.find("#ap_booker_Cruise_adults").attr("id","ap_booker_Cruise_adults"+a).removeClass("ap-data_room-").addClass("ap-data_room-"+a),e.find("#ap_booker_Cruise_minors").attr("id","ap_booker_Cruise_minors"+a).removeClass("ap-data_room-").addClass("ap-data_room-"+a),e.find("#ap_booker_Cruise_minorsAges").attr("id","ap_booker_Cruise_minorsAges"+a).removeClass("ap-data_room-").addClass("ap-data_room-"+a),e.appendTo(t)},manageMinorsAgesClone:function(e,t,a,o){e.find(".ap_index").html(o+1),e.attr("id","ap_booker_Cruise_minorAge"+o+a).removeClass("ap_minorAge_template").removeClass("ap-data_room-").addClass("ap-data_room-"+o),e.find(".Err_MinorsAge").attr("id","Err_Cabins_"+a+"__MinorsAges_"+o+"__Years"),e.find(".Err_MinorsAgeMonths").attr("id","Err_Cabins_"+a+"__MinorsAges_"+o+"__Months"),e.appendTo(t)},onMonthSelect:function(e,t){0<=t?t<i.minMonthValue?(l(e).parent().siblings(i.minAgeErrorSelector).show(),l(e).parent().siblings(i.minAgeWarningSelector).hide()):(l(e).parent().siblings(i.minAgeWarningSelector).show(),l(e).parent().siblings(i.minAgeErrorSelector).hide()):(l(e).parent().siblings(i.minAgeErrorSelector).hide(),l(e).parent().siblings(i.minAgeWarningSelector).hide())},onYearSelect:function(e,t){0<t&&(l(e).siblings(i.minAgeWarningSelector).hide(),l(e).siblings(i.minAgeErrorSelector).hide())},minorsAgesContainerTemplateSelector:"#ap_minorsAges_Cruise_containerTemplate",onUpdatePopover:!0===i.usePopover?s:void 0}).init(),l(i.formMappingForm).attr("action",i.submitUri),l(".ap_booker_submit",i.selector).prop("disabled",!1)},fillAndValidate:function(){if(0==i.skipValidation)return validate();var e=new l.Deferred;return e.resolve(),e.promise()},toggleVisible:0!=i.usePopover?function(){if(null!=o)return o.toggleVisible}:void 0}}}),define("circuitBooker",["jquery","../Common/monthCalendar","minors","../Common/popover"],function(l,c,u,p){return function(e){var o,i=e,n=function(e){void 0!==o&&o.setOccupaton(e)},r=function(e,t){l.each(t.months,function(){this.removeAuxiliarMonth(e.selectedDate)})},s=function(t,a,e,o){var i,n;l.each(e.months,function(){if(this.setUiYear(a.months[0].getSelectedYear()),this.getSelectedIsSet()&&o(t.selectedTime,this.getSelectedTime())){for(var e=0;e<a.months.length;++e){a.months[e].removeAuxiliarMonth(this.getSelectedDate())}this.reset()}}),i=e,n=t.selectedDate,l.each(i.months,function(){this.addAuxiliarMonth(n),this.resetUi()})};n=function(e){void 0!==o&&o.setOccupaton(e)};return{code:i.code,isActive:i.isActive,init:function(){var t;i.selector="#"+i.prefix+"_"+i.code;var a=new c({todayYear:i.todayYear,todayMonth:i.todayMonth,monthNames:i.monthNames,resetText:i.monthResetText,contextSelector:l(".ap_monthCalendarStart",i.selector),onSelecting:function(e){t&&r(e,t)},onSelect:function(e){t&&s(e,a,t,function(e,t){return t<e})}});if(t=new c({todayYear:i.todayYear,todayMonth:i.todayMonth,monthNames:i.monthNames,resetText:i.monthResetText,contextSelector:l(".ap_monthCalendarEnd",i.selector),onSelecting:function(e){t&&r(e,a)},onSelect:function(e){t&&s(e,t,a,function(e,t){return e<t})}}),i.usePopover){var e=i.servicePrefix;(o=new p({ptwTravelersLinkId:e+"ptw-travelers-link",ptwPopoverCloseId:e+"ptw-popover-close",ptwPopoverId:e+"ptw-fp-popover",attr:"data-id",ptwPopoverRoomsId:e+"ptw-num-rooms",ptwPopoverNumPaxId:e+"ptw-num-pax",ptwPopoverPaxTextId:e+"ptw-pax-text",ptwPopoverRoomTextId:e+"ptw-room-text",personText:i.popoverText.person,peopleText:i.popoverText.people,roomText:i.popoverText.room,roomsText:i.popoverText.rooms})).init()}new u({roomsSelector:"#ap_booker_Circuit_rooms",roomsTemplateSelector:".ap_roomOccupancy_template",roomsContainerSelector:".ap_roomOccupancy_container",roomsTemplateBaseId:"ap_booker_Circuitroom",minorsAgesSelector:".ap_booker_Circuit_minors",minorsAgesTemplateSelector:".ap_minorAge_template",minorsAgesContainerBaseSelector:"#ap_minorsAges_Circuit_container",minorsAgesTemplateBaseId:"ap_booker_Circuit_minorAge",minorsAgesAltValueBaseSelector:"#ap_booker_Circuit_minorsAges",minorsAgesContainerBaseId:"ap_minorsAges_Circuit_container",minorsAgesContainerContainerSelector:".ap_booker_Circuit_minorsAgesContainer",adultsTemplateBaseId:"ap_booker_Circuit_adults",yearSelector:".ap_Circuit_year",monthSelector:".ap_Circuit_month",bookerSelector:i.selector,manageRoomsClone:function(e,t,a){e.find(".ap_index").html(a+1),e.attr("id","ap_booker_Circuitroom"+a).removeClass("ap_roomOccupancy_template"),e.find("#ap_booker_Circuit_adults").attr("id","ap_booker_Circuit_adults"+a).removeClass("ap-data_room-").addClass("ap-data_room-"+a),e.find("#ap_booker_Circuit_minors").attr("id","ap_booker_Circuit_minors"+a).removeClass("ap-data_room-").addClass("ap-data_room-"+a),e.find("#ap_booker_Circuit_minorsAges").attr("id","ap_booker_Circuit_minorsAges"+a).removeClass("ap-data_room-").addClass("ap-data_room-"+a),e.appendTo(t)},manageMinorsAgesClone:function(e,t,a,o){e.find(".ap_index").html(o+1),e.attr("id","ap_booker_Circuit_minorAge"+o+a).removeClass("ap_minorAge_template").removeClass("ap-data_room-").addClass("ap-data_room-"+o),e.find(".Err_MinorsAge").attr("id","Err_Rooms_"+a+"__MinorsAges_"+o+"__Years"),e.appendTo(t)},minorsAgesContainerTemplateSelector:"#ap_minorsAges_Circuit_containerTemplate",onUpdatePopover:!0===i.usePopover?n:void 0}).init(),l(i.formMappingForm).attr("action",i.submitUri),l(".ap_booker_submit",i.selector).prop("disabled",!1)},fillAndValidate:function(){if(0==i.skipValidation)return validate();var e=new l.Deferred;return e.resolve(),e.promise()},toggleVisible:0!=i.usePopover?function(){if(null!=o)return o.toggleVisible}:void 0}}}),define("../Common/toDictionary",["jquery"],function(e){!function(r){!1===r.isFunction(String.prototype.format)&&(String.prototype.format=function(){for(var e=this,t=arguments.length;t--;)e=e.replace(new RegExp("\\{"+t+"\\}","gim"),arguments[t]);return e}),!1===r.isFunction(Date.prototype.toISOString)&&(Date.prototype.toISOString=function(){var e=function(e,t){for(var a=(e=e.toString()).length;a<t;a++)e="0"+e;return e},t=this;return"{0}-{1}-{2}T{3}:{4}:{5}.{6}Z".format(t.getUTCFullYear(),e(t.getUTCMonth()+1,2),e(t.getUTCDate(),2),e(t.getUTCHours(),2),e(t.getUTCMinutes(),2),e(t.getUTCSeconds(),2),e(t.getUTCMilliseconds(),3))});var s=function(e,a,o,t){if(r.isPlainObject(e))for(var i in e)(!0===t||void 0!==e[i]&&null!==e[i])&&s(e[i],a,0<o.length?o+"."+i:i,t);else{if(r.isArray(e))return void r.each(e,function(e,t){s(t,a,"{0}[{1}]".format(o,e))});if(!r.isFunction(e))if(e instanceof Date)a.push({name:o,value:e.toISOString()});else{var n=typeof e;switch(n){case"boolean":case"number":n=e;break;case"object":if(!0!==t)return;default:n=e||""}a.push({name:o,value:n})}}};r.extend({toDictionary:function(e,t,a){e=r.isFunction(e)?e.call():e,2===arguments.length&&"boolean"==typeof t&&(a=t,t="");var o=[];return s(e,o,t||"",a="boolean"==typeof a&&a),o}})}(e)}),define("DynamicPackage",["jquery","../Common/autocomplete","../Common/calendar","minors","../Common/getDataValue","validation"],function(R,H,q,Y,V,L){return function(e){var s,o,d,l,m="MultipleDestinations",h=R.extend({},{departureAutocomplete:{autocompletes:[]},arrivalAutocomplete:{autocompletes:[]},calendar:{calendars:[]},autocomplete:{autocompletes:[]},skipValidation:!1,formMapping:[],tripOptions:[],multiDestinationFlightsBase:0,multiDestinationFlights:[],multiDestinationHotels:[],maxPassengers:0,multiFlightContainer:"ap_booker_dynamic_package_multiFlightContainer",multiHotelContainer:"ap_booker_dynamic_package_multiHotelContainer",texts:{},tripOtionprefix:"ap_booker_dynamic_package",maxMultidestinationHotels:2,showInfantTexts:!1,ptwInfantTextsId:"ptw-flight-infant-text",ptwInfantContainerId:"ptw-flight-infant-text-container"},e),t=new q(h.RoundTripCalendar),f=new q(h.MultiDestinationCalendar),g=[],c=function(e,t){e.instance=new H({selector:e.selector,uri:t,createAltField:e.createAltField,isNotAsync:e.isNotAsync,mapping:function(e){return{label:e.Display,description:"("+e.HotelsCount+" "+(1<e.HotelsCount?h.texts.Hotels:h.texts.Hotel)+")",uri:e.URI,tableName:e.TableName,altValue:e.Id,display:e.Display,country:e.CountryA2}},queryName:"query",data:{compareType:"initial",isNotAsync:e.isNotAsync},errors:e.errors,onSelectCallback:function(e,t){var a={baseSelector:t,display:e.item.display,keywordId:e.item.altValue,keywordTable:e.item.tableName,uri:e.item.uri,country:e.item.country};i(a)}}),e.instance.init().done(function(e){0<e.length&&(e.data("ui-autocomplete")._renderItem=function(e,t){return R("<li>").append('<a><span class="destination">'+t.label+'</span><span class="numHotels">'+t.description+"</span></a>").appendTo(e)})})},i=function(e){R(e.baseSelector+"_keywordTable").val(e.keywordTable),R(e.baseSelector+"_uri").val(e.uri)},a=function(e){for(var t=0;t<e.autocompletes.length;t++){c(e.autocompletes[t],e.uri);var a=e.autocompletes[t].hotelIndex;if(void 0!==a){var o=_(h.multiDestinationHotels,a),i=!1;-1===o&&(o={index:a,autocompletes:[],calendars:[]},i=!0),o.autocompletes.push(e.autocompletes[t].instance),!0===i&&h.multiDestinationHotels.push(o)}}},n=function(e){for(var t=e.autocompletes,a=0;a<e.autocompletes.length;a++){t[a]=R.extend({},t[a],e.baseAutocomplete),v(t[a],e.uri);var o=t[a].flightIndex;if(null!=o){var i=_(h.multiDestinationFlights,o),n=!1;-1===i&&(i={index:o,autocompletes:[],calendars:[]},n=!0),i.autocompletes.push(t[a].instance),1==n&&h.multiDestinationFlights.push(i)}}},v=function(o,e,t){var a=!0;null!=o.isOrigin&&null!=o.isOrigin&&(a=o.isOrigin),o.instance=new H({selector:o.selector,uri:e,isNotAsync:o.isNotAsync,sliceSize:o.sliceSize,source:t,mapping:function(e){return{label:e.Name+" ("+e.Code+")",value:e.Name+" ("+e.Code+")",altValue:e.Code,country:e.Country,mappingId:e.MappingId,mappingType:e.MappingType,restrictions:e.Restrictions}},data:{query:function(){return R(o.selector).val()},verifyDestinations:!1,restrictions:function(){return g},gtOrigin:a,isNotAsync:o.isNotAsync,onlyCountry:o.onlyCountry},errors:o.errors,onSelectCallback:function(e,t){!0===o.setRestictions&&(e.item.restrictions=p(e.item.restrictions,o.restrictions));var a={baseSelector:t,country:e.item.country,mappingId:e.item.mappingId,mappingType:e.item.mappingType,altValue:e.item.altValue,bans:e.item.restrictions};r(a)}}),o.instance.init()},r=function(e){if(R(e.baseSelector+"_country").val(e.country),R(e.baseSelector+"_mappingId").val(e.mappingId),R(e.baseSelector+"_mappingType").val(e.mappingType),R(e.baseSelector+"_hidden").val(e.altValue),g=u(e.bans),null!=e.bans&&null!=e.bans&&0<e.bans.length)for(var t=0;t<h.arrivalAutocomplete.autocompletes.length;t++)if(e.baseSelector==h.departureAutocomplete.autocompletes[t].selector){R(h.arrivalAutocomplete.autocompletes[t].selector).autocomplete("destroy");(function(i){R.ajax({url:h.arrivalAutocomplete.uri+"?jsoncallback=?",dataType:"jsonp",data:{query:"",verifyDestinations:!1,gtOrigin:!1,restrictions:function(){return g}},success:function(e){for(var t=[],a=0;a<e.length;a++){var o={label:e[a].Name+" ("+e[a].Code+")",value:e[a].Name+" ("+e[a].Code+")",altValue:e[a].Code,country:e[a].Country,mappingId:e[a].MappingId,mappingType:e[a].MappingType,restrictions:e[a].Restrictions};t.push(o)}v(h.arrivalAutocomplete.autocompletes[i],h.arrivalAutocomplete.uri,t)}})})(t)}},u=function(e){var t=[];if(null!=e||null!=e&&0<e.length)for(var a=0;a<e.length;a++){var o=e[a].AirportCode;-1==R.inArray(o,t)&&t.push(o)}return t},p=function(e,t){for(var a=[],o=t.split(","),i=0;i<o.length;i++){var n=R.grep(e,function(e){return e.AirportCode===o[i]});0<n.length&&a.push(n[0])}return a},_=function(e,t){for(var a=0;a<e.length;a++)if(e[a].index===t)return e[a];return-1},y=function(e){for(var t=-1,a=0;a<e.length;a++)e[a].index>t&&(t=e[a].index);return t},k=function(e,t){R(e,t).each(function(e){R(this).find("span.ap_fn").html(e+1)})},b=function(e){for(var t=0;t<e.calendars.length;t++){var a=e.calendars[t].flightIndex;if(null!=a){var o=_(h.multiDestinationFlights,a),i=!1;-1==o&&(o={index:a,autocompletes:[],calendars:[]},i=!0),o.calendars.push(e.calendars[t]),1==i&&h.multiDestinationFlights.push(o)}}},C=function(e){for(var t=0;t<e.calendars.length;t++){var a=e.calendars[t].hotelIndex;if(void 0!==a){var o=_(h.multiDestinationHotels,a),i=!1;-1==o&&(o={index:a,autocompletes:[],calendars:[]},i=!0),o.calendars.push(e.calendars[t]),1==i&&h.multiDestinationHotels.push(o)}}},x=function(){var e=y(h.multiDestinationFlights),a=e+1,t=d.clone();t.attr("id","ap_booker_dynamic_package_multiTemplate"+a),t.find(".ap_dynamic_package_flight_remove").attr("class","ap_dynamic_package_flight_remove ap-data_flight-"+a),t.find("#ap_flight_index").attr("id","ap_flight_index"+a).val(a),t.find("input.ap_collection").each(function(){var e=R(this).attr("name")||"",t=R(this).attr("id")||"";R(this).attr("name",e.replace("{0}",a)),R(this).attr("id",t.replace("{0}",a))}),t.find(".ptw-errormsg").each(function(){var e=R(this).attr("id")||"";R(this).attr("id",e.replace("{0}",a))}),t.find("label.ap_collection").each(function(){var e=R(this).attr("for")||"";R(this).attr("for",e.replace("{0}",a))}),t.appendTo(h.templateParentSelector);var o=_(h.multiDestinationFlights,a-1),i=[],n=[],r=h.arrivalAutocomplete.autocompletes[e],s=null!=h.departureAutocompleteClone?R.extend({},R.parseJSON(h.departureAutocompleteClone),h.departureAutocomplete.baseAutocomplete,{restrictions:h.restrictions}):h.departureAutocomplete.autocompletes[e],l={selector:"#ap_origin_dynamic_package_multi_flight"+a};i.push(R.extend({},s,l)),n.push({selector:"#ap_dest_dynamic_package_multi_flight"+a,optionCodes:[m],errors:o.autocompletes[1].errors,isNotAsync:r.isNotAsync,sliceSize:r.sliceSize});var c=[];c.push({selector:"#ap_dynamic_package_flight_multi_calendar"+a,optionCodes:[m],errors:o.calendars[0].errors});for(var u={index:a,autocompletes:[],calendars:[]},p=0;p<i.length;p++)g=null==h.restrictions?[]:h.restrictions,v(i[p],h.departureAutocomplete.uri),h.departureAutocomplete.autocompletes.push(i[p]),u.autocompletes.push(i[p]);for(p=0;p<n.length;p++)v(n[p],h.arrivalAutocomplete.uri),h.arrivalAutocomplete.autocompletes.push(n[p]),u.autocompletes.push(n[p]);for(p=0;p<c.length;p++)f.addCalendar(c[p],!0),u.calendars.push(c[p]);return h.multiDestinationFlights.push(u),k(".ap_flightTitle",h.templateParentSelector),!1},w=function(){var a=y(h.multiDestinationHotels)+1,e=l.clone();e.attr("id","ap_booker_dynamic_package_multiHotelTemplate"+a),e.find(".ap_dynamic_package_hotel_remove").attr("class","ap_dynamic_package_hotel_remove ap-data_hotel-"+a),e.find("#ap_hotel_index").attr("id","ap_hotel_index"+a).val(a),e.find("input.ap_collection").each(function(){var e=R(this).attr("name")||"",t=R(this).attr("id")||"";R(this).attr("name",e.replace("{0}",a)),R(this).attr("id",t.replace("{0}",a))}),e.find(".ptw-errormsg").each(function(){var e=R(this).attr("id")||"";R(this).attr("id",e.replace("{0}",a))}),e.find("label.ap_collection").each(function(){var e=R(this).attr("for")||"";R(this).attr("for",e.replace("{0}",a))}),e.appendTo(h.hotelTemplateParentSelector);var t=_(h.multiDestinationHotels,a-1),o=[];o.push({selector:"#ap_dynamic_package_dest_hotel"+a,hotelIndex:a,errors:t.autocompletes[0].errors});var i=[];i.push({selector:"#ap_dynamic_package_dest_start"+a,hotelIndex:a,errors:t.calendars[0].errors});i.push({selector:"#ap_dynamic_package_dest_end"+a,hotelIndex:a,errors:t.calendars[0].errors});for(var n={index:a,autocompletes:[],calendars:[]},r=0;r<o.length;r++)c(o[r],h.autocomplete.uri),h.autocomplete.autocompletes.push(o[r]),n.autocompletes.push(o[r]);for(r=0;r<i.length;r++)s.addCalendar(i[r],!0),n.calendars.push(i[r]);return h.multiDestinationHotels.push(n),k(".ap_hotelTitle",h.hotelTemplateParentSelector),!1},A=function(e){var t=parseInt(V(e,"flight")),a=_(h.multiDestinationFlights,t);if(-1!=a){for(var o=0;o<a.autocompletes.length;o++)I(a.autocompletes[o]);for(o=0;o<a.calendars.length;o++)M(a.calendars[o]);for(o=0;o<h.multiDestinationFlights.length;o++)h.multiDestinationFlights[o].index==t&&h.multiDestinationFlights.splice(o,1);R("#ap_booker_dynamic_package_multiTemplate"+a.index,h.selector).fadeOut(200),R("#ap_booker_dynamic_package_multiTemplate"+a.index,h.selector).promise().done(function(){R(this).remove(),k(".ap_flightTitle",h.templateParentSelector)})}},D=function(e){var t=parseInt(V(e,"hotel"));if(-1!=_(h.multiDestinationHotels,t)){for(var a=0;a<h.multiDestinationHotels.length;a++)h.multiDestinationHotels[a].index===t&&h.multiDestinationHotels.splice(a,1);R("#ap_booker_dynamic_package_multiHotelTemplate"+t,h.selector).fadeOut(200),R("#ap_booker_dynamic_package_multiHotelTemplate"+t,h.selector).promise().done(function(){R(this).remove(),k(".ap_hotelTitle",h.hotelTemplateParentSelector)})}},S=function(e){var t=R("."+e.data.container+"> div").length;return t>=e.data.limit?(R(e.data.linkSelector).hide(),!1):(e.data.callback(),(t+=1)>=e.data.limit?R(e.data.linkSelector).hide():R(e.data.linkSelector).show(),!1)},T=function(e){return e.data.callback(this),R(e.data.linkSelector).show(),!1},I=function(e){for(var t=0;t<h.departureAutocomplete.autocompletes.length;t++)if(h.departureAutocomplete.autocompletes[t].selector==e.selector){h.departureAutocomplete.autocompletes.splice(t,1);break}for(t=0;t<h.arrivalAutocomplete.autocompletes.length;t++)if(h.arrivalAutocomplete.autocompletes[t].selector==e.selector){h.arrivalAutocomplete.autocompletes.splice(t,1);break}},M=function(e){for(var t=0;t<f.calendars.length;t++)if(f.calendars[t].selector==e.selector){f.calendars.splice(t,1);break}for(t=0;t<h.calendar.calendars.length;t++)if(h.calendar.calendars[t].selector==e.selector){h.calendar.calendars.splice(t,1);break}},P=function(e){e=e&&""!=e?e:h.tripOption[0].code,R(".dynamic_package_tripMode-"+e,h.selector).addClass("active");var t=E(e);h.currentTripOptionCode=t.code;for(var a=0;a<h.tripOptions.length;a++)h.tripOptions[a].code!=t.code&&R("#"+h.tripOtionprefix+"_"+h.tripOptions[a].destinationTypeCode).hide();R("#"+h.tripOtionprefix+"_"+t.destinationTypeCode).show(),R(h.tripOptionSelector).val(t.code)},F=function(e){var t=E(e),a="#"+h.tripOtionprefix+"_"+t.destinationTypeCode;R("."+h.tripOtionprefix+"_flightType input").removeAttr("disabled"),R("."+h.tripOtionprefix+"_flightType:not("+a+") input").attr("disabled","disabled")},E=function(e){for(var t=0;t<h.tripOptions.length;t++)if(h.tripOptions[t].code==e)return h.tripOptions[t];return null},N=function(o){for(var e=[],t=0;t<o.autocompletes.length;t++)-1!=R.inArray(h.currentTripOptionCode,o.autocompletes[t].optionCodes)&&function(a){e.push(o.autocompletes[a].instance.fill({revalidateUri:o.revalidateUri}).done(function(e){if(e&&0<e.length){var t=e[0];R(o.autocompletes[a].selector).val(t.Name+" ("+t.Code+")"),R(o.autocompletes[a].instance.getAltSelector()).val(t.Code)}}))}(t);return e},O=function(e){for(var t=[],a=0;a<e.autocompletes.length;a++)e.autocompletes[a].optionCodes=e.autocompletes[a].optionCodes||[],-1!=R.inArray(h.currentTripOptionCode,e.autocompletes[a].optionCodes)&&t.push(e.autocompletes[a].instance.validate({errorClass:"inputError"}));return t},B=function(){var e=new Array;return e=e.concat(N(h.departureAutocomplete),N(h.arrivalAutocomplete))},U=function(){var t=L(),e=[];(e=e.concat(O(h.departureAutocomplete),O(h.arrivalAutocomplete))).push(calendar.validate({errorClass:"inputError",validateEmpty:!0,optionCode:h.currentTripOptionCode})),h.currentTripOptionCode==m&&e.push(f.validate({errorClass:"inputError",validateEmpty:!0,optionCode:h.currentTripOptionCode})),e.push(o.validate({errorClass:"inputError",maxPassengers:h.maxPassengers}));var a=new R.Deferred;return t.showErrors(e,h.errorsSelector).done(function(e){h.formMappingForm&&(t.fill(h.formMapping,h.selector),0==e&&a.resolve()),a.reject()}),a.promise()},j=function(){var e=R("input[name=FlightTripMode]:checked").val();if(void 0!==e){var t=E(e);h.currentTripOptionCode===t.code&&(P(e),F(e))}R(h.selector).on("click","#ap_booker_dynamic_package_addFlight",{container:h.multiFlightContainer,limit:h.maxMultidestinationFlights,callback:x,linkSelector:".ptw-add-flight"},S),R(h.selector).on("click",".ap_dynamic_package_flight_remove",{container:h.multiFlightContainer,callback:A,linkSelector:".ptw-add-flight"},T),R(h.selector).on("click","#ap_booker_dynamic_package_addHotel",{container:h.multiHotelContainer,limit:h.maxMultidestinationHotels,departureCalendar:s,arrivalCalendar:void 0,linkSelector:".ptw-add-hotel",callback:w},S),R(h.selector).on("click",".ap_dynamic_package_hotel_remove",{container:h.multiHotelContainer,callback:D,linkSelector:".ptw-add-hotel"},T),R(h.selector).on("click",h.tripOptionsSelector,function(e){var t=V(this,"dynamic_package_tripMode");P(t),F(t)}),R(h.formMappingForm).attr("action",h.submitUri)};return{code:h.code,isActive:h.isActive,init:function(){h.selector="#"+h.prefix+"_"+h.code,h.showInfantsText&&R("#ap_booker_DynamicPackage ."+h.ptwInfantTextsId).on("click",function(){R("#ap_booker_DynamicPackage ."+h.ptwInfantContainerId).toggle()}),(o=new Y({roomsSelector:"#ap_booker_DynamicPackage_rooms",roomsTemplateSelector:".ap_roomOccupancy_template",roomsContainerSelector:".ap_roomOccupancy_container",roomsTemplateBaseId:"ap_booker_DynamicPackageroom",minorsAgesSelector:".ap_booker_DynamicPackage_minors",minorsAgesTemplateSelector:".ap_minorAge_template",minorsAgesContainerBaseSelector:"#ap_minorsAges_DynamicPackage_container",minorsAgesTemplateBaseId:"ap_booker_DynamicPackage_minorAge",minorsAgesAltValueBaseSelector:"#ap_booker_DynamicPackage_minorsAges",minorsAgesContainerBaseId:"ap_minorsAges_DynamicPackage_container",minorsAgesContainerContainerSelector:".ap_booker_DynamicPackage_minorsAgesContainer",adultsTemplateBaseId:"ap_booker_DynamicPackage_adults",totalMinorsAgesSelector:"#ap_booker_DynamicPackage_totalMinorsAges",totalMinorsSelector:"#ap_booker_DynamicPackage_totalMinors",totalAdultsSelector:"#ap_booker_DynamicPackage_totalAdults",calculateTotals:!0,bookerSelector:h.selector,errors:{emptyMinorAge:h.texts.MinorsAgesError},manageRoomsClone:function(e,t,a){e.find(".ap_index").html(a+1),e.attr("id","ap_booker_DynamicPackageroom"+a).removeClass("ap_roomOccupancy_template"),e.find("#ap_booker_DynamicPackage_adults").attr("id","ap_booker_DynamicPackage_adults"+a).removeClass("ap-data_room-").addClass("ap-data_room-"+a),e.find("#ap_booker_DynamicPackage_minors").attr("id","ap_booker_DynamicPackage_minors"+a).removeClass("ap-data_room-").addClass("ap-data_room-"+a),e.find("#ap_booker_DynamicPackage_minorsAges").attr("id","ap_booker_DynamicPackage_minorsAges"+a).removeClass("ap-data_room-").addClass("ap-data_room-"+a),e.appendTo(t)},manageMinorsAgesClone:function(e,t,a,o){e.find(".ap_index").html(o+1),e.attr("id","ap_booker_DynamicPackage_minorAge"+o+a).removeClass("ap_minorAge_template").removeClass("ap-data_room-").addClass("ap-data_room-"+o),e.find(".Err_MinorsAge").attr("id","Err_HotelRooms_"+a+"__MinorsAges_"+o+"__Years"),e.appendTo(t)},minorsAgesContainerTemplateSelector:"#ap_minorsAges_DynamicPackage_containerTemplate"})).init(),l=R(h.hotelTemplateSelector).clone(),(s=new q(h.departureHotelCalendar)).init(),C(s),a(h.autocomplete),d=R(h.templateSelector).clone(),h.currentTripOptionCode=R(h.tripOptionSelector,h.selector).val(),t.init(),f.init(),b(f),h.departureAutocomplete.autocompletes=R.parseJSON(h.departureAutocomplete.autocompletes),h.arrivalAutocomplete.autocompletes=R.parseJSON(h.arrivalAutocomplete.autocompletes),n(h.departureAutocomplete),n(h.arrivalAutocomplete),j()},fillAndValidate:function(){var e=B();return R.when.apply(R,e).pipe(function(){return 0==h.skipValidation?U():{}})},fill:B,validate:U}}}),define("CruiseFlightBooker",["jquery","../Common/autocomplete","../Common/monthCalendar","minors","../Common/popover"],function(p,o,d,m,h){return function(e){var i,n=p.extend({},{departureAutocomplete:{autocompletes:[]}},e),a=[],r=function(e,t){e.instance=new o({selector:e.selector,uri:t,isNotAsync:e.isNotAsync,mapping:function(e){return{label:e.Name+" ("+e.Code+")",value:e.Name+" ("+e.Code+")",description:e.Description,altValue:e.Code,restrictions:e.Restrictions}},queryName:"query",data:{verifyDestinations:!1,gtOrigin:!0,isNotAsync:e.isNotAsync},errors:e.errors,onClear:function(){if(0<a.length)for(var e=0;e<n.destinationAutocomplete.autocompletes.length;e++)p(n.destinationAutocomplete.autocompletes[e].selector).val(""),p(n.destinationAutocomplete.autocompletes[e].selector).autocomplete("destroy"),p(n.destinationAutocomplete.autocompletes[e].selector).unbind("keyup")},sliceSize:e.sliceSize}),e.instance.init()},s=function(e,t){p.each(t.months,function(){this.removeAuxiliarMonth(e.selectedDate)})},l=function(t,a,e,o){var i,n;p.each(e.months,function(){if(this.setUiYear(a.months[0].getSelectedYear()),this.getSelectedIsSet()&&o(t.selectedTime,this.getSelectedTime())){for(var e=0;e<a.months.length;++e){a.months[e].removeAuxiliarMonth(this.getSelectedDate())}this.reset()}}),i=e,n=t.selectedDate,p.each(i.months,function(){this.addAuxiliarMonth(n),this.resetUi()})},t=function(e){var t=p(".item-accordion").parent().find(e.data.linkSelector);t.is(":visible")?t.css("display","none"):t.css("display","block")},c=function(){p(n.selector).on("click",".extendTrip-CruiseFlight",{linkSelector:".content-accordion"},t)},u=function(e){void 0!==i&&i.setOccupaton(e)};return{code:n.code,isActive:n.isActive,init:function(){var t;n.selector="#"+n.prefix+"_"+n.code;var a=new d({todayYear:n.todayYear,todayMonth:n.todayMonth,monthNames:n.monthNames,resetText:n.monthResetText,contextSelector:p(".ap_monthCalendarStart",n.selector),onSelecting:function(e){t&&s(e,t)},onSelect:function(e){t&&l(e,a,t,function(e,t){return t<e})}});if(t=new d({todayYear:n.todayYear,todayMonth:n.todayMonth,monthNames:n.monthNames,resetText:n.monthResetText,contextSelector:p(".ap_monthCalendarEnd",n.selector),onSelecting:function(e){t&&s(e,a)},onSelect:function(e){t&&l(e,t,a,function(e,t){return e<t})}}),n.usePopover){var e=n.servicePrefix;(i=new h({ptwTravelersLinkId:e+"ptw-travelers-link",ptwPopoverCloseId:e+"ptw-popover-close",ptwPopoverId:e+"ptw-fp-popover",attr:"data-id",ptwPopoverRoomsId:e+"ptw-num-rooms",ptwPopoverNumPaxId:e+"ptw-num-pax",ptwPopoverPaxTextId:e+"ptw-pax-text",ptwPopoverRoomTextId:e+"ptw-room-text",personText:n.popoverText.person,peopleText:n.popoverText.people,roomText:n.popoverText.room,roomsText:n.popoverText.rooms})).init()}new m({roomsSelector:"#ap_booker_CruiseFlight_cabins",roomsTemplateSelector:".ap_roomOccupancy_template",roomsContainerSelector:".ap_roomOccupancy_container",roomsTemplateBaseId:"ap_booker_CruiseFlightroom",minorsAgesSelector:".ap_booker_CruiseFlight_minors",minorsAgesTemplateSelector:".ap_minorAge_template",minorsAgesContainerBaseSelector:"#ap_minorsAges_CruiseFlight_container",minorsAgesTemplateBaseId:"ap_booker_CruiseFlight_minorAge",minorsAgesAltValueBaseSelector:"#ap_booker_CruiseFlight_minorsAges",minorsAgesContainerBaseId:"ap_minorsAges_CruiseFlight_container",minorsAgesContainerContainerSelector:".ap_booker_CruiseFlight_minorsAgesContainer",adultsTemplateBaseId:"ap_booker_CruiseFlight_adults",yearSelector:".ap_CruiseFlight_year",monthSelector:".ap_CruiseFlight_month",bookerSelector:n.selector,showMonths:!0,manageRoomsClone:function(e,t,a){e.find(".ap_index").html(a+1),e.attr("id","ap_booker_CruiseFlightroom"+a).removeClass("ap_roomOccupancy_template"),e.find("#ap_booker_CruiseFlight_adults").attr("id","ap_booker_CruiseFlight_adults"+a).removeClass("ap-data_room-").addClass("ap-data_room-"+a),e.find("#ap_booker_CruiseFlight_minors").attr("id","ap_booker_CruiseFlight_minors"+a).removeClass("ap-data_room-").addClass("ap-data_room-"+a),e.find("#ap_booker_CruiseFlight_minorsAges").attr("id","ap_booker_CruiseFlight_minorsAges"+a).removeClass("ap-data_room-").addClass("ap-data_room-"+a),e.appendTo(t)},manageMinorsAgesClone:function(e,t,a,o){e.find(".ap_index").html(o+1),e.attr("id","ap_booker_CruiseFlight_minorAge"+o+a).removeClass("ap_minorAge_template").removeClass("ap-data_room-").addClass("ap-data_room-"+o),e.find(".Err_MinorsAge").attr("id","Err_CruiseUserSelections_Cabins_"+a+"__MinorsAges_"+o+"__Years"),e.find(".Err_MinorsAgeMonths").attr("id","Err_CruiseUserSelections_Cabins_"+a+"__MinorsAges_"+o+"__Months"),e.appendTo(t)},onMonthSelect:function(e,t){0<=t?t<n.minMonthValue?(p(e).parent().siblings(n.minAgeErrorSelector).show(),p(e).parent().siblings(n.minAgeWarningSelector).hide()):(p(e).parent().siblings(n.minAgeWarningSelector).show(),p(e).parent().siblings(n.minAgeErrorSelector).hide()):(p(e).parent().siblings(n.minAgeErrorSelector).hide(),p(e).parent().siblings(n.minAgeWarningSelector).hide())},onYearSelect:function(e,t){0<t&&(p(e).siblings(n.minAgeWarningSelector).hide(),p(e).siblings(n.minAgeErrorSelector).hide())},minorsAgesContainerTemplateSelector:"#ap_minorsAges_CruiseFlight_containerTemplate",onUpdatePopover:!0===n.usePopover?u:void 0}).init();for(var o=0;o<n.originAutocomplete.autocompletes.length;o++)r(n.originAutocomplete.autocompletes[o],n.originAutocomplete.uri);p(n.formMappingForm).attr("action",n.submitUri),p(".ap_booker_submit",n.selector).prop("disabled",!1),c()},fillAndValidate:function(){if(0==n.skipValidation)return validate();var e=new p.Deferred;return e.resolve(),e.promise()},toggleVisible:0!=n.usePopover?function(){if(null!=i)return i.toggleVisible}:void 0}}}),define("dataLayerEvents",[],function(){return function(){var t;return{init:function(){t=window.dataLayer||[]},buildEventLabel:function(){if(0<arguments.length){var e="";for(var t in arguments)null!=arguments[t]&&(e+=arguments[t]+(t<arguments.length-1?" | ":""));return e}return""},createEvent:function(e,t,a,o){return{event:e,event_action:t,event_category:a,event_label:o}},pushEvent:function(e){t.push(e)}}}}),define("generalInfo",[],function(){return{getGeneralInfo:function(){return(window.appConfiguration||{}).generalConfig||{affiliateSiteId:0,channelId:0,agencyId:0,AgentId:0}}}}),define("widgetDataLayerEvents",["dataLayerEvents","generalInfo"],function(e,t){return function(){var c=new e;c.init();return{packageEvents:function(e){for(var t=0,a=0,o=0;o<e.Rooms;o++)t+=e["room"+o+".Adults"],a+=e["room"+o+".Kids"];var i=e.hdnAirportTo?e.hdnAirportTo:"No Airport";if(0<e.idHotel)var n=document.querySelector('[value="'+e.idHotel+'"]'),r=n&&""!=n.innerText?n.innerText:"No Hotel";else r="No Hotel";var s=c.buildEventLabel(e.AgencyId,e.AgencyBranchId,e.AdminUserId,e.AgencyContactId,e.hdnAirportFrom,i,r,e.CheckIn,e.CheckOut,e.Rooms,t,a),l=c.createEvent("Hotel+Flight Search","Search","Package",s);c.pushEvent(l)},hotelEvents:function(e){for(var t=0,a=0,o=0;o<e.Rooms;o++)t+=e["room"+o+".Adults"],a+=e["room"+o+".Kids"];var i=c.buildEventLabel(e.AgencyId,e.AgencyBranchId,e.AdminUserId,e.AgencyContactId,e.placeTypeName,e.pDisplay,e.CheckIn,e.CheckOut,e.Rooms,t,a),n=c.createEvent("Hotel Search","Search","Hotel",i);c.pushEvent(n)}}}}),define("widgetMain",["jquery","hotelBooker","packageBooker","flightBooker","busPackageBooker","busBooker","carBooker","transferBooker","tourBooker","cruiseBooker","circuitBooker","../Common/getDataValue","../Common/toDictionary","DynamicPackage","CruiseFlightBooker","widgetDataLayerEvents"],function(w,u,p,d,m,h,f,g,v,_,y,A,e,k,D,S){return function(){var b={Prefix:"ap_booker",Sections:[],Engines:[],Container:"",FocusOnChange:!1,IsNotFirstFocus:!1,CurrentEngineCode:"",CurrentSectionCode:"",CustomTarget:void 0};var s=function(e,t){switch(e.Code){case"Hotel":e.engine=u(t);break;case"FlightPackage":e.engine=p(t);break;case"Flight":e.engine=d(t);break;case"BusPackage":e.engine=m(t);break;case"Transfer":e.engine=g(t);break;case"Tour":e.engine=v(t);break;case"Car":e.engine=f(t);break;case"Bus":e.engine=h(t);break;case"Cruise":e.engine=_(t);break;case"Circuit":e.engine=y(t);break;case"DynamicPackage":e.engine=k(t);break;case"CruiseFlight":e.engine=D(t)}e.engine.init(),e.IsActive=!0,e.IsLoading=!1,c(e.Code),"function"==typeof window.ptw_external_onEngineLoad&&window.ptw_external_onEngineLoad(e.Code),w(".ui-datepicker").each(function(){var e=w(this).attr("id");0==w("#"+e).parent(".pt-customJqueryUi").length&&(0==w(".pt-customJqueryUi").length?w("#"+e).wrap("<div class='pt-customJqueryUi' />"):w(".pt-customJqueryUi").append(w("#"+e)))})},t=function(){w("."+b.Prefix+"_tab").click(function(e){e.preventDefault(),w("li","#ap_ptw_hiddenTabs").removeClass("ptw-active"),w("li",".ap_ptw_tabs").removeClass("ptw-active"),w(this).closest("li").addClass("ptw-active");var t=A(this,"section");n(t),b.ShowTitleTabs&&1==b.ShowTitleTabs&&(w(".titleTabHidden").hide(),w(".titleTab"+t).show())}),w("."+b.Prefix+"_variant").click(function(e){var t=A(this,"engine");r(t)}),w("#"+b.Container).on("click","."+b.Prefix+"_submenu input",function(){w(this).closest("li").siblings().removeClass("ptw-active"),w(this).closest("li").addClass("ptw-active")}),w("body").on("submit","."+b.Prefix+"_form",function(e){e.preventDefault(),w("input[type=submit]").attr("disabled","disabled"),w(".img-submit").show(),w(".ptw-errormsg").html(""),o(this)})},a=function(){var e=document.createElement("center"),t=document.createElement("div");t.setAttribute("id","splash"),t.setAttribute("class","defaultSplash"),t.setAttribute("style","display:none;");var a=document.createElement("img");a.setAttribute("src",b.SplashImage);var o=document.createElement("h1");o.innerHTML=b.SplashText;var i=document.createElement("div");i.setAttribute("class","spinner"),t.appendChild(a),t.appendChild(i),t.appendChild(o),e.appendChild(t),document.body.appendChild(e)},C=function(e){e.show();var t=w(e).parent().clone();document.body.innerHTML="",t.appendTo(document.body)},o=function(d,m){var h,e=A(d,"engine"),t=l(e),f=i(),g=void 0!==w("#agency_branch_id")?w("#agency_branch_id").val():null,v=void 0!==w("#agency_id")?w("#agency_id").val():null,_=void 0!==w("#admin_user_id")?w("#admin_user_id").val():null,y=void 0!==w("#agency_contact_id")?w("#agency_contact_id").val():null;if(null!=t){var k=t.engine;k.fillAndValidate&&(h=k.code,k.fillAndValidate().done(function(){if("Tour"==h){var e=w('input[name="Searchbox.PostUrl"]',".ap-data_engine-"+h).val().replace("}/","}").replace("}","}/");w('input[name="Searchbox.PostUrl"]',".ap-data_engine-"+h).val(e)}w.ajax({url:w(d).attr("action")+"?jsoncallback=?",data:w(d).serialize(),dataType:"jsonp"}).done(function(e){if(0==e.Errors.length){!function(){try{var e=w("#splash");0===e.length||e.hasClass("defaultSplash")?0!==e.length&&C(e):"undefined"!=typeof showSplash&&jQuery.isFunction(showSplash)?showSplash():(w("#splash").show(),w(".homeContent").hide())}catch(e){w("#splash").hide(),w(".homeContent").show()}}(),f.isValid&&(e.Url+="?campaignToken="+f.token);var t,a=!1,o=new S;switch(e.FormData.AgencyBranchId=g,e.FormData.AgencyId=v,e.FormData.AdminUserId=_,e.FormData.AgencyContactId=y,h){case"FlightPackage":o.packageEvents(e.FormData);break;case"Hotel":"hotel"!==e.FormData.pDisplay&&o.hotelEvents(e.FormData)}if(0==e.Method){for(var i in(t=document.createElement("form")).action=w.trim(e.Url),t.method="GET",e.FormData)(l=document.createElement("input")).setAttribute("type","hidden"),l.setAttribute("name",i),l.setAttribute("value",e.FormData[i]),t.appendChild(l);if(e.IsCc){var n=document.location.href;try{for(var r=n.split("?")[1].split("&"),s=0;s<r.length;s++)(l=document.createElement("input")).setAttribute("type","hidden"),l.setAttribute("name",r[s].split("=")[0]),l.setAttribute("value",r[s].split("=")[1]),t.appendChild(l)}catch(e){}}a=!0}else if(1==e.Method){for(var i in(t=document.createElement("form")).action=w.trim(e.Url),t.method="POST",e.FormData){var l;(l=document.createElement("input")).setAttribute("type","hidden"),l.setAttribute("name",i),l.setAttribute("value",e.FormData[i]),t.appendChild(l)}a=!0}if(window.ptw_external_onSubmitForm){var c=null;if("function"==typeof window.ptw_external_onSubmitForm?c=window.ptw_external_onSubmitForm:window.ptw_external_onSubmitForm instanceof Array&&(c=1<window.ptw_external_onSubmitForm.length?(m=parseInt(m,10)||0,x(m)):window.ptw_external_onSubmitForm[0]),"function"==typeof c){e.Engine=h;var u=c(e,t,d);a=null==u||u}}1==a&&void 0!==t&&(document.body.appendChild(t),void 0!==b.CustomTarget&&""!==b.CustomTarget&&t.setAttribute("target",b.CustomTarget),t.submit())}else w("input[type=submit]").removeAttr("disabled"),w(".img-submit").hide();var p=null!=k.toggleVisible?k.toggleVisible():void 0;w.each(e.Errors,function(e,t){null!=t&&(-1==t.AttemptedValue&&null!=p&&p(),w("#Err_"+t.PropertyName.replace(/\./g,"_").replace(/\[/g,"_").replace(/\]/g,"_"),"#"+b.Prefix+"_"+h).html(t.ErrorMessage),console.log("#Err_"+t.PropertyName.replace(/\./g,"_").replace(/\[/g,"_").replace(/\]/g,"_"),"#"+b.Prefix+"_"+h))})})}))}},i=function(){var e=sessionStorage.getItem("campaignToken");return{token:e,isValid:null!==e&&"null"!==e}},l=function(e){for(var t=b.Engines.length-1;0<=t;t--)if(b.Engines[t]&&b.Engines[t].Code==e)return b.Engines[t]},n=function(e,t){var a=new w.Deferred,o=function(e){for(var t=0;t<b.Sections.length;t++)if(b.Sections[t].Code==e)return b.Sections[t];return null}(e);if(null!=o){var i=A("#"+b.Prefix+"_variant_"+e+' input[type="radio"]:checked',"engine");i=null!=i&&""!=i?i:o.DefaultEngineCode,1!=t&&(w("."+b.Prefix+"_engine").hide(),w("."+b.Prefix+"_variantGroup").hide(),w("#"+b.Prefix+"_variant_"+e).show()),w.when(r(i,t)).done(function(){a.resolve()}),b.CurrentSectionCode=e}else a.reject();return a.promise()},r=function(e,t){var a,o,i,n=new w.Deferred,r=l(e);return null!=r?(1!=t&&(w("."+b.Prefix+"_engine").hide(),b.CurrentEngineCode=r.Code),1!=r.IsLoading&&(r.IsLoading=!0,0==w("#"+b.Prefix+"_"+r.Code).length&&w("<div/>",{id:b.Prefix+"_"+r.Code,class:b.Prefix+"_engine",style:"display:none"}).appendTo("#ptw-engines"),0==r.IsActive?w.when((a=r,o=t,i=new w.Deferred,1==a.IsLoaded&&a.Options&&null!=a.Options?(s(a,a.Options),i.resolve(),i.promise()):w.ajax({url:a.Url+"?jsoncallback=?",data:w.toDictionary(a.Data),dataType:"jsonp"}).done(function(e){w.extend(!0,e.options,e.localconfig),w("#"+b.Prefix+"_"+a.Code).html(e.html),1==o&&b.CurrentEngineCode!=a.Code?(a.IsLoaded=!0,a.Options=e.options,a.IsLoading=!1):s(a,e.options)}))).done(function(){w("input[type=submit]","#ap_booker_"+r.Code).removeAttr("disabled"),n.resolve()}):(1!=t&&c(r.Code),r.IsLoading=!1,n.resolve()),w("input[type=submit]","#ap_booker_"+r.Code).removeAttr("disabled"))):n.reject(),n.promise()},c=function(e){if(b.CurrentEngineCode==e)if(w("."+b.Prefix+"_engine").hide(),w("#"+b.Prefix+"_"+e).show(),1==b.FocusOnChange&&b.IsNotFirstFocus&&"Transfer"!=e){var t=w("#ap_booker_"+e).find('input[type="text"]').first(),a=t.val();t.focus().val("").val(a)}else b.IsNotFirstFocus||(b.IsNotFirstFocus=!0)},x=function(e){for(var t=0;t<window.ptw_external_onSubmitForm.length;t++)if(window.ptw_external_onSubmitForm[t].index==e)return window.ptw_external_onSubmitForm[t].callback;return null};return window.ptw_external_widgetMain_submitFunction=o,window.ptw_external_widgetMain_addOnSubmitCallback=function(e){var t=-1;if("function"==typeof window.ptw_external_onSubmitForm){var a=window.ptw_external_onSubmitForm;window.ptw_external_onSubmitForm=[],t=0,window.ptw_external_onSubmitForm.push({index:t,callback:a})}return window.ptw_external_onSubmitForm instanceof Array&&(t=window.ptw_external_onSubmitForm.length,window.ptw_external_onSubmitForm.push({index:t,callback:e})),t},window.ptw_external_widgetMain_removeOnSubmitCallback=function(e){if(e<0)return!1;if("function"==typeof window.ptw_external_onSubmitForm&&0==e)window.ptw_external_onSubmitForm=null;else if(window.ptw_external_onSubmitForm instanceof Array){for(var t=window.ptw_external_onSubmitForm.length,a=0;a<t;a++)window.ptw_external_onSubmitForm[a].index!=e&&window.ptw_external_onSubmitForm.push(window.ptw_external_onSubmitForm[a]);window.ptw_external_onSubmitForm.splice(0,t)}return!0},{init:function(e){w.extend(b,e),a(),t(),n(b.CurrentSectionCode,b.Silent)},initOptionsOnly:function(e){w.extend(b,e),t()},switchEngine:r,showCompleteSection:n}}}),define("noconflict",["jquery"],function(e){return e.noConflict(!0)});
//# sourceMappingURL=booker-2.1-min.js.map